define(["core/log"],function(a){function b(){var a=document.documentElement||document.body.parentNode;if("number"!=typeof a.clientWidth&&(a=document.body),"number"==typeof document.clientWidth)return{width:document.clientWidth,height:document.clientHeight};var b,c,d=document.body,e=document.defaultView||window;return a===d||(b=Math.max(a.clientWidth,d.clientWidth))>e.innerWidth||(c=Math.max(a.clientHeight,d.clientHeight))>e.innerHeight?{width:d.clientWidth,height:d.clientHeight}:{width:b,height:c}}function c(a){var b="mod_facetoface_event-action:";return b+=1===arguments.length?a:Array.prototype.reduce.call(arguments,function(a,b){return a+":"+b}),M.util.js_pending(b),function(){M.util.js_complete(b)}}function d(a){return this instanceof d?void this._init(a):new d(a)}function e(a){return this instanceof e?void this._init(a):new e(a)}d.OPEN_EVENT="mod_facetoface:dropdown.open",d.CLOSED_EVENT="mod_facetoface:dropdown.closed",function(){var a={TAB:9,ENTER:13,ESCAPE:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40};this.constructor=d,this._init=function(a){if(!a.matches(".mod_facetoface__sessionlist__action__dropdown"))throw new Error("DD: not a dropdown button");if(this.el=a,this.parent=a.closest(".mod_facetoface__sessionlist__action__buttons"),null===this.parent)throw new Error("DD: button group not found");if(this.menu=this.parent.querySelector('[data-f2f-dropdown-id="'+a.id+'"]'),null===this.menu)throw new Error("DD: menu not found");this.menuItems=Array.prototype.slice.apply(this.menu.querySelectorAll("li:not(.disabled) > .dropdown-item")).map(function(a){return a.parentNode}),this.scrollTimerId=null,this.scrollDone=null,this.el.setAttribute("aria-expanded","false"),this._onKeyDownMenu=this._onKeyDownMenu.bind(this),this._onScrollOrResize=this._onScrollOrResize.bind(this),this._onClickBackground=this._onClickBackground.bind(this),this._onBlurButton=this._onBlurButton.bind(this),this._onKeyDownButton=this._onKeyDownButton.bind(this),this.el.addEventListener("click",this._onClickButton.bind(this)),this.el.addEventListener("focus",this._onFocusButton.bind(this))},this.isMenuOpen=function(){return this.parent.classList.contains("open")},this.openMenu=function(){return this.parent.classList.add("open"),this.el.setAttribute("aria-expanded","true"),window.addEventListener("click",this._onClickBackground,!0),window.addEventListener("keydown",this._onKeyDownMenu,!0),window.addEventListener("scroll",this._onScrollOrResize,!0),window.addEventListener("resize",this._onScrollOrResize,!0),this._fireEvent(d.OPEN_EVENT),this.repositionMenu()},this.closeMenu=function(a){return this.parent.classList.remove("open"),this.el.setAttribute("aria-expanded","false"),window.removeEventListener("click",this._onClickBackground,!0),window.removeEventListener("keydown",this._onKeyDownMenu,!0),window.removeEventListener("scroll",this._onScrollOrResize,!0),window.removeEventListener("resize",this._onScrollOrResize,!0),this.scrollTimerId&&(window.cancelAnimationFrame(this.scrollTimerId),this.scrollTimerId=null),this.scrollDone&&(this.scrollDone(),this.scrollDone=null),a&&this.el.focus(),this._fireEvent(d.CLOSED_EVENT),Promise.resolve()},this.repositionMenu=function(){this.scrollTimerId&&(window.cancelAnimationFrame(this.scrollTimerId),this.scrollTimerId=null);var a=this;return new Promise(function(d){var e=function(){a.scrollTimerId=null;var c=a.el.getBoundingClientRect(),e=b(),f=e.width-c.left-c.width,g=c.top+c.height;f<0&&(f=0),a.menu.style.right=f+"px",a.menu.style.top=g+"px",a.scrollTimerId=null,a.scrollDone&&(a.scrollDone(),a.scrollDone=null),d()};a.scrollDone=a.scrollDone||c("reposition",a.el.id),a.scrollTimerId=window.requestAnimationFrame(e)})},this.selectItem=function(a){if(this.menuItems.length){a%=this.menuItems.length,a<0&&(a+=this.menuItems.length);var b=this.menuItems[a].querySelector("a"),d=c("selectitem",this.el.id,a);return new Promise(function(a){setTimeout(function(){b.focus(),d(),a()},0)})}return Promise.resolve()},this.openMenuAndSelectItem=function(a){var b=this;return b.openMenu().then(function(){return b.selectItem(a)})},this._fireEvent=function(a){var b=new CustomEvent(a,{bubbles:!0,detail:this});this.el.dispatchEvent(b)},this._onClickButton=function(a){a.preventDefault(),a.stopPropagation(),this.isMenuOpen()?this.closeMenu():this.openMenu()},this._onFocusButton=function(){event.stopPropagation(),this.el.addEventListener("blur",this._onBlurButton),this.el.addEventListener("keydown",this._onKeyDownButton)},this._onBlurButton=function(){event.stopPropagation(),this.el.removeEventListener("blur",this._onBlurButton),this.el.removeEventListener("keydown",this._onKeyDownButton)},this._onKeyDownButton=function(b){if(b.stopPropagation(),this.isMenuOpen())switch(b.keyCode){case a.TAB:b.shiftKey?this.closeMenu():this.selectItem(0);break;case a.ESCAPE:this.closeMenu()}else switch(b.keyCode){case a.DOWN:b.preventDefault(),this.openMenuAndSelectItem(0);break;case a.UP:b.preventDefault(),this.openMenuAndSelectItem(-1);break;case a.ENTER:case a.SPACE:b.preventDefault(),this.openMenuAndSelectItem(0)}},this._onKeyDownMenu=function(b){var c=b.target.closest("li");if(null!==c||b.target===this.el||this.el.contains(b.target)){b.stopPropagation();var d=this.menuItems.indexOf(c);switch(b.keyCode){case a.ESCAPE:b.preventDefault(),this.closeMenu(!0);break;case a.UP:b.preventDefault(),this.selectItem(d<0?d:d-1);break;case a.DOWN:b.preventDefault(),this.selectItem(d+1);break;case a.TAB:b.stopPropagation(),b.shiftKey?d<=0?this.closeMenu(!0):(b.preventDefault(),this.selectItem(d-1)):d>=this.menuItems.length-1?this.closeMenu(!0):(b.preventDefault(),this.selectItem(d+1))}}},this._onClickBackground=function(a){!this.el.contains(a.target)&&this.isMenuOpen()&&setTimeout(function(){this.closeMenu()}.bind(this),0)},this._onScrollOrResize=function(a){a.target!==document&&a.target!==window||!this.isMenuOpen()||this.repositionMenu()}}.call(d.prototype),function(){var b=null;Object.defineProperty(e,"current",{get:function(){return b}}),this.constructor=e,this._init=function(b){this.el=b;var c=b.querySelector(".mod_facetoface__sessionlist__action__dropdown");try{this.dropdown=new d(c)}catch(e){a.error(e)}this.dropdown&&(b.addEventListener(d.OPEN_EVENT,this._onDropDownOpen.bind(this)),b.addEventListener(d.CLOSED_EVENT,this._onDropDownClosed.bind(this)))},this._onDropDownOpen=function(a){a.detail!==b&&(b=a.detail)},this._onDropDownClosed=function(a){a.detail===b&&(b=null)}}.call(e.prototype);var f={init:function(a){return new Promise(function(b){var c=new e(a);b(c)})},update:function(){var a=e.current;a&&a.repositionMenu()}};return f});