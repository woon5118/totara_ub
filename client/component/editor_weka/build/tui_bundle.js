!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="SIrR")}({"+BVb":function(e,t,n){},"+MEP":function(e,t){e.exports=tui.require("tui/components/profile/MiniProfileCard")},"+lwy":function(e,t,n){"use strict";var i=n("og+O");n.n(i).a},"+oKZ":function(e,t,n){},"+pLW":function(e,t){e.exports=tui.require("editor_weka/components/suggestion/User")},"+sid":function(e,t,n){},"+xcZ":function(e,t){e.exports=tui.require("editor_weka/components/attachments/FileAttachment")},"/+gN":function(e,t){e.exports=tui.require("tui/components/icons/TextItalic")},"/7YT":function(e,t){e.exports=tui.require("ext_prosemirror/model")},"/uQ1":function(e,t,n){"use strict";n.r(t),n.d(t,"toggleList",(function(){return a})),n.d(t,"isListActive",(function(){return r}));var i=n("YVua"),o=n("D7iR");n("/7YT"),n("GcJT");function a(e,t,n){const a=Object(i.liftListItem)(t),r=Object(i.wrapInList)(e);return(t,i,s)=>{const{selection:l}=t,d=l.$from.blockRange(l.$to);if(!d)return!1;const c=function(e,t){return Object(o.findParentNode)(e=>t.includes(e.type))(e)}(l,n),u=c&&d.depth-c.depth<=1;if(d.depth>=1&&u){if(c.node.type===e)return a(t,i,s);if(e.validContent(c.node.content))return i&&i(t.tr.setNodeMarkup(c.pos,e)),!0}return r(t,i,s)}}function r(e,t){const{selection:n}=e,i=n.$from.blockRange(n.$to);if(!i)return!1;const a=Object(o.findParentNode)(e=>e.type==t)(n);return i.depth>=1&&a&&i.depth-a.depth<=1}},"00Pk":function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/AudioBlock")},"0QOp":function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/LinkBlock")},"0oIn":function(e,t,n){"use strict";n.r(t);var i=n("5h9J"),o={components:{ButtonIcon:n.n(i).a},props:{text:{type:String,required:!0},selected:{type:Boolean,default:null},iconOnly:Boolean,disabled:Boolean},computed:{ariaPressed(){return null!=this.selected&&(this.selected?"true":"false")}}},a=(n("wC1v"),n("KHd+")),r=Object(a.a)(o,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("ButtonIcon",{staticClass:"tui-wekaToolbarButtonIcon",class:{"tui-wekaToolbarButtonIcon--selected":e.selected,"tui-wekaToolbarButtonIcon--iconOnly":e.iconOnly},attrs:{"aria-label":e.text,"aria-pressed":e.ariaPressed,title:e.text,disabled:e.disabled},on:{click:function(t){return e.$emit("click",t)}}},[e._t("icon")],2)}),[],!1,null,null,null);r.options.__hasBlocks={script:!0,template:!0};t.default=r.exports},"12HA":function(e,t){e.exports=tui.require("tui/config")},"1aB9":function(e,t){e.exports=tui.require("tui/file")},"1egj":function(e,t,n){"use strict";function i(e,t){const n=s(e);if(!n.node)return!1;const i=n.node.marks.find(e=>e.type===t);if(!i)return!1;let o=e.index(),a=e.start()+n.offset,r=a+n.node.nodeSize;return{from:l(e.parent,i,o,a,-1),to:l(e.parent,i,o,r,1)}}function o(e){if(e&&e.$from.parent!=e.$from.doc&&e.$from.sameParent(e.$to)&&0===e.$from.parentOffset&&e.$to.parentOffset===e.$to.parent.nodeSize-2){const t=e.$from.doc;return new r(t.resolve(e.$from.pos-1),t.resolve(e.$to.pos+1))}return e}function a(e,t){return s(e).node.marks.find(e=>e.type===t)}n.r(t),n.d(t,"getMarkRange",(function(){return i})),n.d(t,"expandContentResolvedRange",(function(){return o})),n.d(t,"getMark",(function(){return a})),n.d(t,"ResolvedRange",(function(){return r}));class r{constructor(e,t){this.$from=e,this.$to=t}static resolve(e,t){return new r(e.resolve(t.from),e.resolve(t.to))}}function s(e){return e.parent.childAfter(e.parentOffset)}function l(e,t,n,i,o){const a=e.childCount-1;for(;!((n+=o)<0||n>a);){const a=e.child(n);if(!t.isInSet(a.marks))break;i+=e.child(n).nodeSize*o}return i}},"1mLp":function(e,t,n){"use strict";n.r(t);var i=n("gLvT"),o=n.n(i),a=n("KGcv"),r=n.n(a),s={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"core_find_hashtags"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"pattern"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_text"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contextid"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"component"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_component"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"area"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_area"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"hashtags"},name:{kind:"Name",value:"core_hashtags_by_pattern"},arguments:[{kind:"Argument",name:{kind:"Name",value:"pattern"},value:{kind:"Variable",name:{kind:"Name",value:"pattern"}}},{kind:"Argument",name:{kind:"Name",value:"contextid"},value:{kind:"Variable",name:{kind:"Name",value:"contextid"}}},{kind:"Argument",name:{kind:"Name",value:"component"},value:{kind:"Variable",name:{kind:"Name",value:"component"}}},{kind:"Argument",name:{kind:"Name",value:"area"},value:{kind:"Variable",name:{kind:"Name",value:"area"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tag"},arguments:[],directives:[]}]}}]}}]},l={components:{Dropdown:o.a,DropdownItem:r.a},props:{contextId:{type:[Number,String]},component:{type:String},area:{type:String},location:{required:!0,type:Object},pattern:{required:!0,type:String}},data:()=>({hashtags:[]}),apollo:{hashtags:{query:s,fetchPolicy:"network-only",variables(){return{pattern:this.pattern,contextid:this.contextId,component:this.component,area:this.area}}}},computed:{showSuggestions(){return this.$apollo.loading||this.hashtags.length>0},positionStyle(){return{left:this.location.x+"px",top:this.location.y+"px"}}},watch:{showSuggestions(e){e||this.$emit("dismiss")}},mounted(){let e=this.$refs.customTrigger;e&&e.click()},methods:{pickTag({id:e,tag:t}){this.$emit("item-selected",{id:e,text:t})},dismiss(){this.open=!1,this.$emit("dismiss")}}},d=(n("5kVk"),n("KHd+")),c=function(e){e.options.__langStrings={editor_weka:["matching_hashtags"],core:["loadinghelp"]}},u=Object(d.a)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaHashtagSuggestions",style:e.positionStyle},[n("Dropdown",{attrs:{separator:!1,open:e.showSuggestions,"inline-menu":!0},on:{dismiss:e.dismiss},scopedSlots:e._u([{key:"trigger",fn:function(){return[n("span",{staticClass:"sr-only"},[e._v("\n        "+e._s(e.$str("matching_hashtags","editor_weka"))+":\n      ")])]},proxy:!0}])},[e._v(" "),e.$apollo.loading?[n("DropdownItem",{attrs:{disabled:!0}},[e._v("\n        "+e._s(e.$str("loadinghelp","core"))+"\n      ")])]:e._e(),e._v(" "),e._l(e.hashtags,(function(t,i){return n("DropdownItem",{key:i,on:{click:function(n){return e.pickTag(t)}}},[e._v("\n      "+e._s(t.tag)+"\n    ")])}))],2)],1)}),[],!1,null,null,null);"function"==typeof c&&c(u),u.options.__hasBlocks={script:!0,template:!0};t.default=u.exports},"22E+":function(e,t){e.exports=tui.require("ext_prosemirror/view")},"2R5z":function(e,t,n){},"2RJX":function(e,t){e.exports=tui.require("tui/components/icons/Attachment")},"2wx7":function(e,t){e.exports=tui.require("editor_weka/components/Weka")},"36rR":function(e,t){e.exports=tui.require("tui/dom/focus")},"3bgQ":function(e,t){e.exports=tui.require("tui/components/embeds/ResponsiveEmbedIframe")},"3qPy":function(e,t){e.exports=tui.require("tui/components/icons/ListOrdered")},"3sQR":function(e,t){e.exports=tui.require("tui/components/dropdown/DropdownButton")},"4BOM":function(e,t,n){"use strict";var i=n("AlIX");n.n(i).a},"4uRO":function(e,t,n){"use strict";n.r(t),n.d(t,"REGEX",(function(){return l}));var i=n("GcJT"),o=n("EBtw"),a=n.n(o),r=n("TnOg"),s=n("TXEh");const l=new RegExp("#[^#\\s]+$","g");t.default=function(e){const t=new i.PluginKey("hashtags");let n=new r.default(e);return new i.Plugin({key:t,view(){return{update:Object(s.debounce)(async e=>{const{text:t,active:i,range:o}=this.key.getState(e.state);n.destroyInstance(),t&&i&&await n.showList({view:e,component:{name:"hashtag",component:a.a,attrs:(e,t)=>({text:t})},state:{text:t.slice(1),active:i,range:o}})},500)}},state:{init:()=>({active:!1,range:{},text:null}),apply:(e,t)=>(l.lastIndex=0,n.apply(e,t,l))},props:{handleKeyDown(t,n){const{active:i,text:o,range:a}=this.getState(t.state);if(!i)return!1;return[" ","Tab","Enter","PageUp","PageDown","Home","End","Escape","Spacebar"].includes(n.key)&&e.execute((e,t)=>(t(e.tr.replaceWith(a.from,a.to,e.schema.node("hashtag",{text:o.slice(1)}))),!0)),!1},handleClick(t){const{active:n,text:i,range:o}=this.getState(t.state);return!!n&&(e.execute((e,t)=>{const n=e.schema.node("hashtag",{text:i.slice(1)});t(e.tr.replaceWith(o.from,o.to,n))}),!0)}}})}},"5+iW":function(e,t,n){},"52bL":function(e,t,n){"use strict";n.r(t);var i=n("tnXT"),o=n.n(i),a=n("TGM/"),r=n.n(a),s={extends:o.a,props:{ariaLabel:String},data:()=>({textContent:"",dropdownShown:!1}),mounted(){this.observer=new MutationObserver(this.$_updateTextContent),this.observer.observe(this.$refs.content,{childList:!0,subtree:!0,characterData:!0}),this.$_updateTextContent()},beforeDestroy(){this.observer.disconnect()},methods:{showDropdown(){this.context.showMarkDropdown(this.getRange).then(e=>{this.dropdownShown=!0,e.$on("dismiss",()=>this.dropdownShown=!1)})},$_updateTextContent(){const e=r()();setTimeout(()=>{e(),this.textContent=this.$refs.content.textContent},0)}}},l=n("KHd+"),d=Object(l.a)(s,(function(){var e=this.$createElement;return(this._self._c||e)("a",{ref:"content",attrs:{href:this.attrs.href,title:this.attrs.title},on:{click:this.showDropdown}})}),[],!1,null,null,null);d.options.__hasBlocks={script:!0,template:!0};t.default=d.exports},"5h9J":function(e,t){e.exports=tui.require("tui/components/buttons/ButtonIcon")},"5kVk":function(e,t,n){"use strict";var i=n("+BVb");n.n(i).a},"5vO2":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return b}));var i=n("GcJT"),o=n("22E+"),a=n("daNz"),r=n("XAXS"),s=n("zTcH"),l=n("ulH4"),d=n("PvNB"),c=n("v+xu"),u=n("/7YT"),p=n("SeWd"),m=n("mi/L"),h=n("vFxO"),f=(n("U9km"),n("7F6Z")),_=n("w52A"),g=n("TXEh"),v=n("vyVp"),k=n("V68o");n("7gPm");class b{constructor(e){this.uid=Object(g.uniqueId)(),this._options=e,this._parent=e.parent,this.viewExtrasEl=e.viewExtrasEl,this.viewExtrasLiveEl=e.viewExtrasLiveEl,this.destroyed=!1,this.view=null,this.state=null,this._extensions=e.extensions||[],this.fileStorage=e.fileStorage,this._extensions.forEach(e=>e.setEditor(this));const t={};this._nodeViews={};const n={};this._markViews={},this._allVueComponents=[],this._extensions.forEach(e=>{this._extractExtensionSchema(e,"node","nodes",t,this._nodeViews),this._extractExtensionSchema(e,"mark","marks",n,this._nodeViews)}),this.schema=Object(m.createSchema)({nodes:t,marks:n}),this._plugins=[Object(f.default)(e.placeholder)],this._extensions.forEach(e=>{const t=e.plugins();t&&t.forEach(e=>this._plugins.push(e))}),this._toolbarItemInstances=this._extensions.reduce((e,t)=>t.toolbarItems?e.concat(t.toolbarItems()):e,[]),this._toolbarItems=this._toolbarItemInstances.map(e=>e.getDef()),this._mapKeys=this._extensions.map(e=>e.keymap&&e.keymap.bind(e)).filter(Boolean),this._inputRules=this._extensions.reduce((e,t)=>t.inputRules?e.concat(t.inputRules()):e,[]),this.dispatch=this.dispatch.bind(this),this.execute=this.execute.bind(this),this.getFileStorageItemId=this.getFileStorageItemId.bind(this),this.setValue(e.value)}updateFileItemId(e){this.fileStorage.updateFileItemId(e)}_extractExtensionSchema(e,t,n,i,o){const a=e[n]&&e[n]();if(a)for(const e in a){const n=a[e];i[e]&&console.warn(`[editor_weka] ${t} "${e}" was redefined`),i[e]=n.schema,n.component&&(this._allVueComponents.push(n.component),o[e]=this._componentNodeView.bind(this,n.component,n.componentContext)),n.view&&(o[e]=n.view)}}setValue(e){if(!e.inflated(this))if(e.hasHtml()){const t=document.createElement("div");t.innerHTML=e.getHtml();const n=i.EditorState.create(Object.assign({},this._editorConfig(),{doc:u.DOMParser.fromSchema(this.schema).parse(t)}));e.inflate(this,n)}else{let t=e.getDoc(!1);t&&(t=this._execSerializedVisitors(t,"load"));const n=i.EditorState.fromJSON(this._editorConfig(),{doc:t,selection:{anchor:0,head:0,type:"text"}});e.inflate(this,n)}this._value=e,this.state=e.getState(this),this.view&&this.view.updateState(this.state)}_editorConfig(){return{schema:this.schema,plugins:this._createPlugins()}}createView(e){let t={class:"tui-weka-editor",role:"region","aria-label":Object(k.langString)("pluginname","editor_weka")};return this._options.placeholder&&(t["aria-label"]=this._options.placeholder),this.view=new o.EditorView(e,{state:this.state,dispatchTransaction:this.dispatch,nodeViews:this._nodeViews,attributes:t}),this.view.dom.addEventListener("focus",e=>{this._options.onFocus&&this._options.onFocus(e)}),this.view.dom.addEventListener("blur",e=>{this._options.onBlur&&this._options.onBlur(e)}),this.view}allVueComponents(){return this._allVueComponents}allStrings(){return this._toolbarItems.filter(e=>e.label).map(e=>e.label).concat([Object(k.langString)("pluginname","editor_weka")])}getParent(){return this._parent}_componentNodeView(e,t,n,i,o){return new h.default(e,{editor:this,node:n,view:i,getPos:o,parent:this._parent,context:t})}dispatch(e){const t=this.state.apply(e);this.view&&!this.destroyed&&this.view.updateState(t),this.state=t,this._value=_.default.fromState(t,this),this._options.onTransaction&&this._options.onTransaction({value:this._value,transaction:e}),e.docChanged&&!e.getMeta("preventUpdate")&&this._options.onUpdate&&this._options.onUpdate(this._value)}getFileStorageItemId(){return this.fileStorage.getFileStorageItemId()}_createPlugins(){let e=[];return Array.isArray(this._plugins)&&(e=this._plugins),e.concat(Object(c.inputRules)({rules:this._inputRules}),Object(a.keymap)(Object(p.buildKeymap)(this.schema,this._mapKeys)),Object(a.keymap)(s.baseKeymap),Object(l.dropCursor)(),Object(d.gapCursor)(),Object(r.history)())}getToolbarItems(){return this._toolbarItemInstances.forEach(e=>e.update(this)),this._toolbarItems}execute(e){try{return e(this.state,this.dispatch,this.view)}catch(e){console.error("[Weka] Failed to execute command."),console.error(e);const t=Object(k.langString)("error_failed_to_execute","editor_weka");return Object(k.loadLangStrings)([t]).then(()=>Object(v.notify)({type:"error",message:t.toString()})),!1}}canExecute(e){return e(this.state,null,null)}hasNode(e){return e in this.state.schema.nodes}destroy(){this.view&&this.view.destroy(),this.destroyed=!0}get identifier(){return{contextId:this._options.contextId||null,component:this._options.component||null,area:this._options.area||null,instanceId:this._options.instanceId||null}}get extensionFormatters(){return this._extensions.map(e=>e.applyFormatters.bind(e))}_execSerializedVisitors(e,t){const n=[];return this._extensions.forEach(e=>{const i=t+"SerializedVisitor";e[i]&&n.push(e[i]())}),n.length>0&&(e=JSON.parse(JSON.stringify(e)),n.forEach(t=>this._traverseNode(e,t))),e}_traverseNode(e,t){t[e.type]&&t[e.type](e),Array.isArray(e.content)&&e.content.forEach(e=>this._traverseNode(e,t))}}},"6RS6":function(e,t){e.exports=tui.require("editor_weka/components/nodes/Attachments")},"6gLU":function(e,t,n){var i={"./Weka":"NqIU","./Weka.vue":"NqIU","./attachments/AudioAttachment":"dRRP","./attachments/AudioAttachment.vue":"dRRP","./attachments/FileAttachment":"DOZ8","./attachments/FileAttachment.vue":"DOZ8","./attachments/ImageAttachment":"iFtU","./attachments/ImageAttachment.vue":"iFtU","./attachments/VideoAttachment":"d+14","./attachments/VideoAttachment.vue":"d+14","./editing/ActionDropdown":"T27E","./editing/ActionDropdown.vue":"T27E","./editing/EditImageAltTextModal":"XS2e","./editing/EditImageAltTextModal.vue":"XS2e","./editing/EditLinkModal":"j1Jf","./editing/EditLinkModal.vue":"j1Jf","./editing/EmojiSelector":"TZft","./editing/EmojiSelector.vue":"TZft","./editing/PositionedActionDropdown":"ENqZ","./editing/PositionedActionDropdown.vue":"ENqZ","./marks/Link":"52bL","./marks/Link.vue":"52bL","./nodes/Attachment":"WF6d","./nodes/Attachment.vue":"WF6d","./nodes/Attachments":"nhhl","./nodes/Attachments.vue":"nhhl","./nodes/AudioBlock":"av8V","./nodes/AudioBlock.vue":"av8V","./nodes/BaseNode":"TNgD","./nodes/BaseNode.vue":"TNgD","./nodes/Emoji":"AhbH","./nodes/Emoji.vue":"AhbH","./nodes/Hashtag":"fNlv","./nodes/Hashtag.vue":"fNlv","./nodes/ImageBlock":"7QQN","./nodes/ImageBlock.vue":"7QQN","./nodes/LinkBlock":"hFhO","./nodes/LinkBlock.vue":"hFhO","./nodes/LinkMedia":"gfQI","./nodes/LinkMedia.vue":"gfQI","./nodes/Mention":"DVbZ","./nodes/Mention.vue":"DVbZ","./nodes/VideoBlock":"ywTm","./nodes/VideoBlock.vue":"ywTm","./suggestion/Hashtag":"1mLp","./suggestion/Hashtag.vue":"1mLp","./suggestion/User":"9Dx/","./suggestion/User.vue":"9Dx/","./toolbar/NodeBar":"bo3x","./toolbar/NodeBar.vue":"bo3x","./toolbar/Toolbar":"WwJ/","./toolbar/Toolbar.vue":"WwJ/","./toolbar/ToolbarButton":"8NkA","./toolbar/ToolbarButton.vue":"8NkA","./toolbar/ToolbarButtonIcon":"0oIn","./toolbar/ToolbarButtonIcon.vue":"0oIn","./upload/ExtraFileUploadModal":"jqyG","./upload/ExtraFileUploadModal.vue":"jqyG","./upload/FilePicker":"Kbs0","./upload/FilePicker.vue":"Kbs0"};function o(e){var t=a(e);return n(t)}function a(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}o.keys=function(){return Object.keys(i)},o.resolve=a,e.exports=o,o.id="6gLU"},"6o14":function(e,t,n){"use strict";var i=n("Y6x/");n.n(i).a},"6zzx":function(e,t,n){},"7F6Z":function(e,t,n){"use strict";n.r(t);var i=n("GcJT"),o=n("22E+");t.default=function(e){return new i.Plugin({key:new i.PluginKey("text-placeholder"),props:{decorations({doc:t}){if(!e)return!1;if(1!==t.childCount||!t.firstChild.isTextblock)return!1;let n=[];return t.descendants((t,i)=>(t.type.isBlock&&0==t.childCount&&n.push(o.Decoration.node(i,i+t.nodeSize,{class:"tui-weka__placeholder","data-placeholder":e})),!0)),o.DecorationSet.create(t,n)}}})}},"7O4h":function(e,t,n){"use strict";var i=n("tIwH");n.n(i).a},"7QQN":function(e,t,n){"use strict";n.r(t);var i=n("iPZg"),o=n.n(i),a=n("tnXT"),r=n.n(a),s=n("hg2Q"),l=n("r4xq"),d=n.n(l),c=n("yHzl"),u=n.n(c),p=n("vF5l"),m=n.n(p),h=n("Mnur"),f=n.n(h),_={components:{Button:m.a,EditImageAltTextModal:u.a,ModalPresenter:f.a,ImageBlock:o.a,NodeBar:d.a},extends:r.a,apollo:{file:{query:s.a,variables(){return{filename:this.filename,item_id:this.itemId}},batch:!0}},data:()=>({file:{},showModal:!1}),computed:{hasAttachmentNode(){return this.context.hasAttachmentNode()},actions(){return[this.hasAttachmentNode&&{label:this.$str("display_as_attachment","editor_weka"),action:this.$_toAttachment},{label:this.altTextLabel,action:this.openModal},{label:this.$str("remove","core"),action:this.$_removeNode},{label:this.$str("download","core"),action:this.$_download}].filter(Boolean)},altTextLabel(){return this.altText?this.$str("edit_image_alt_text","editor_weka"):this.$str("add_image_alt_text","editor_weka")},altText(){return this.attrs.alttext},altTextButtonVisible(){return null===this.altText},filename(){return this.attrs.filename?this.attrs.filename:null},itemId(){return this.context.getItemId()}},methods:{$_toAttachment(){if(!this.context.replaceWithAttachment)return;const e={filename:this.filename,alttext:this.altText,size:this.file.file_size};this.context.replaceWithAttachment(this.getRange,e)},openModal(){this.showModal=!0},$_hideModal(){this.showModal=!1},$_updateAltText(e){this.$_hideModal();const t={filename:this.filename,alttext:e};this.context.updateImage(this.getRange,t)},$_removeNode(){return this.context.removeNode(this.getRange)},async $_download(){window.open(await this.context.getDownloadUrl(this.filename))},cancel(){null===this.altText?this.$_updateAltText(""):this.$_hideModal()}}},g=(n("lH1I"),n("KHd+")),v=function(e){e.options.__langStrings={core:["loadinghelp","remove","download"],editor_weka:["display_as_attachment","add_image_alt_text","edit_image_alt_text","actions_menu_for"]}},k=Object(g.a)(_,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaImageBlock"},[e.$apollo.loading?[n("p",{staticClass:"tui-wekaImageBlock__text"},[e._v("\n      "+e._s(e.$str("loadinghelp","core"))+"\n    ")])]:n("div",{staticClass:"tui-wekaImageBlock__inner"},[n("ModalPresenter",{attrs:{open:e.showModal},on:{"request-close":e.cancel}},[n("EditImageAltTextModal",{attrs:{value:e.altText},on:{change:e.$_updateAltText}})],1),e._v(" "),n("div",{staticClass:"tui-wekaImageBlock__positioner"},[n("ImageBlock",{attrs:{url:e.file.url,filename:e.filename,"alt-text":e.altText}}),e._v(" "),e.altTextButtonVisible?n("Button",{staticClass:"tui-wekaImageBlock__inner-addAltButton",attrs:{text:e.altTextLabel},on:{click:e.openModal}}):e._e()],1),e._v(" "),n("NodeBar",{attrs:{actions:e.actions,"aria-label":e.$str("actions_menu_for","editor_weka",e.filename)}})],1)],2)}),[],!1,null,null,null);"function"==typeof v&&v(k),k.options.__hasBlocks={script:!0,template:!0};t.default=k.exports},"7fvA":function(e,t,n){"use strict";n.r(t);var i=n("nEm4"),o=n.n(i),a=n("i/kK"),r=n.n(a),s=n("2wx7"),l=n.n(s),d=n("kkOl"),c=n.n(d),u=n("BN8m"),p=n.n(u),m=n("oMuj"),h=n.n(m),f=n("KRvX"),_=n.n(f),g=n("vF5l"),v=n.n(g),k={components:{Form:o.a,FormRow:r.a,Weka:l.a,ButtonGroup:p.a,InputText:h.a,Submit:_.a,Button:v.a},props:{defaultDoc:{type:String,default:""},instanceId:[String,Number],sesskey:{type:String,required:!0}},data(){return{content:null,itemId:this.instanceId}},computed:{documentValue(){return this.content?JSON.stringify(this.content.getDoc()):""},jsonPretty(){return this.content?JSON.stringify(this.content.getDoc(),void 0,2):""}},watch:{defaultDoc:{immediate:!0,handler(e){e&&(this.content=c.a.fromDoc(JSON.parse(e)))}},content(e){e&&(this.itemId=e.fileStorageItemId)}}},b=(n("GDyI"),n("KHd+")),y=function(e){e.options.__langStrings={editor_weka:["pluginname"],core:["cancel"]}},w=Object(b.a)(k,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaWithLearn"},[n("h3",{staticClass:"tui-wekaWithLearn__title"},[e._v("\n    "+e._s(e.$str("pluginname","editor_weka"))+"\n  ")]),e._v(" "),n("Form",{staticClass:"tui-wekaWithLearn__form",attrs:{method:"POST",action:e.$url("/lib/editor/weka/tests/fixtures/weka_with_learn.php",{sesskey:e.sesskey}),"input-width":"full",vertical:!0}},[n("FormRow",{staticClass:"tui-wekaWithLearn__formRow",attrs:{label:e.$str("pluginname","editor_weka")},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.id;return[n("Weka",{attrs:{id:i,"usage-identifier":{component:"editor_weka",area:"learn"},variant:"editor_weka-learn","instance-id":e.instanceId,"file-item-id":e.instanceId},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})]}}])}),e._v(" "),n("FormRow",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"tui-wekaWithLearn__formRow",attrs:{hidden:!0},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.id;return[n("InputText",{attrs:{id:i,name:"json_content",value:e.documentValue,hidden:!0}})]}}])}),e._v(" "),n("FormRow",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"tui-wekaWithLearn__formRow",attrs:{hidden:!0},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.id;return[n("InputText",{attrs:{id:i,name:"item_id",value:e.itemId,hidden:!0}})]}}])}),e._v(" "),n("ButtonGroup",{staticClass:"tui-wekaWithLearn__buttonGroup"},[n("Submit"),e._v(" "),n("Button",{attrs:{type:"submit",name:"cancel",value:"1",text:e.$str("cancel","core")}})],1)],1),e._v(" "),n("hr"),e._v(" "),n("pre",{staticClass:"tui-wekaWithLearn__code"},[e._v(e._s(e.jsonPretty))])],1)}),[],!1,null,null,null);"function"==typeof y&&y(w),w.options.__hasBlocks={script:!0,template:!0};t.default=w.exports},"7gPm":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return l}));var i=n("G709"),o=n("KY8K"),a=n("V68o"),r=n("1aB9"),s=n("vyVp");class l{constructor({contextId:e,itemId:t}){this.repositoryData=null,this.files={},this.itemId=null,t&&(this.itemId=t),this.contextId=e}get enabled(){return!!this.itemId}updateFileItemId(e){this.itemId=e}getContextId(){return this.contextId}setRepositoryData({repository_id:e,url:t,max_bytes:n}){this.repositoryData||(this.repositoryData={repositoryId:e,url:t,maxBytes:parseInt(n)})}async _fetchRepositoryData(){if(this.repositoryData)return;const{repository_id:e,url:t,max_bytes:n}=await Object(i.getRepositoryData)(this.contextId);this.setRepositoryData({repository_id:e,url:t,max_bytes:n})}getRepositoryData(){return this.repositoryData}getFileStorageItemId(){return this.itemId}addFile(){console.warn("[editor_weka] FileStorage.addFile had been deprecated and no longer used.")}async getFile(){return console.warn("[editor_weka] FileStorage.getFile had been deprecated ","please use FileStorage.getFileInfo instead"),null}async uploadFile(e,t){await this._fetchRepositoryData();const{repositoryId:n,url:i}=this.repositoryData,r=await Object(o.upload)({file:e,itemId:this.itemId,contextId:this.contextId,acceptTypes:t,repositoryId:n,url:i});if(r.id&&r.file)return await this.getFileInfo(r.file);if("fileexists"===r.event){const{newfile:{filename:e}}=r;return await this.getFileInfo(e)}let s=Object(a.langString)("invalid_response","editor_weka");throw await Object(a.loadLangStrings)([s]),new Error(s.toString())}async uploadFiles(e,t){if(0===(e=Object(o.parseFiles)(e)).length)return[];if(await this.checkFilesSizeExceed(e)){const e=await Object(r.getReadableSize)(this.repositoryData.maxBytes),t=Object(a.langString)("file_size_exceed","editor_weka",e);return await Object(a.loadLangStrings)([t]),await Object(s.notify)({type:"error",message:t.toString()}),[]}return Promise.all(e.map(e=>this.uploadFile(e,t)))}async checkFilesSizeExceed(e){if(await this._fetchRepositoryData(),!this.repositoryData.maxBytes)return!0;const{maxBytes:t}=this.repositoryData;return e.some(({size:e})=>e>t)}async getFileInfo(e){return Object(i.getDraftFile)({itemId:this.itemId,filename:e})}}},"7osU":function(e,t,n){"use strict";n.r(t);var i=n("GcJT"),o=n("/7YT");t.default=function(e,t,n){const a=new i.PluginKey("emojis");let r=!1;return new i.Plugin({key:a,appendTransaction(e,t,n){const{text:i,active:o,range:r,emoji:s}=a.getState(n);if(!i||!o)return null;const l=n.schema.node("emoji",{id:s.id,shortcode:s.shortcode});return n.tr.replaceWith(r.from,r.to,l)},state:{init:()=>({active:!1,range:{},text:null}),apply(e,n){const{selection:i}=e;let a=Object.assign({},n);if(a.active=!1,!r)return a;if(i.from===i.to){const e=function(e,t){if(!(e&&e instanceof o.ResolvedPos))return null;const n=e.doc.textBetween(e.start(),e.end(),"\0","\0");if(""===n)return null;if(!t)return null;let i,a;for(let o=0;o<t.length;++o){let r=t[o];if(""!==r.pattern)for(a=new RegExp(r.pattern,"g");i=a.exec(n);){let t=i.input.slice(Math.max(0,i.index-1),i.index);if(!/^[\s\0]?$/.test(t))continue;let n=i.index+e.start(),o=n+i[0].length;if(n<e.pos&&o>=e.pos)return{range:{from:n,to:o},text:i[0],emoji:r}}}return null}(i.$from,t);e&&(a.active=!0,a.range=e.range,a.text=e.text,a.emoji=e.emoji)}return a.active||(a.range={},a.text=null),a}},props:{handleKeyDown(e,t){r=n.find(e=>e===t.key)}}})}},"7rq0":function(e,t,n){"use strict";var i=n("DSd8");n.n(i).a},"8NkA":function(e,t,n){"use strict";n.r(t);var i=n("vF5l"),o={components:{Button:n.n(i).a},props:{text:{type:String,required:!0},selected:{type:Boolean,default:null},caret:Boolean,disabled:Boolean},computed:{ariaPressed(){return null==this.selected?null:this.selected?"true":"false"}}},a=(n("7rq0"),n("KHd+")),r=Object(a.a)(o,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("Button",{staticClass:"tui-wekaToolbarButton",class:{"tui-wekaToolbarButton--selected":e.selected},attrs:{"aria-label":e.text,"aria-pressed":e.ariaPressed,text:e.text,caret:e.caret,disabled:e.disabled},on:{click:function(t){return e.$emit("click",t)}}})}),[],!1,null,null,null);r.options.__hasBlocks={script:!0,template:!0};t.default=r.exports},"90QZ":function(e,t){e.exports=tui.require("tui/components/icons/ListUnordered")},"9Dx/":function(e,t,n){"use strict";n.r(t);var i=n("gLvT"),o=n.n(i),a=n("KGcv"),r=n.n(a),s={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"editor_weka_find_users_by_pattern"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"pattern"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_text"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contextid"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"component"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_component"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"area"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_area"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"instance_id"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"users"},name:{kind:"Name",value:"editor_weka_users_by_pattern"},arguments:[{kind:"Argument",name:{kind:"Name",value:"pattern"},value:{kind:"Variable",name:{kind:"Name",value:"pattern"}}},{kind:"Argument",name:{kind:"Name",value:"contextid"},value:{kind:"Variable",name:{kind:"Name",value:"contextid"}}},{kind:"Argument",name:{kind:"Name",value:"component"},value:{kind:"Variable",name:{kind:"Name",value:"component"}}},{kind:"Argument",name:{kind:"Name",value:"area"},value:{kind:"Variable",name:{kind:"Name",value:"area"}}},{kind:"Argument",name:{kind:"Name",value:"instance_id"},value:{kind:"Variable",name:{kind:"Name",value:"instance_id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"fullname"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"card_display"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profile_picture_alt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profile_picture_url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profile_url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"display_fields"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"value"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"is_custom"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"associate_url"},arguments:[],directives:[]}]}}]}}]}}]}}]},l=n("+MEP"),d=n.n(l),c=n("JXQf"),u=n.n(c),p={components:{Dropdown:o.a,DropdownItem:r.a,MiniProfileCard:d.a,Loader:u.a},props:{contextId:[Number,String],component:String,area:String,instanceId:[Number,String],location:{required:!0,type:Object},pattern:{required:!0,type:String}},apollo:{users:{query:s,fetchPolicy:"network-only",variables(){return{pattern:this.pattern,contextid:this.contextId,component:this.component,area:this.area,instance_id:this.instanceId}}}},data:()=>({users:[]}),computed:{positionStyle(){return{left:this.location.x+"px",top:this.location.y+"px"}},mentionOpen(){return this.$apollo.loading||this.users.length>0}},methods:{pickUser({id:e,fullname:t}){this.$emit("item-selected",{id:e,text:t})}}},m=(n("6o14"),n("KHd+")),h=function(e){e.options.__langStrings={editor_weka:["matching_users"]}},f=Object(m.a)(p,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.mentionOpen?n("div",{staticClass:"tui-wekaUserSuggestions",style:e.positionStyle},[n("Dropdown",{attrs:{separator:!0,open:e.mentionOpen,"inline-menu":!0},on:{dismiss:function(t){return e.$emit("dismiss")}}},[n("span",{staticClass:"sr-only"},[e._v("\n      "+e._s(e.$str("matching_users","editor_weka"))+":\n    ")]),e._v(" "),e.$apollo.loading?[n("DropdownItem",{attrs:{disabled:!0}},[n("Loader",{attrs:{loading:!0}})],1)]:e._e(),e._v(" "),e._l(e.users,(function(t,i){return n("DropdownItem",{key:i,attrs:{"no-padding":!0},on:{click:function(n){return e.pickUser(t)}}},[n("MiniProfileCard",{attrs:{"no-border":!0,display:t.card_display}})],1)}))],2)],1):e._e()}),[],!1,null,null,null);"function"==typeof h&&h(f),f.options.__hasBlocks={script:!0,template:!0};t.default=f.exports},"9G+f":function(e,t){e.exports=tui.require("tui/components/popover/Popover")},"9Mq8":function(e,t){e.exports=tui.require("editor_weka/components/upload/ExtraFileUploadModal")},"9Ovj":function(e,t){e.exports=tui.require("editor_weka/components/toolbar/ToolbarButton")},"9Wm2":function(e,t){e.exports=tui.require("editor_weka/components/marks/Link")},"9Y8s":function(e,t){e.exports=tui.require("tui/components/icons/Image")},"9cw/":function(e,t){e.exports=tui.require("editor_weka/components/nodes/LinkMedia")},"9iry":function(e,t){e.exports=tui.require("tui/vue_util")},"AL+t":function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/VideoBlock")},AT4M:function(e,t,n){"use strict";var i=n("eX2V");n.n(i).a},AhbH:function(e,t,n){"use strict";n.r(t);var i=n("QCX9"),o=n.n(i),a=n("tnXT"),r=n.n(a),s={components:{Emoji:o.a},extends:r.a,computed:{shortCode(){if(this.attrs.shortcode)return this.attrs.shortcode}}},l=n("KHd+"),d=Object(l.a)(s,(function(){var e=this.$createElement;return(this._self._c||e)("Emoji",{staticClass:"tui-wekaEmoji",attrs:{"short-code":this.shortCode}})}),[],!1,null,null,null);d.options.__hasBlocks={script:!0,template:!0};t.default=d.exports},AlIX:function(e,t,n){},AtFJ:function(e,t){e.exports=tui.require("editor_weka/components/nodes/AudioBlock")},B6jB:function(e,t,n){"use strict";n.r(t);var i=n("zJMb"),o=n("V68o"),a=n("cy56"),r=n("zTcH"),s=n("v+xu"),l=n("yrzs"),d=n.n(l),c=n("/+gN"),u=n.n(c);const p=["blockquote",0],m=["em",0],h=["strong",0],f=["h4","h5"];class _ extends i.default{nodes(){return{blockquote:{schema:{group:"block",content:"block+",parseDOM:[{tag:"blockquote"}],toDOM:()=>p}},heading:{schema:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:e=>["h"+e.attrs.level,0]},view(e){const t=Math.max(e.attrs.level,1)-1,n=f[t]||f[f.length-1],i=document.createElement(n);return{dom:i,contentDOM:i}}},hard_break:{schema:{group:"inline",parseDOM:[{tag:"br"}],toDOM:()=>["br"],inline:!0,selectable:!1}}}}marks(){return{em:{schema:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:()=>m}},strong:{schema:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:e=>"normal"!=e.style.fontWeight&&null},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],toDOM:()=>h}}}}toolbarItems(){const e=this.getSchema().nodes.paragraph,t=this.getSchema().nodes.heading,n=this.getSchema().marks.strong,i=this.getSchema().marks.em;return[Object(a.blockTypeItem)(e,{},{group:"blocks",label:Object(o.langString)("paragraph","editor")}),Object(a.blockTypeItem)(t,{attrs:{level:1}},{group:"blocks",label:Object(o.langString)("heading","editor")}),Object(a.blockTypeItem)(t,{attrs:{level:2}},{group:"blocks",label:Object(o.langString)("subheading","editor")}),Object(a.markItem)(n,{group:"text",label:Object(o.langString)("bold","editor"),iconComponent:d.a}),Object(a.markItem)(i,{group:"text",label:Object(o.langString)("italic","editor"),iconComponent:u.a})]}keymap(e){const{paragraph:t,blockquote:n,heading:i,hard_break:o}=this.getSchema().nodes,{strong:a,em:s}=this.getSchema().marks;e("Shift-Ctrl-0",Object(r.setBlockType)(t)),e("Ctrl->",Object(r.wrapIn)(n));for(let t=1;t<=6;t++)e("Shift-Ctrl-"+t,Object(r.setBlockType)(i,{level:t}));e("Shift-Enter",(e,t)=>(t(e.tr.replaceSelectionWith(o.create()).scrollIntoView()),!0)),e("Mod-b",Object(r.toggleMark)(a)),e("Mod-B",Object(r.toggleMark)(a)),e("Mod-i",Object(r.toggleMark)(s)),e("Mod-I",Object(r.toggleMark)(s))}inputRules(){const{blockquote:e,heading:t}=this.getSchema().nodes;return[s.ellipsis,(n=e,Object(s.wrappingInputRule)(/^\s*>\s$/,n)),g(t,6)];var n}}function g(e,t){return Object(s.textblockTypeInputRule)(new RegExp("^(#{1,"+t+"})\\s$"),e,e=>({level:e[1].length}))}t.default=e=>new _(e)},BN8m:function(e,t){e.exports=tui.require("tui/components/buttons/ButtonGroup")},CLKc:function(e,t,n){"use strict";n.r(t);var i=n("2wx7"),o={components:{Weka:n.n(i).a},props:{contextId:[Number,String]}},a=n("KHd+"),r=Object(a.a)(o,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tui-fixture-wekaBasic"},[t("Weka",{attrs:{"usage-identifier":{component:"editor_weka",area:"behat"},variant:"editor_weka-behat","context-id":this.contextId}})],1)}),[],!1,null,null,null);r.options.__hasBlocks={script:!0,template:!0};t.default=r.exports},CksW:function(e,t){e.exports=tui.require("ext_prosemirror/transform")},CvRQ:function(e,t,n){"use strict";n.r(t);var i=n("Y4vP"),o=n.n(i),a=n("zJMb"),r=n("dleW");class s extends a.default{nodes(){return{mention:{schema:{group:"inline",inline:!0,attrs:{type:{default:void 0},id:{default:void 0},display:{default:""}},parseDOM:[{tag:"span.tui-wekaNodeMention",getAttrs(e){try{return{type:JSON.parse(e.getAttribute("data-type")),id:JSON.parse(e.getAttribute("data-id")),display:e.textContent.trim().slice(1)}}catch(e){return{}}}}],toDOM:e=>["span",{class:"tui-wekaNodeMention","data-type":JSON.stringify(e.attrs.type),"data-id":JSON.stringify(e.attrs.id)},"@"+e.attrs.display]},component:o.a}}}plugins(){return[Object(r.default)(this.editor)]}}t.default=e=>new s(e)},"Cx/y":function(e,t){e.exports=tui.require("editor_weka/components/nodes/ImageBlock")},D2k2:function(e,t,n){},D3bS:function(e,t){e.exports=tui.require("editor_weka/components/attachments/ImageAttachment")},D7iR:function(e,t,n){"use strict";n.r(t),n.d(t,"findParentNode",(function(){return a})),n.d(t,"findParentNodeClosestToPos",(function(){return r})),n.d(t,"findParentDomRef",(function(){return s})),n.d(t,"hasParentNode",(function(){return l})),n.d(t,"findParentNodeOfType",(function(){return d})),n.d(t,"findParentNodeOfTypeClosestToPos",(function(){return c})),n.d(t,"hasParentNodeOfType",(function(){return u})),n.d(t,"findParentDomRefOfType",(function(){return p})),n.d(t,"findSelectedNodeOfType",(function(){return m})),n.d(t,"findPositionOfNodeBefore",(function(){return h})),n.d(t,"findDomRefAtPos",(function(){return f}));var i=n("GcJT"),o=n("Ko4C");const a=e=>({$from:t})=>r(t,e),r=(e,t)=>{for(let n=e.depth;n>0;n--){const i=e.node(n);if(t(i))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:i}}},s=(e,t)=>n=>{const i=a(e)(n);if(i)return f(i.pos,t)},l=e=>t=>!!a(e)(t),d=e=>t=>a(t=>Object(o.equalNodeType)(e,t))(t),c=(e,t)=>r(e,e=>Object(o.equalNodeType)(t,e)),u=e=>t=>l(t=>Object(o.equalNodeType)(e,t))(t),p=(e,t)=>n=>s(t=>Object(o.equalNodeType)(e,t),t)(n),m=e=>t=>{if(Object(o.isNodeSelection)(t)){const{node:n,$from:i}=t;if(Object(o.equalNodeType)(e,n))return{node:n,pos:i.pos,depth:i.depth}}},h=e=>{const{nodeBefore:t}=e.$from,n=i.Selection.findFrom(e.$from,-1);if(n&&t){const e=d(t.type)(n);return e?e.pos:n.$from.pos}},f=(e,t)=>{const n=t(e),i=n.node.childNodes[n.offset];return n.node.nodeType===Node.TEXT_NODE?n.node.parentNode:i&&i.nodeType!==Node.TEXT_NODE?i:n.node}},DOZ8:function(e,t,n){"use strict";n.r(t);var i=n("RNtj"),o=n.n(i),a=n("r4xq"),r=n.n(a),s=n("zK61"),l=n.n(s),d={components:{AttachmentNode:o.a,NodeBar:r.a},mixins:[l.a],computed:{actions(){let e=[{label:this.$str("remove","core"),action:()=>{this.$emit("delete")}}];return this.hasDownloadUrl&&e.push({label:this.$str("download","core"),action:()=>{this.$emit("download")}}),e}}},c=n("KHd+"),u=function(e){e.options.__langStrings={core:["remove","download"],editor_weka:["actions_menu_for"]}},p=Object(c.a)(d,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("AttachmentNode",{attrs:{filename:this.filename,"file-size":this.fileSize,"item-id":this.draftId,component:"user",area:"draft"}}),this._v(" "),t("NodeBar",{attrs:{actions:this.actions,"aria-label":this.$str("actions_menu_for","editor_weka",this.filename)}})],1)}),[],!1,null,null,null);"function"==typeof u&&u(p),p.options.__hasBlocks={script:!0,template:!0};t.default=p.exports},DSd8:function(e,t,n){},DVbZ:function(e,t,n){"use strict";n.r(t);var i=n("tnXT"),o=n.n(i),a=n("rqBY"),r={components:{Mention:n.n(a).a},extends:o.a,computed:{displayName(){let e=this.attrs;return e.display?e.display:""},userId(){let e=this.attrs;return e.id?e.id:0}}},s=(n("VSrT"),n("KHd+")),l=Object(s.a)(r,(function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"tui-wekaMention"},[t("Mention",{attrs:{"user-id":this.userId,fullname:this.displayName},nativeOn:{click:function(e){e.preventDefault()}}})],1)}),[],!1,null,null,null);l.options.__hasBlocks={script:!0,template:!0};t.default=l.exports},EBtw:function(e,t){e.exports=tui.require("editor_weka/components/suggestion/Hashtag")},ENqZ:function(e,t,n){"use strict";n.r(t);var i=n("ce8f"),o={components:{ActionDropdown:n.n(i).a},props:{location:{type:Object,validator:e=>"x"in e&&"y"in e},actions:Array},computed:{wrapperStyle(){return{position:"absolute",left:this.location.x+"px",top:this.location.y+"px"}}}},a=n("KHd+"),r=Object(a.a)(o,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{style:e.wrapperStyle},[n("ActionDropdown",{attrs:{actions:e.actions,open:!0},on:{dismiss:function(t){return e.$emit("dismiss")}},scopedSlots:e._u([{key:"trigger",fn:function(t){return[e._t("trigger",null,null,t)]}}],null,!0)})],1)}),[],!1,null,null,null);r.options.__hasBlocks={script:!0,template:!0};t.default=r.exports},EzMw:function(e,t){e.exports=tui.require("editor_weka/components/toolbar/ToolbarButtonIcon")},G709:function(e,t,n){"use strict";n.r(t),n.d(t,"getLinkMetadata",(function(){return l})),n.d(t,"getRepositoryData",(function(){return d})),n.d(t,"prepareDraftFileArea",(function(){return c})),n.d(t,"getMediaType",(function(){return u})),n.d(t,"getDraftFile",(function(){return p}));var i=n("UpZR"),o=n.n(i),a=n("kfFO"),r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"core_get_linkmetadata"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"url"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_url"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"link"},name:{kind:"Name",value:"core_get_linkmetadata"},arguments:[{kind:"Argument",name:{kind:"Name",value:"url"},value:{kind:"Variable",name:{kind:"Name",value:"url"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"PLAIN"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"PLAIN"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"videoheight"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"videowidth"},arguments:[],directives:[]}]}}]}}]},s=n("hg2Q");async function l(e){return(await o.a.query({query:r,variables:{url:e}})).data.link}async function d(e){const{data:{repository_data:t}}=await o.a.query({query:a.a,variables:{context_id:e},fetchPolicy:"no-cache"});return t}async function c(e=null){return console.warn("[editor_weka] The function prepareDraftFileArea had been deprecated, ","please use getRepositoryData instead"),d(e)}async function u({itemId:e,filename:t}){console.warn("[editor_weka] getMediaType had been deprecated, please use getDraftFile instead");const{media_type:n,mime_type:i}=await p({itemId:e,filename:t});return{mediaType:n,mimeType:i}}async function p({itemId:e,filename:t}){const{data:{file:n}}=await o.a.query({query:s.a,variables:{item_id:e,filename:t},batch:!0});return n}},GDyI:function(e,t,n){"use strict";var i=n("Qdyu");n.n(i).a},GcJT:function(e,t){e.exports=tui.require("ext_prosemirror/state")},GqWi:function(e,t){e.exports=tui.require("editor_weka/components/attachments/VideoAttachment")},"H/tB":function(e,t){e.exports=tui.require("tui/tui")},IBd2:function(e,t){e.exports=tui.require("tui/components/images/ResponsiveImage")},It5U:function(e,t,n){"use strict";var i=n("co/L");n.n(i).a},J1fj:function(e,t){e.exports=tui.require("tui/components/icons/Clear")},JXQf:function(e,t){e.exports=tui.require("tui/components/loading/Loader")},K5I0:function(e,t){e.exports=tui.require("editor_weka/api")},KGcv:function(e,t){e.exports=tui.require("tui/components/dropdown/DropdownItem")},"KHd+":function(e,t,n){"use strict";function i(e,t,n,i,o,a,r,s){var l,d="function"==typeof e?e.options:e;if(t&&(d.render=t,d.staticRenderFns=n,d._compiled=!0),i&&(d.functional=!0),a&&(d._scopeId="data-v-"+a),r?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),o&&o.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(r)},d._ssrRegister=l):o&&(l=s?function(){o.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:o),l)if(d.functional){d._injectStyles=l;var c=d.render;d.render=function(e,t){return l.call(t),c(e,t)}}else{var u=d.beforeCreate;d.beforeCreate=u?[].concat(u,l):[l]}return{exports:e,options:d}}n.d(t,"a",(function(){return i}))},KRvX:function(e,t){e.exports=tui.require("tui/components/buttons/Submit")},KY8K:function(e,t,n){"use strict";n.r(t),n.d(t,"UploadError",(function(){return c})),n.d(t,"parseFiles",(function(){return u})),n.d(t,"upload",(function(){return p})),n.d(t,"pickFiles",(function(){return m}));var i=n("12HA"),o=n("TGM/"),a=n.n(o),r=n("Wdod"),s=n.n(r),l=n("i7/w"),d=n.n(l);n("5vO2");class c extends Error{constructor(e){super(e),this.name="UploadError"}}function u(e){return Array.isArray(e)?e:Array.prototype.slice.call(e).filter(e=>e instanceof File)}async function p({file:e,repositoryId:t,itemId:n,contextId:o,acceptTypes:a,url:r}){return new Promise((s,l)=>{const d=new FormData,u=new XMLHttpRequest;d.append("repo_upload_file",e),d.append("title",e.name),d.append("sesskey",i.config.sesskey),d.append("repo_id",String(t)),d.append("itemid",String(n)),null!=o&&d.append("ctx_id",String(o)),a.forEach(e=>d.append("accepted_types[]",e)),u.addEventListener("readystatechange",()=>{if(4===u.readyState){if(200!==u.status)return void l(new Error("Response is not a 200 response"));let e=JSON.parse(u.responseText);if(e.error)return void l(new c(e.error));s(e)}}),u.open("POST",r,!0),u.send(d)})}async function m(e){const t=new(d.a.extend(s.a))({parent:e.getParent(),propsData:{autoTrigger:!0}}),n=a()("weka-file-picker");return setTimeout(()=>{n();const i=document.createElement("span");e.viewExtrasEl.appendChild(i),t.$mount(i)},0),new Promise(n=>{t.$on("picked-files",e=>{n(e)}),t.$on("dismiss",()=>{t.$destroy(),e.viewExtrasEl.removeChild(t.$el)})})}},Kbs0:function(e,t,n){"use strict";n.r(t);var i={props:{autoTrigger:{type:Boolean,default:!1},maxFiles:{type:[String,Number]}},computed:{multiple(){return 1!=this.maxFiles}},mounted(){this.autoTrigger&&(this.$_click(),this.$window.document.addEventListener("keyup",this.$_dismiss))},beforeDestroy(){this.$window.document.removeEventListener("keyup",this.$_dismiss)},methods:{$_pickFile(e){let t=[];e&&e.target&&e.target.files&&(t=e.target.files),this.$emit("picked-files",t),this.$emit("dismiss")},$_click(){this.$refs.fileInput&&this.$refs.fileInput.click()},$_dismiss(e){e&&"Escape"===e.key&&this.$emit("dismiss")}}},o=n("KHd+"),a=Object(o.a)(i,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"fileInput",attrs:{type:"file",multiple:this.multiple},on:{change:this.$_pickFile}})])}),[],!1,null,null,null);a.options.__hasBlocks={script:!0,template:!0};t.default=a.exports},Ko4C:function(e,t,n){"use strict";n.r(t),n.d(t,"isNodeSelection",(function(){return s})),n.d(t,"equalNodeType",(function(){return l})),n.d(t,"cloneTr",(function(){return d})),n.d(t,"replaceNodeAtPos",(function(){return c})),n.d(t,"canReplace",(function(){return u})),n.d(t,"removeNodeAtPos",(function(){return p})),n.d(t,"tableNodeTypes",(function(){return m})),n.d(t,"canInsert",(function(){return h})),n.d(t,"isEmptyParagraph",(function(){return f})),n.d(t,"findTableClosestToPos",(function(){return _})),n.d(t,"createCell",(function(){return g})),n.d(t,"transpose",(function(){return v})),n.d(t,"checkInvalidMovements",(function(){return k}));var i=n("GcJT"),o=n("/7YT"),a=n("VR8M"),r=n("D7iR");const s=e=>e instanceof i.NodeSelection,l=(e,t)=>Array.isArray(e)&&e.indexOf(t.type)>-1||t.type===e,d=e=>Object.assign(Object.create(e),e).setTime(Date.now()),c=(e,t)=>n=>{const i=n.doc.nodeAt(e),o=n.doc.resolve(e);if(u(o,t)){const o=(n=n.replaceWith(e,e+i.nodeSize,t)).selection.$from.pos-1;return n=Object(a.setTextSelection)(Math.max(o,0),-1)(n),n=Object(a.setTextSelection)(n.selection.$from.start())(n),d(n)}return n},u=(e,t)=>{const n=e.node(e.depth);return n&&n.type.validContent(t instanceof o.Fragment?t:o.Fragment.from(t))},p=e=>t=>{const n=t.doc.nodeAt(e);return d(t.delete(e,e+n.nodeSize))},m=e=>{if(e.cached.tableNodeTypes)return e.cached.tableNodeTypes;const t={};return Object.keys(e.nodes).forEach(n=>{const i=e.nodes[n];i.spec.tableRole&&(t[i.spec.tableRole]=i)}),e.cached.tableNodeTypes=t,t},h=(e,t)=>{const n=e.index();return t instanceof o.Fragment?e.parent.canReplace(n,n,t):t instanceof o.Node&&e.parent.canReplaceWith(n,n,t.type)},f=e=>!e||"paragraph"===e.type.name&&2===e.nodeSize,_=e=>Object(r.findParentNodeClosestToPos)(e,e=>e.type.spec.tableRole&&/table/i.test(e.type.spec.tableRole)),g=(e,t=null)=>t?e.createChecked(null,t):e.createAndFill(),v=e=>e[0].map((t,n)=>e.map(e=>e[n])),k=(e,t,n,i)=>{const o=`Target position is invalid, you can't move the ${i} ${e} to ${t}, the target can't be split. You could use tryToFit option.`;if(1===(e>t?-1:1)){if(-1!==n.slice(0,n.length-1).indexOf(t))throw new Error(o)}else if(-1!==n.slice(1).indexOf(t))throw new Error(o);return!0}},LAEe:function(e,t,n){"use strict";n.r(t),n.d(t,"pluginKey",(function(){return a})),n.d(t,"attachment",(function(){return r}));var i=n("GcJT");const o=Object.prototype.hasOwnProperty,a=new i.PluginKey("attachment");function r(e){const{onDrop:t,onKeyDown:n}=function(e){let t={};return["onDrop","onKeyDown"].forEach(n=>{o.call(e,n)&&"function"==typeof e[n]?t[n]=e[n]:t[n]=()=>!1}),t}(e);return new i.Plugin({key:a,state:{init:()=>({}),apply:()=>({})},props:{handleDOMEvents:{drop:(e,n)=>t({view:e,event:n})},handleKeyDown:(e,t)=>n({view:e,event:t})}})}},LqeG:function(e,t,n){"use strict";n.r(t);var i=n("zJMb"),o=n("cy56"),a=n("V68o"),r=n("KY8K"),s=n("Cx/y"),l=n.n(s),d=n("ta2K"),c=n.n(d),u=n("AtFJ"),p=n.n(u),m=n("9Y8s"),h=n.n(m),f=n("P4HX"),_=n("b7+R"),g=n("vyVp");class v extends i.default{constructor(e){super(e),this.acceptTypes=e.accept_types||[]}nodes(){return{image:{schema:{atom:!0,group:"block",inline:!1,selectable:!0,attrs:{filename:{default:void 0},url:{default:void 0},alttext:{default:void 0}},parseDOM:[{tag:"div.tui-wekaNodeImageBlock",getAttrs:_.getJsonAttrs},{tag:"div.tui-imageBlock",getAttrs:_.getJsonAttrs}],toDOM:e=>["div",{class:"tui-wekaNodeImageBlock","data-attrs":JSON.stringify({filename:e.attrs.filename,alttext:e.attrs.alttext,url:e.attrs.url})}]},component:l.a,componentContext:{replaceWithAttachment:this._replaceImageWithAttachment.bind(this),updateImage:this._updateImage.bind(this),hasAttachmentNode:this._hasAttachmentsNode.bind(this),removeNode:this.removeNode.bind(this),getItemId:this._getItemId.bind(this),getDownloadUrl:this._getDownloadUrl.bind(this)}},video:{schema:{atom:!0,group:"block",inline:!1,attrs:{filename:{default:void 0},url:{default:void 0},mime_type:{default:void 0},subtitle:{default:void 0}},parseDOM:[{tag:"div.tui-wekaNodeVideoBlock",getAttrs:_.getJsonAttrs},{tag:"div.tui-videoBlock",getAttrs:_.getJsonAttrs}],toDOM(e){let t={filename:e.attrs.filename,url:e.attrs.url,mime_type:e.attrs.mime_type,subtitle:e.attrs.subtitle};return["div",{class:"tui-wekaNodeVideoBlock","data-attrs":JSON.stringify(t)}]}},component:c.a,componentContext:{replaceWithAttachment:this._replaceVideoWithAttachment.bind(this),hasAttachmentNode:this._hasAttachmentNode.bind(this),removeNode:this.removeNode.bind(this),getFileUrl:()=>null,getItemId:this._getItemId.bind(this),getDownloadUrl:this._getDownloadUrl.bind(this),getContextId:this._getContextId.bind(this),updateVideoWithSubtitle:this._updateVideoWithSubtitle.bind(this)}},audio:{schema:{atom:!0,group:"block",inline:!1,attrs:{filename:{default:void 0},url:{default:void 0},mime_type:{default:void 0},transcript:{default:void 0}},parseDOM:[{tag:"div.tui-wekaNodeAudioBlock",getAttrs:_.getJsonAttrs},{tag:"div.tui-audioBlock",getAttrs:_.getJsonAttrs}],toDOM:e=>["div",{class:"tui-wekaNodeAudioBlock","data-attrs":JSON.stringify({filename:e.attrs.filename,url:e.attrs.url,mime_type:e.attrs.mime_type,transcript:e.attrs.transcript})}]},component:p.a,componentContext:{hasAttachmentNode:this._hasAttachmentNode.bind(this),replaceWithAttachment:this._replaceAudioWithAttachment.bind(this),removeNode:this.removeNode.bind(this),getFileUrl:()=>null,getItemId:this._getItemId.bind(this),getDownloadUrl:this._getDownloadUrl.bind(this),getContextId:this._getContextId.bind(this),updateAudioWithTranscript:this._updateAudioWithTranscript.bind(this)}}}}toolbarItems(){return this.editor.fileStorage.enabled?[new o.ToolbarItem({group:"embeds",label:Object(a.langString)("embedded_media","editor_weka"),iconComponent:h.a,execute:e=>{Object(r.pickFiles)(e).then(async e=>{e&&this._startUploading(e)})}})]:[]}async _startUploading(e){try{const t=await this.editor.fileStorage.uploadFiles(e,this.acceptTypes);if(0===t.length)return;const n=this.editor.state.schema,i=await Promise.all(t.map(({filename:e,url:t,media_type:i,mime_type:o})=>f.IMAGE===i?n.node("image",{filename:e,alttext:null,url:t}):f.VIDEO===i?n.node("video",{filename:e,url:t,mime_type:o,subtitle:null}):n.node("audio",{url:t,filename:e,mime_type:o,transcript:null})));this.editor.execute((e,t)=>{const o=e.tr,{selection:a}=o;if(this._hasAttachmentsNode()){const{attachments:e}=n.nodes;if(a.$from.parent&&e.name===a.$from.parent.type.name)return o.insert(o.selection.$from.after(),i),void t(o)}if(a.empty){let e=a.$from,t=e.parent;"paragraph"===t.type.name&&0===t.content.size?(o.replaceWith(e.before(),e.after(),i),this.editor.view.focus()):o.insert(e.pos,i)}else o.replaceWith(a.from,a.to,i);t(o)})}catch(e){if(console.error(e),e instanceof r.UploadError)Object(g.notify)({type:"error",message:e.message});else{const e=Object(a.langString)("error_upload_failed","editor_weka");Object(a.loadLangStrings)([e]).then(()=>Object(g.notify)({type:"error",message:e.toString()}))}}}async _replaceImageWithAttachment(e,{filename:t,alttext:n,size:i}){const o=await this._getFileInfo(t);this.editor.execute((a,r)=>{const s=a.tr,l=e();let d=a.schema.node("attachment",{filename:t,url:o.url,size:i,option:{alttext:n}});r(s.replaceWith(l.from,l.to,a.schema.node("attachments",null,[d])))})}async _replaceVideoWithAttachment(e,{filename:t,size:n,subtitle:i}){const o=await this._getFileInfo(t);this.editor.execute((a,r)=>{const s=a.tr,l=e();let d={filename:t,url:o.url,size:n,option:{}};i&&(d.option.subtitle={url:i.url,filename:i.filename});let c=a.schema.node("attachment",d);r(s.replaceWith(l.from,l.to,a.schema.node("attachments",null,[c])))})}async _updateVideoWithSubtitle(e,{filename:t,url:n,mime_type:i,subtitle:o}){this.editor.execute((a,r)=>{const s=a.tr,l=e();let d={filename:t,url:n,mime_type:i};d.subtitle=o?{filename:o.filename,url:o.url}:o;const c=a.schema.node("video",d);r(s.replaceWith(l.from,l.to,c))})}async _updateImage(e,{filename:t,alttext:n}){const i=await this._getFileInfo(t);this.editor.execute((o,a)=>{const r=o.tr,s=e();let l=o.schema.node("image",{filename:t,url:i.url,alttext:n});a(r.replaceWith(s.from,s.to,l)),this.editor.view.focus()})}async _replaceAudioWithAttachment(e,{filename:t,size:n,transcript:i}){const o=await this._getFileInfo(t);this.editor.execute((a,r)=>{const s=a.tr,l=e();let d={filename:t,url:o.url,size:n,option:{}};i&&(d.option.transcript={url:i.url,filename:i.filename});let c=a.schema.node("attachment",d);r(s.replaceWith(l.from,l.to,a.schema.node("attachments",null,[c])))})}async _updateAudioWithTranscript(e,{filename:t,url:n,mime_type:i,transcript:o}){this.editor.execute((a,r)=>{const s=a.tr,l=e();let d={filename:t,url:n,mime_type:i};o&&(d.transcript={filename:o.filename,url:o.url});let c=a.schema.node("audio",d);r(s.replaceWith(l.from,l.to,c))})}_hasAttachmentNode(){return this.editor.hasNode("attachment")}_hasAttachmentsNode(){return this.editor.hasNode("attachments")}async _getFileInfo(e){return this.editor.fileStorage.getFileInfo(e)}async _getDownloadUrl(e){return(await this._getFileInfo(e)).download_url}_getItemId(){return this.editor.fileStorage.getFileStorageItemId()}_getContextId(){return this.editor.identifier.contextId}}t.default=e=>new v(e)},MVvr:function(e,t,n){"use strict";n.r(t);var i=n("dB5e"),o=n("2wx7"),a=n.n(o),r=n("w52A");t.default={getComponent:()=>a.a,getProps:({contextId:e,config:t,fileItemId:n,placeholder:i,compact:o})=>({fileItemId:n,options:{context_id:e,extensions:t.extensions,files:null,repository_data:null,showtoolbar:t.showtoolbar},placeholder:i,compact:o}),rawToValue(e){if(!e)return r.default.empty();try{return r.default.fromDoc(JSON.parse(e))}catch(t){return console.error("Failed to parse Weka document"),console.log(e),console.error(t),r.default.empty()}},valueToRaw:e=>JSON.stringify(e.getDoc()),isContentEmpty:e=>e.isEmpty,getPreferredFormat:()=>i.Format.JSON_EDITOR,forceRecreate:!0}},Mnur:function(e,t){e.exports=tui.require("tui/components/modal/ModalPresenter")},NEm0:function(e,t){e.exports=tui.require("tui/components/form/Upload")},Nfo2:function(e,t){e.exports=tui.require("editor_weka/components/nodes/LinkBlock")},NqIU:function(e,t,n){"use strict";n.r(t);var i=n("H/tB"),o=n.n(i),a=n("TXEh"),r=n("TGM/"),s=n.n(r),l=n("5vO2"),d=n("z2s3"),c=n.n(d),u=n("V68o"),p={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"editor_weka_weka"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"component"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_component"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"area"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_area"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"instance_id"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"context_id"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"variant_name"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_alphaext"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"editor"},name:{kind:"Name",value:"editor_weka_editor"},arguments:[{kind:"Argument",name:{kind:"Name",value:"usage_identifier"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"component"},value:{kind:"Variable",name:{kind:"Name",value:"component"}}},{kind:"ObjectField",name:{kind:"Name",value:"area"},value:{kind:"Variable",name:{kind:"Name",value:"area"}}},{kind:"ObjectField",name:{kind:"Name",value:"instance_id"},value:{kind:"Variable",name:{kind:"Name",value:"instance_id"}}}]}},{kind:"Argument",name:{kind:"Name",value:"context_id"},value:{kind:"Variable",name:{kind:"Name",value:"context_id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"extensions"},arguments:[{kind:"Argument",name:{kind:"Name",value:"usage_identifier"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"component"},value:{kind:"Variable",name:{kind:"Name",value:"component"}}},{kind:"ObjectField",name:{kind:"Name",value:"area"},value:{kind:"Variable",name:{kind:"Name",value:"area"}}},{kind:"ObjectField",name:{kind:"Name",value:"instance_id"},value:{kind:"Variable",name:{kind:"Name",value:"instance_id"}}}]}},{kind:"Argument",name:{kind:"Name",value:"variant_name"},value:{kind:"Variable",name:{kind:"Name",value:"variant_name"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tuicomponent"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"context_id"},arguments:[],directives:[]}]}}]}}]},m={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"editor_weka_weka_nosession"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"component"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_component"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"area"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_area"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"instance_id"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"context_id"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"variant_name"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_alphaext"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"editor"},name:{kind:"Name",value:"editor_weka_editor"},arguments:[{kind:"Argument",name:{kind:"Name",value:"usage_identifier"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"component"},value:{kind:"Variable",name:{kind:"Name",value:"component"}}},{kind:"ObjectField",name:{kind:"Name",value:"area"},value:{kind:"Variable",name:{kind:"Name",value:"area"}}},{kind:"ObjectField",name:{kind:"Name",value:"instance_id"},value:{kind:"Variable",name:{kind:"Name",value:"instance_id"}}}]}},{kind:"Argument",name:{kind:"Name",value:"context_id"},value:{kind:"Variable",name:{kind:"Name",value:"context_id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"extensions"},arguments:[{kind:"Argument",name:{kind:"Name",value:"usage_identifier"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"component"},value:{kind:"Variable",name:{kind:"Name",value:"component"}}},{kind:"ObjectField",name:{kind:"Name",value:"area"},value:{kind:"Variable",name:{kind:"Name",value:"area"}}},{kind:"ObjectField",name:{kind:"Name",value:"instance_id"},value:{kind:"Variable",name:{kind:"Name",value:"instance_id"}}}]}},{kind:"Argument",name:{kind:"Name",value:"variant_name"},value:{kind:"Variable",name:{kind:"Name",value:"variant_name"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tuicomponent"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"context_id"},arguments:[],directives:[]}]}}]}}]},h=n("7gPm"),f=n("w52A"),_=n("9iry");const g=(e,t)=>JSON.stringify(t)==JSON.stringify(e),v=e=>Object(_.createImmutablePropWatcher)("Weka",e,g);var k={components:{Toolbar:c.a},props:{placeholder:{type:String,default:""},instanceId:[Number,String],fileItemId:[Number,String],contextId:[Number,String],component:String,area:String,usageIdentifier:{type:Object,validator:e=>"component"in e&&"area"in e,default(){return{component:this.component||"editor_weka",area:this.area||"learn",instanceId:this.instanceId}}},variant:String,options:{type:Object,validator:e=>void 0!==e.extensions},value:f.default,compact:Boolean,isLoggedIn:{type:Boolean,default:!0}},data(){return{toolbarItems:[],toolbarEnabled:!this.compact}},computed:{showToolbar(){return!this.compact&&this.toolbarItems.length>0}},watch:{value(e){this.displayedValue!==e&&(this.displayedValue=e||f.default.empty(),this.editor&&this.editor.setValue(this.displayedValue))},component:v("component"),area:v("area"),variant:v("variant"),instanceId:v("instanceId"),options:v("options"),fileItemId(e){this.editor&&this.isLoggedIn&&this.editor.updateFileItemId(e)}},created(){this.updateToolbarThrottled=Object(a.throttle)(this.updateToolbar,100),this.value?this.displayedValue=this.value:this.displayedValue=f.default.empty(),this.finalOptions=null},mounted(){this.component&&console.warn("The prop 'component' had been deprecated, please use 'usageIdentifier' instead"),this.area&&console.warn("The prop 'area' had been deprecated, please use 'usageIdentifier' instead"),this.instanceId&&console.warn("The prop 'instanceId' had been deprecated, please use 'usageIdentifier' instead"),this.createEditor()},beforeDestroy(){this.editor&&this.editor.destroy()},methods:{async setupOptions(){if(this.options)return void(this.finalOptions=Object.assign({},this.options));const e=await this.$apollo.query({query:this.isLoggedIn?p:m,fetchPolicy:"no-cache",variables:{instance_id:this.usageIdentifier.instanceId,component:this.usageIdentifier.component,area:this.usageIdentifier.area,context_id:this.contextId||void 0,variant_name:this.variant||`${this.usageIdentifier.component}-${this.usageIdentifier.area}`}});this.finalOptions=Object.assign({},e.data.editor)},async getExtensions(){await this.setupOptions();let e=[];return Array.isArray(this.finalOptions.extensions)&&(e=await Promise.all(this.finalOptions.extensions.map(({tuicomponent:e,options:t})=>{let n={};return null!=t&&(n="object"==typeof t?t:JSON.parse(t)),o.a.import(e).then(e=>o.a.defaultExport(e)(n))}))),e},getRepositoryData:async()=>(console.warn("[editor_weka] The function getRepositoryData had been deprecated and no longer used."),Promise.resolve(null)),getCurrentFiles:async()=>(console.warn("[editor_weka] The function getCurrentFiles had been deprecated and no longer used."),Promise.resolve([])),async createEditor(){if(this.editor)return;let e=s()("weka");const t=await this.getExtensions();let n=new h.default({itemId:this.fileItemId,contextId:this.finalOptions.context_id||null});this.editor=new l.default({value:this.displayedValue,placeholder:this.placeholder,parent:this,viewExtrasEl:this.$refs.extras,viewExtrasLiveEl:this.$refs.extrasLive,extensions:t,fileStorage:n,onUpdate:this.$_onUpdate.bind(this),contextId:this.finalOptions.context_id||null,component:this.usageIdentifier.component||null,area:this.usageIdentifier.area||null,instanceId:this.usageIdentifier.instanceId||null,onTransaction:()=>{this.updateToolbarThrottled()},onFocus:e=>{this.$emit("focus",e)},onBlur:e=>{this.$emit("blur",e)}});const i=this.editor.allVueComponents();await Promise.all([o.a.loadRequirements({components:i}),Object(u.loadLangStrings)(this.editor.allStrings())]),this.view=this.editor.createView(this.$refs.editorHost),this.updateToolbar(),e(),this.$emit("ready")},updateToolbar(){this.editor.destroyed||(this.toolbarItems=this.editor.getToolbarItems())},$_onUpdate(e){this.displayedValue=e,this.$emit("input",e)}}},b=(n("gTrn"),n("KHd+")),y=Object(b.a)(k,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-weka no-yui-ids",attrs:{id:e.uid}},[e.showToolbar?n("Toolbar",{attrs:{items:e.toolbarItems}}):e._e(),e._v(" "),n("div",{ref:"editorHost",staticClass:"tui-weka__editorHost tui-rendered",attrs:{"data-placeholder":e.placeholder}}),e._v(" "),n("div",{ref:"extras"}),e._v(" "),n("div",{ref:"extrasLive",attrs:{"aria-live":"polite",role:"status"}})],1)}),[],!1,null,null,null);y.options.__hasBlocks={script:!0,template:!0};t.default=y.exports},O5Oz:function(e,t){e.exports=tui.require("editor_weka/components/editing/EmojiSelector")},OWva:function(e,t){e.exports=tui.require("editor_weka/components/editing/PositionedActionDropdown")},OxlY:function(e,t){e.exports=tui.require("editor_weka/components/editing/EditLinkModal")},P4HX:function(e,t,n){"use strict";n.r(t),n.d(t,"IMAGE",(function(){return i})),n.d(t,"VIDEO",(function(){return o})),n.d(t,"AUDIO",(function(){return a}));const i="IMAGE",o="VIDEO",a="AUDIO"},PvNB:function(e,t){e.exports=tui.require("ext_prosemirror/gapcursor")},QCX9:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/Emoji")},Qdyu:function(e,t,n){},RNtj:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/AttachmentNode")},S8bZ:function(e,t){e.exports=tui.require("tui/components/errors/ErrorPageRender")},S8i7:function(e,t,n){"use strict";var i=n("cg4M");n.n(i).a},SIrR:function(e,t,n){!function(){"use strict";"undefined"!=typeof tui&&tui._bundle.isLoaded("editor_weka")?console.warn('[tui bundle] The bundle "editor_weka" is already loaded, skipping initialisation.'):(tui._bundle.register("editor_weka"),tui._bundle.addModulesFromContext("editor_weka",n("dxp4")),tui._bundle.addModulesFromContext("editor_weka/components",n("6gLU")),tui._bundle.addModulesFromContext("editor_weka/pages",n("j1CR")))}()},SeWd:function(e,t,n){"use strict";n.r(t),n.d(t,"buildKeymap",(function(){return s}));var i=n("zTcH"),o=n("XAXS"),a=n("v+xu");const r="undefined"!=typeof navigator&&/Mac/.test(navigator.platform);function s(e,t){let n={};function s(e,t){n[e]=t}s("Mod-z",o.undo),s("Shift-Mod-z",o.redo),s("Backspace",a.undoInputRule),r||s("Mod-y",o.redo),s("Alt-ArrowUp",i.joinUp),s("Alt-ArrowDown",i.joinDown),s("Mod-BracketLeft",i.lift),s("Escape",i.selectParentNode);const l={schema:e,isMac:r};return t.forEach(e=>{e(s,l)}),n}},T27E:function(e,t,n){"use strict";n.r(t);var i=n("gLvT"),o=n.n(i),a=n("3sQR"),r=n.n(a),s={components:{Dropdown:o.a,DropdownButton:r.a},props:{position:String,open:Boolean,actions:Array}},l=n("KHd+"),d=Object(l.a)(s,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Dropdown",{attrs:{position:e.position,open:e.open},on:{dismiss:function(t){return e.$emit("dismiss")}},scopedSlots:e._u([{key:"trigger",fn:function(t){return[e._t("trigger",null,null,t)]}}],null,!0)},[e._v(" "),e._t("dropdown-items",e._l(e.actions,(function(t,i){return n("DropdownButton",{key:i,on:{click:function(e){return e.preventDefault(),t.action()}}},[e._v("\n      "+e._s(t.label)+"\n    ")])})))],2)}),[],!1,null,null,null);d.options.__hasBlocks={script:!0,template:!0};t.default=d.exports},"TGM/":function(e,t){e.exports=tui.require("tui/pending")},TJfd:function(e,t,n){},TNgD:function(e,t,n){"use strict";n.r(t);var i={props:{nodeInfo:Object,contextInfo:Object,updateAttrs:Function,replaceWith:Function,getPos:Function,getRange:Function},computed:{node(){return this.nodeInfo.node},attrs(){return this.nodeInfo.node.attrs},context(){return this.contextInfo.context}}},o=n("KHd+"),a=Object(o.a)(i,void 0,void 0,!1,null,null,null);a.options.__hasBlocks={script:!0,template:!1};t.default=a.exports},TXEh:function(e,t){e.exports=tui.require("tui/util")},TZft:function(e,t,n){"use strict";n.r(t);var i=n("5h9J"),o=n.n(i),a=n("QCX9"),r=n.n(a),s={components:{ButtonIcon:o.a,Emoji:r.a},props:{emojis:{type:Array,required:!0,validator:e=>e.every(e=>"shortcode"in e)}},methods:{select(e){this.$emit("emoji-selected",e)},fromShortCode:e=>String.fromCodePoint("0x"+e)}},l=(n("oWLq"),n("KHd+")),d=Object(l.a)(s,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaEmojiSelector"},e._l(e.emojis,(function(t,i){return n("ButtonIcon",{key:i,attrs:{styleclass:{stealth:!0},"aria-label":e.fromShortCode(t.shortcode)},nativeOn:{click:function(n){return e.select(t)}}},[n("Emoji",{staticClass:"tui-wekaEmojiSelector__emoji",attrs:{"short-code":t.shortcode}})],1)})),1)}),[],!1,null,null,null);d.options.__hasBlocks={script:!0,template:!0};t.default=d.exports},TnOg:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return h}));var i=n("/7YT"),o=n("i7/w"),a=n.n(o),r=n("wq8e"),s=n("W9VI"),l=n("aBJ+"),d=n("mB48"),c=n("pynp"),u=n.n(c),p=n("V68o"),m=n("f/sT");class h{constructor(e){this._instance=null,this._editor=e,this._updatePosition=this._updatePosition.bind(this)}matcher(e,t){if(!(t&&t instanceof i.ResolvedPos))return null;const n=t.doc.textBetween(t.start(),t.pos,"\n","\0");if(""===n)return null;let o=e.exec(n);if(!o)return null;let a=o.index+t.start();return{range:{from:a,to:a+o[0].length},text:o[0]}}destroyInstance(){this._scrollableContainers&&(this._scrollableContainers.forEach(e=>e.removeEventListener("scroll",this._updatePosition)),this._scrollableContainers=null),window.removeEventListener("resize",this._updatePosition),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),null!==this._instance&&(this._instance.$destroy(),document.body.removeChild(this._instance.$el),this._instance=null)}resetComponent(){return console.warn("[editor_weka] The function Suggestion.resetComponent() had been deprecated, ","please do not use"),{apply:!1,text:"",from:0,to:0}}async showList({view:e,component:t,state:{range:n,text:i},callback:o}){o&&console.warn("[editor_weka] The fourth parameter of function Suggestion.showList(), ","had been deprecated, and no longer used"),null!==this._instance&&this.destroyInstance(),await Object(p.loadStrings)(Object(m.collectStrings)(t.component));const s=document.createElement("span");document.body.appendChild(s),this._view=e,this._range=n,this._location=a.a.observable(this._getLocation()),this._instance=new(a.a.extend(t.component))({parent:this._editor.getParent(),propsData:{location:this._location,pattern:i,area:this._editor.identifier.area||void 0,contextId:this._editor.identifier.contextId||void 0,component:this._editor.identifier.component||void 0,instanceId:this._editor.identifier.instanceId||void 0}}),this._instance.$mount(s),this._scrollableContainers=[];let l=Object(r.getClosestScrollable)(this._editor.viewExtrasLiveEl);for(;l;)this._scrollableContainers.push(l),l.addEventListener("scroll",this._updatePosition),l=Object(r.getClosestScrollable)(l.parentNode);this._scrollableContainers.push(document),document.addEventListener("scroll",this._updatePosition),window.addEventListener("resize",this._updatePosition),this._resizeObserver=new u.a(this._updatePosition),this._resizeObserver.observe(this._instance.$el),this._instance.$on("item-selected",({id:i,text:o})=>{this.destroyInstance();const a=this.getNode(e.state,t.name,t.attrs(i,o));this.convertToNode(n,a)}),this._instance.$on("dismiss",()=>{this.destroyInstance(),this._editor.view.focus()}),a.a.nextTick(this._updatePosition)}_updatePosition(){Object.assign(this._location,this._getLocation())}_getLocation(){const e=document.documentElement,t=Object(d.getBoundingClientRect)(document.body),n=this._view.coordsAtPos(this._range.from),i=l.Rect.fromPositions({left:n.left,top:n.top,right:n.right+1,bottom:n.bottom}).sub(t.getPosition()),o=new l.Rect(0,0,e.clientWidth,e.clientHeight).sub(t.getPosition()),a=Object(s.position)({position:["bottom","left"],ref:i,viewport:o,size:this._instance?new l.Size(this._instance.$el.offsetWidth,this._instance.$el.offsetHeight):new l.Size(50,50),padding:0});return{x:a.location.x,y:a.location.y}}getNode(e,t,n){return e.schema.node(t,n)}convertToNode(e,t){this._editor.execute((n,i)=>{i(this.createTransaction(n,e,t)),this._editor.view.focus()})}createTransaction(e,t,n){let i=e.tr;return i=i.replaceWith(t.from,t.to,n),i}apply(e,t,n,i){i&&console.warn("[editor_weka] The fourth parameter of function Suggestion.apply() had been deprecated ","and no longer needed. Please update all calls");const{selection:o}=e;let a=Object.assign({},t);if(o.from===o.to){const e=this.matcher(n,o.$from);if(e)return a.active=!0,a.range=e.range,a.text=e.text,a}return a.active=!1,a.range={},a.text=null,a}}},U9km:function(e,t,n){"use strict";n.r(t),n.d(t,"SetAttrsStep",(function(){return a})),n.d(t,"setAttrs",(function(){return r}));var i=n("/7YT"),o=n("CksW");class a extends o.Step{constructor(e,t){super(),this.pos=e,this.attrs=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return o.StepResult.fail("No node at given position");let n=t.type.create(this.attrs,i.Fragment.empty,t.marks),a=new i.Slice(i.Fragment.from(n),0,t.isLeaf?0:1);return o.StepResult.fromReplace(e,this.pos,this.pos+t.nodeSize,a)}invert(e){let t=e.nodeAt(this.pos);return new a(this.pos,t?t.attrs:null)}map(e){let t=e.mapResult(this.pos,1);return t.deleted?null:new a(t.pos,this.attrs)}toJSON(){return{stepType:"setAttrs",pos:this.pos,attrs:this.attrs}}static fromJSON(e,t){if("number"!=typeof t.pos||null!=t.attrs&&"object"!=typeof t.attrs)throw new RangeError("Invalid input for SetAttrsStep.fromJSON");return new a(t.pos,t.attrs)}}o.Step.jsonID("setAttrs",a);const r=(e,t)=>n=>n.step(new a(e,t))},UJXg:function(e,t){e.exports=tui.require("editor_weka/helpers/suggestion")},UpZR:function(e,t){e.exports=tui.require("tui/apollo_client")},UwCb:function(e,t,n){"use strict";n.r(t);var i=n("zJMb"),o=n("V68o"),a=n("cy56"),r=n("/uQ1"),s=n("YVua"),l=n("v+xu"),d=n("3qPy"),c=n.n(d),u=n("90QZ"),p=n.n(u);const m=["ol",0],h=["ul",0],f=["li",0];class _ extends i.default{nodes(){return{bullet_list:{schema:{content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM:()=>h}},ordered_list:{schema:{content:"list_item+",group:"block",attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs:e=>({order:e.hasAttribute("start")?+e.getAttribute("start"):1})}],toDOM:e=>1==e.attrs.order?m:["ol",{start:e.attrs.order},0]}},list_item:{schema:{content:"paragraph block*",parseDOM:[{tag:"li"}],toDOM:()=>f,defining:!0,draggable:!1}}}}toolbarItems(){const{bullet_list:e,ordered_list:t,list_item:n}=this.getSchema().nodes,i=[e,t];return[Object(a.cmdItem)(Object(r.toggleList)(e,n,i),{group:"text",label:Object(o.langString)("bulletlist","editor"),iconComponent:p.a,active:t=>Object(r.isListActive)(t.state,e)}),Object(a.cmdItem)(Object(r.toggleList)(t,n,i),{group:"text",label:Object(o.langString)("numberedlist","editor"),iconComponent:c.a,active:e=>Object(r.isListActive)(e.state,t)})]}keymap(e){const{bullet_list:t,ordered_list:n,list_item:i}=this.getSchema().nodes,o=[t,n];e("Shift-Ctrl-8",Object(r.toggleList)(t,i,o)),e("Shift-Ctrl-9",Object(r.toggleList)(n,i,o)),e("Enter",Object(s.splitListItem)(i)),e("Shift-Tab",Object(s.liftListItem)(i)),e("Tab",Object(s.sinkListItem)(i))}inputRules(){const{bullet_list:e,ordered_list:t}=this.getSchema().nodes;return[(n=e,Object(l.wrappingInputRule)(/^\s*([-+*])\s$/,n)),g(t)];var n}}function g(e){return Object(l.wrappingInputRule)(/^(\d+)\.\s$/,e,e=>({order:+e[1]}),(e,t)=>t.childCount+t.attrs.order==+e[1])}t.default=e=>new _(e)},V68o:function(e,t){e.exports=tui.require("tui/i18n")},VR8M:function(e,t,n){"use strict";n.r(t),n.d(t,"removeParentNodeOfType",(function(){return s})),n.d(t,"replaceParentNodeOfType",(function(){return l})),n.d(t,"removeSelectedNode",(function(){return d})),n.d(t,"replaceSelectedNode",(function(){return c})),n.d(t,"setTextSelection",(function(){return u})),n.d(t,"safeInsert",(function(){return h})),n.d(t,"setParentNodeMarkup",(function(){return f})),n.d(t,"selectParentNodeOfType",(function(){return _})),n.d(t,"removeNodeBefore",(function(){return g}));var i=n("GcJT"),o=n("/7YT"),a=n("D7iR"),r=n("Ko4C");const s=e=>t=>{const n=Object(a.findParentNodeOfType)(e)(t.selection);return n?Object(r.removeNodeAtPos)(n.pos)(t):t},l=(e,t)=>n=>{Array.isArray(e)||(e=[e]);for(let i=0,o=e.length;i<o;i++){const o=Object(a.findParentNodeOfType)(e[i])(n.selection);if(o){const e=Object(r.replaceNodeAtPos)(o.pos,t)(n);if(e!==n)return e}}return n},d=e=>{if(Object(r.isNodeSelection)(e.selection)){const t=e.selection.$from.pos,n=e.selection.$to.pos;return Object(r.cloneTr)(e.delete(t,n))}return e},c=e=>t=>{if(Object(r.isNodeSelection)(t.selection)){const{$from:n,$to:a}=t.selection;if(e instanceof o.Fragment&&n.parent.canReplace(n.index(),n.indexAfter(),e)||n.parent.canReplaceWith(n.index(),n.indexAfter(),e.type))return Object(r.cloneTr)(t.replaceWith(n.pos,a.pos,e).setSelection(new i.NodeSelection(t.doc.resolve(n.pos))))}return t},u=(e,t=1)=>n=>{const o=i.Selection.findFrom(n.doc.resolve(e),t,!0);return o?n.setSelection(o):n},p=e=>e.type&&e.type.spec.selectable,m=(e,t,n)=>(e=>p(e)&&e.type.isLeaf)(e)?n.setSelection(new i.NodeSelection(n.doc.resolve(t))):u(t)(n),h=(e,t,n)=>i=>{const o="number"==typeof t,{$from:a}=i.selection,s=o?i.doc.resolve(t):Object(r.isNodeSelection)(i.selection)?i.doc.resolve(a.pos+1):a,{parent:d}=s;if(Object(r.isNodeSelection)(i.selection)&&n){if(i!==(i=c(e)(i)))return i}if(Object(r.isEmptyParagraph)(d)){if(i!==(i=l(d.type,e)(i))){const t=p(e)?s.before(s.depth):s.pos;return m(e,t,i)}}if(Object(r.canInsert)(s,e)){i.insert(s.pos,e);const t=o?s.pos:p(e)?i.selection.$anchor.pos-1:i.selection.$anchor.pos;return Object(r.cloneTr)(m(e,t,i))}for(let t=s.depth;t>0;t--){const n=s.after(t),o=i.doc.resolve(n);if(Object(r.canInsert)(o,e))return i.insert(n,e),Object(r.cloneTr)(m(e,n,i))}return i},f=(e,t,n,i)=>o=>{const s=Object(a.findParentNodeOfType)(e)(o.selection);return s?Object(r.cloneTr)(o.setNodeMarkup(s.pos,t,Object.assign({},s.node.attrs,n),i)):o},_=e=>t=>{if(!Object(r.isNodeSelection)(t.selection)){const n=Object(a.findParentNodeOfType)(e)(t.selection);if(n)return Object(r.cloneTr)(t.setSelection(i.NodeSelection.create(t.doc,n.pos)))}return t},g=e=>{const t=Object(a.findPositionOfNodeBefore)(e.selection);return"number"==typeof t?Object(r.removeNodeAtPos)(t)(e):e}},VSrT:function(e,t,n){"use strict";var i=n("atKl");n.n(i).a},W9VI:function(e,t){e.exports=tui.require("tui/lib/popover")},WF6d:function(e,t,n){"use strict";n.r(t);var i=n("tnXT"),o=n.n(i),a=n("hg2Q"),r=n("P4HX"),s=n("D3bS"),l=n.n(s),d=n("+xcZ"),c=n.n(d),u=n("GqWi"),p=n.n(u),m=n("jHsM"),h=n.n(m),f={components:{ImageAttachment:l.a,FileAttachment:c.a,VideoAttachment:p.a,AudioAttachment:h.a},extends:o.a,apollo:{file:{query:a.a,variables(){return{item_id:this.itemId,filename:this.filename}}}},data:()=>({file:{}}),computed:{isImage(){return this.file&&this.file.media_type===r.IMAGE},isVideo(){return this.file&&this.file.media_type===r.VIDEO},isAudio(){return this.file&&this.file.media_type===r.AUDIO},itemId(){return this.context.getItemId()},filename(){const e=this.attrs;return e.filename?e.filename:this.$str("unknown_attachment","editor_weka")},option(){return this.attrs.option},hasImageNode(){return this.context.hasImageNode()},hasVideoNode(){return this.context.hasVideoNode()},hasAudioNode(){return this.context.hasAudioNode()},downloadUrl:()=>null},methods:{toImage(){const e={filename:this.filename,alttext:this.option.alttext||null};this.context.convertToImage(this.getRange,e)},updateAltText(e){this.$_updateNode({filename:this.filename,size:this.file?this.file.file_size:this.attrs.size,option:{alttext:e}})},$_updateNode(e){this.context.updateNode(this.getRange,e)},toVideo(){const e={filename:this.filename,mimeType:this.file.mime_type,subtitle:this.option.subtitle||null};this.context.convertToVideo(this.getRange,e)},toAudio(){const e={filename:this.filename,mimeType:this.file.mime_type,transcript:this.option.transcript||null};this.context.convertToAudio(this.getRange,e)},removeNode(){this.context.removeNode(this.getRange)},async download(){window.open(await this.context.getDownloadUrl(this.filename))}}},_=(n("AT4M"),n("KHd+")),g=function(e){e.options.__langStrings={editor_weka:["unknown_attachment"]}},v=Object(_.a)(f,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaAttachment"},[e.$apollo.loading?e._e():[e.isImage?n("ImageAttachment",{attrs:{"file-size":e.file?e.file.file_size:0,"draft-id":e.itemId,filename:e.filename,"alt-text":e.option.alttext||null,"enable-convert":e.hasImageNode,"has-download-url":!0},on:{"convert-to-embedded-media":e.toImage,"update-alt-text":e.updateAltText,delete:e.removeNode,download:e.download}}):e.isVideo?n("VideoAttachment",{attrs:{"file-size":e.file?e.file.file_size:0,"draft-id":e.itemId,filename:e.filename,"enable-convert":e.hasVideoNode,"has-download-url":!0},on:{"convert-to-embedded-media":e.toVideo,delete:e.removeNode,download:e.download}}):e.isAudio?n("AudioAttachment",{attrs:{"file-size":e.file?e.file.file_size:0,"draft-id":e.itemId,filename:e.filename,"enable-convert":e.hasAudioNode,"has-download-url":!0},on:{"convert-to-embedded-media":e.toAudio,delete:e.removeNode,download:e.download}}):n("FileAttachment",{attrs:{"file-size":e.file?e.file.file_size:0,filename:e.filename,"draft-id":e.itemId,"has-download-url":!0},on:{delete:e.removeNode,download:e.download}})]],2)}),[],!1,null,null,null);"function"==typeof g&&g(v),v.options.__hasBlocks={script:!0,template:!0};t.default=v.exports},Wdod:function(e,t){e.exports=tui.require("editor_weka/components/upload/FilePicker")},"WwJ/":function(e,t,n){"use strict";n.r(t);var i=n("36rR"),o=n("gLvT"),a=n.n(o),r=n("KGcv"),s=n.n(r),l=n("ixxs"),d=n.n(l),c=n("vF5l"),u=n.n(c),p=n("9Ovj"),m=n.n(p),h=n("EzMw"),f=n.n(h),_=n("9G+f"),g=n.n(_),v={components:{Dropdown:a.a,DropdownItem:s.a,ShowIcon:d.a,Button:u.a,ToolbarButton:m.a,ToolbarButtonIcon:f.a,Popover:g.a},props:{items:{type:Array}},computed:{activeBlockName(){const e=this.blockItems.find(e=>e.active);return e?e.label.toString():"Block"},blockSelectorEnabled(){return this.blockItems.some(e=>e.enabled)},blockItems(){return this.items.filter(e=>"blocks"==e.group)},itemGroups(){const e=this.items.filter(e=>"blocks"!=e.group),t={text:[],embeds:[]};return e.forEach(e=>{t[e.group]||(t[e.group]=[]),t[e.group].push(e)}),t}},methods:{itemClick(e){e.enabled&&e.execute&&e.execute()},openChanged(e,t){!t&&e.enabled&&e.reset&&e.reset()},handleButtonKeydown(e){const t=e.currentTarget;switch(e.key){case"ArrowLeft":case"Left":this.$_moveFocus(t,"prev");break;case"ArrowRight":case"Right":this.$_moveFocus(t,"next");break;case"Home":this.$_moveFocus(t,"first");break;case"End":this.$_moveFocus(t,"last");break;default:return}e.stopPropagation(),e.preventDefault()},handleButtonFocus(e){const t=e.currentTarget;this.$_getAllButtons().forEach(e=>{e.tabIndex=e==t?0:-1})},$_getAllButtons(){return Array.prototype.slice.call(this.$el.querySelectorAll(".tui-wekaToolbar__button"))},$_moveFocus(e,t){const n=Object(i.getTabbableElements)(this.$el),o=this.$_getAllButtons().filter(e=>n.includes(e)),a=o.length-1;let r=0;"prev"==t||"next"==t?(r=o.indexOf(e),-1==r?r="next"==t?a:0:(r+="next"==t?1:-1,r>a?r=0:r<0&&(r=a))):"first"==t?r=0:"last"==t&&(r=a),o[r]&&o[r].focus()}}},k=(n("It5U"),n("KHd+")),b=function(e){e.options.__langStrings={editor_weka:["format_as_blocktype_status","label_toolbar"]}},y=Object(k.a)(v,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaToolbar",attrs:{role:"toolbar","aria-label":e.$str("label_toolbar","editor_weka")}},[n("div",{staticClass:"tui-wekaToolbar__group"},[n("Dropdown",{attrs:{separator:!1},scopedSlots:e._u([{key:"trigger",fn:function(t){var i=t.toggle,o=t.isOpen;return[n("ToolbarButton",{staticClass:"tui-wekaToolbar__currentBlock tui-wekaToolbar__button",attrs:{text:e.activeBlockName,"aria-expanded":o?"true":"false","aria-label":e.$str("format_as_blocktype_status","editor_weka",e.activeBlockName),disabled:!e.blockSelectorEnabled,caret:""},on:{click:function(e){return i()}},nativeOn:{keydown:function(t){return e.handleButtonKeydown(t)},focus:function(t){return e.handleButtonFocus(t)}}})]}}])},[e._v(" "),e._l(e.blockItems,(function(t,i){return n("DropdownItem",{key:i,attrs:{selected:t.active,disabled:!t.active&&!t.enabled},on:{click:function(n){return e.itemClick(t)}}},[e._v("\n        "+e._s(t.label.toString())+"\n      ")])}))],2)],1),e._v(" "),e._l(e.itemGroups,(function(t,i){return n("div",{key:i,staticClass:"tui-wekaToolbar__group"},[e._l(t,(function(t,i){return[t.children?n("Dropdown",{key:i,attrs:{separator:!1},scopedSlots:e._u([{key:"trigger",fn:function(i){var o=i.toggle;return[n("ToolbarButtonIcon",{staticClass:"tui-wekaToolbar__button",attrs:{text:t.label.toString(),active:t.active,disabled:!t.enabled},on:{click:o},nativeOn:{keydown:function(t){return e.handleButtonKeydown(t)},focus:function(t){return e.handleButtonFocus(t)}}},[n("template",{slot:"icon"},[n(t.iconComponent,{tag:"component"})],1)],2)]}}],null,!0)},[e._v(" "),e._l(t.children,(function(t,i){return n("DropdownItem",{key:i,attrs:{disabled:!t.enabled},on:{click:function(n){return e.itemClick(t)}}},[n(t.iconComponent,{tag:"component"}),e._v("\n          "+e._s(t.label.toString())+"\n        ")],1)}))],2):t.popover?n("Popover",{key:i,attrs:{triggers:["click"],title:t.popover.title},on:{"open-changed":function(n){for(var i=arguments.length,o=Array(i);i--;)o[i]=arguments[i];return e.openChanged.apply(void 0,[t].concat(o))}},scopedSlots:e._u([{key:"trigger",fn:function(i){var o=i.isOpen;return[n("ToolbarButtonIcon",{staticClass:"tui-wekaToolbar__button",attrs:{text:t.label.toString(),selected:t.active,disabled:!t.enabled,"aria-haspopup":"true","aria-expanded":o?"true":"false"},nativeOn:{keydown:function(t){return e.handleButtonKeydown(t)},focus:function(t){return e.handleButtonFocus(t)}}},[n("template",{slot:"icon"},[n(t.iconComponent,{tag:"component"})],1)],2)]}},{key:"default",fn:function(e){var i=e.close;return[n(t.popover.component,{tag:"component",on:{close:i}})]}}],null,!0)}):n("ToolbarButtonIcon",{key:i,staticClass:"tui-wekaToolbar__button",attrs:{text:t.label.toString(),selected:t.active,disabled:!t.enabled},on:{click:function(n){return e.itemClick(t)}},nativeOn:{keydown:function(t){return e.handleButtonKeydown(t)},focus:function(t){return e.handleButtonFocus(t)}}},[n("template",{slot:"icon"},[n(t.iconComponent,{tag:"component"})],1)],2)]}))],2)}))],2)}),[],!1,null,null,null);"function"==typeof b&&b(y),y.options.__hasBlocks={script:!0,template:!0};t.default=y.exports},X5W2:function(e,t,n){"use strict";var i=n("6zzx");n.n(i).a},XAXS:function(e,t){e.exports=tui.require("ext_prosemirror/history")},XS2e:function(e,t,n){"use strict";n.r(t);var i=n("nEm4"),o=n.n(i),a=n("tkAW"),r=n.n(a),s=n("u5iS"),l=n.n(s),d=n("oMuj"),c=n.n(d),u=n("BN8m"),p=n.n(u),m=n("vF5l"),h=n.n(m),f=n("nXMa"),_=n.n(f),g={components:{Modal:r.a,ModalContent:l.a,Form:o.a,InputText:c.a,ButtonGroup:p.a,Button:h.a,ButtonCancel:_.a},props:{value:String},data(){return{innerValue:this.value}},computed:{modalTitle(){return this.value?this.$str("edit_image_alt_text","editor_weka"):this.$str("add_image_alt_text","editor_weka")}},methods:{confirm(){this.$emit("change",this.innerValue)}}},v=(n("laAb"),n("KHd+")),k=function(e){e.options.__langStrings={editor_weka:["add_image_alt_text","edit_image_alt_text","done","image_alt_help"]}},b=Object(v.a)(g,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Modal",{staticClass:"tui-wekaEditImageAltTextModal"},[n("ModalContent",{staticClass:"tui-wekaEditImageAltTextModal__content",attrs:{title:e.modalTitle}},[n("Form",{attrs:{"input-width":"full"},on:{submit:function(t){return t.preventDefault(),e.confirm(t)}}},[n("div",{staticClass:"tui-wekaEditImageAltTextModal__input"},[n("InputText",{attrs:{maxlength:120,"char-length":"full",autofocus:!0},model:{value:e.innerValue,callback:function(t){e.innerValue=t},expression:"innerValue"}}),e._v(" "),n("p",{staticClass:"tui-wekaEditImageAltTextModal__input-helpText"},[e._v("\n          "+e._s(e.$str("image_alt_help","editor_weka"))+"\n        ")])],1),e._v(" "),n("ButtonGroup",{staticClass:"tui-wekaEditImageAltTextModal__buttonGroup"},[n("Button",{attrs:{disabled:!e.innerValue,styleclass:{primary:"true"},text:e.$str("done","editor_weka")},on:{click:e.confirm}}),e._v(" "),n("ButtonCancel",{on:{click:function(t){return t.preventDefault(),e.$emit("request-close")}}})],1)],1)],1)],1)}),[],!1,null,null,null);"function"==typeof k&&k(b),b.options.__hasBlocks={script:!0,template:!0};t.default=b.exports},Y4vP:function(e,t){e.exports=tui.require("editor_weka/components/nodes/Mention")},"Y6x/":function(e,t,n){},YVua:function(e,t,n){"use strict";n.r(t),n.d(t,"wrapInList",(function(){return a})),n.d(t,"splitListItem",(function(){return r})),n.d(t,"liftListItem",(function(){return s})),n.d(t,"sinkListItem",(function(){return l}));var i=n("CksW"),o=n("/7YT");function a(e,t){return function(n,a){let{$from:r,$to:s}=n.selection,l=r.blockRange(s),d=!1,c=l;if(!l)return!1;if(l.depth>=2&&r.node(l.depth-1).type.compatibleContent(e)&&0==l.startIndex){if(0==r.index(l.depth-1))return!1;let e=n.doc.resolve(l.start-2);c=new o.NodeRange(e,e,l.depth),l.endIndex<l.parent.childCount&&(l=new o.NodeRange(r,n.doc.resolve(s.end(l.depth)),l.depth)),d=!0}let u=Object(i.findWrapping)(c,e,t,l);return!!u&&(a&&a(function(e,t,n,a,r){let s=o.Fragment.empty;for(let e=n.length-1;e>=0;e--)s=o.Fragment.from(n[e].type.create(n[e].attrs,s));e.step(new i.ReplaceAroundStep(t.start-(a?2:0),t.end,t.start,t.end,new o.Slice(s,0,0),n.length,!0));let l=0;for(let e=0;e<n.length;e++)n[e].type==r&&(l=e+1);let d=n.length-l,c=t.start+n.length-(a?2:0),u=t.parent;for(let n=t.startIndex,o=t.endIndex,a=!0;n<o;n++,a=!1)!a&&Object(i.canSplit)(e.doc,c,d)&&(e.split(c,d),c+=2*d),c+=u.child(n).nodeSize;return e}(n.tr,l,u,d,e).scrollIntoView()),!0)}}function r(e){return function(t,n){let{$from:a,$to:r,node:s}=t.selection;if(s&&s.isBlock||a.depth<2||!a.sameParent(r))return!1;let l=a.node(-1);if(l.type!=e)return!1;if(0==a.parent.content.size){if(2==a.depth||a.node(-3).type!=e||a.index(-2)!=a.node(-2).childCount-1)return!1;if(n){let i=o.Fragment.empty,r=a.index(-1)>0;for(let e=a.depth-(r?1:2);e>=a.depth-3;e--)i=o.Fragment.from(a.node(e).copy(i));i=i.append(o.Fragment.from(e.createAndFill()));let s=t.tr.replace(a.before(r?null:-1),a.after(-3),new o.Slice(i,r?3:2,2));s.setSelection(t.selection.constructor.near(s.doc.resolve(a.pos+(r?3:2)))),n(s.scrollIntoView())}return!0}let d=r.pos==a.end()?l.contentMatchAt(0).defaultType:null,c=t.tr.delete(a.pos,r.pos),u=d&&[null,{type:d}];return!!Object(i.canSplit)(c.doc,a.pos,2,u)&&(n&&n(c.split(a.pos,2,u).scrollIntoView()),!0)}}function s(e){return function(t,n){let{$from:a,$to:r}=t.selection,s=a.blockRange(r,t=>t.childCount&&t.firstChild.type==e);return!!s&&(!n||(a.node(s.depth-1).type==e?function(e,t,n,a){let r=e.tr,s=a.end,l=a.$to.end(a.depth);s<l&&(r.step(new i.ReplaceAroundStep(s-1,l,s,l,new o.Slice(o.Fragment.from(n.create(null,a.parent.copy())),1,0),1,!0)),a=new o.NodeRange(r.doc.resolve(a.$from.pos),r.doc.resolve(l),a.depth));return t(r.lift(a,Object(i.liftTarget)(a)).scrollIntoView()),!0}(t,n,e,s):function(e,t,n){let a=e.tr,r=n.parent;for(let e=n.end,t=n.endIndex-1,i=n.startIndex;t>i;t--)e-=r.child(t).nodeSize,a.delete(e-1,e+1);let s=a.doc.resolve(n.start),l=s.nodeAfter,d=0==n.startIndex,c=n.endIndex==r.childCount,u=s.node(-1),p=s.index(-1);if(!u.canReplace(p+(d?0:1),p+1,l.content.append(c?o.Fragment.empty:o.Fragment.from(r))))return!1;let m=s.pos,h=m+l.nodeSize;return a.step(new i.ReplaceAroundStep(m-(d?1:0),h+(c?1:0),m+1,h-1,new o.Slice((d?o.Fragment.empty:o.Fragment.from(r.copy(o.Fragment.empty))).append(c?o.Fragment.empty:o.Fragment.from(r.copy(o.Fragment.empty))),d?0:1,c?0:1),d?0:1)),t(a.scrollIntoView()),!0}(t,n,s)))}}function l(e){return function(t,n){let{$from:a,$to:r}=t.selection,s=a.blockRange(r,t=>t.childCount&&t.firstChild.type==e);if(!s)return!1;let l=s.startIndex;if(0==l)return!1;let d=s.parent,c=d.child(l-1);if(c.type!=e)return!1;if(n){let a=c.lastChild&&c.lastChild.type==d.type,r=o.Fragment.from(a?e.create():null),l=new o.Slice(o.Fragment.from(e.create(null,o.Fragment.from(d.type.create(null,r)))),a?3:1,0),u=s.start,p=s.end;n(t.tr.step(new i.ReplaceAroundStep(u-(a?3:1),p,u,p,l,1,!0)).scrollIntoView())}return!0}}},Z5hI:function(e,t){e.exports=tui.require("tui/components/icons/HorizontalRule")},"aBJ+":function(e,t){e.exports=tui.require("tui/geometry")},aLSn:function(e,t,n){"use strict";n.r(t);var i=n("zJMb"),o=n("cy56"),a=n("V68o"),r=n("O5Oz"),s=n.n(r),l=n("fRht"),d=n.n(l),c=n("zyVY"),u=n.n(c),p=n("i7/w"),m=n.n(p),h=n("7osU"),f=n("b7+R");class _ extends i.default{constructor(e){super(e),void 0===e&&(e={}),this.emojis=e.emojis||[];let t=this.emojis.map(e=>e.pattern);this.charArray=t.toString().split(""),this.charArray=this.charArray.filter((e,t)=>this.charArray.indexOf(e)===t)}nodes(){return{emoji:{schema:{group:"inline",inline:!0,attrs:{shortcode:{default:""}},parseDOM:[{tag:"span.tui-wekaNodeEmoji",getAttrs:f.getJsonAttrs}],toDOM:e=>["span",{class:"tui-wekaNodeEmoji","data-attrs":JSON.stringify({shortcode:e.attrs.shortcode})},String.fromCodePoint("0x"+e.attrs.shortcode)]},component:d.a}}}plugins(){return[Object(h.default)(this.editor,this.emojis,this.charArray)]}toolbarItems(){return[new o.ToolbarItem({group:"embeds",popover:{title:"",component:this.getEmojiPopover()},label:Object(a.langString)("insertemoji","editor"),iconComponent:u.a,enabled:e=>e.view.state.selection.$head.pos>0,reset:e=>{e.view.focus()}})]}getEmojiPopover(){return m.a.extend({data:()=>({insertEmoji:this.insertEmoji.bind(this),emojiData:this.emojis}),methods:{emojiSelected(e){this.$emit("close"),this.insertEmoji(e)}},render(e){return e(s.a,{props:{emojis:this.emojiData},on:{"emoji-selected":this.emojiSelected}})}})}insertEmoji({shortcode:e}){this.editor.execute((t,n)=>{const i=t.schema.node("emoji",{shortcode:e}),{from:o,to:a}=t.selection;n(t.tr.replaceWith(o,a,i)),this.editor.view.focus()})}}t.default=e=>new _(e)},aaOI:function(e,t,n){"use strict";n.r(t),t.default={props:{filename:{type:String,required:!0},fileSize:{type:[String,Number],required:!0},draftId:{type:[String,Number],required:!0},hasDownloadUrl:Boolean}}},atKl:function(e,t,n){},av8V:function(e,t,n){"use strict";n.r(t);var i=n("00Pk"),o=n.n(i),a=n("tnXT"),r=n.n(a),s=n("hg2Q"),l=n("r4xq"),d=n.n(l),c=n("Mnur"),u=n.n(c),p=n("9Mq8"),m=n.n(p),h=n("vF5l"),f={components:{Button:n.n(h).a,CoreAudioBlock:o.a,NodeBar:d.a,ModalPresenter:u.a,ExtraFileUploadModal:m.a},extends:r.a,apollo:{file:{query:s.a,variables(){return{item_id:this.itemId,filename:this.filename}}}},data:()=>({file:{},showModal:!1}),computed:{actions(){return[this.hasAttachmentNode&&{label:this.$str("display_as_attachment","editor_weka"),action:this.$_toAttachment},{label:this.$str("upload_transcript","editor_weka"),action:this.openModal},{label:this.$str("remove","core"),action:this.$_removeNode},{label:this.$str("download","core"),action:this.$_download}].filter(Boolean)},itemId(){return this.context.getItemId()},contextId(){if(!this.context.getContextId)throw new Error("No function 'getContextId' was found from extension");return this.context.getContextId()},filename(){return this.attrs.filename?this.attrs.filename:null},transcriptFilename(){return this.attrs.transcript?this.attrs.transcript.filename:null},transcriptUrl(){return this.attrs.transcript?this.attrs.transcript.url:null},hasAttachmentNode(){return this.context.hasAttachmentNode()},transcriptButtonVisible(){return null===this.attrs.transcript}},methods:{$_removeNode(){return this.context.removeNode(this.getRange)},$_toAttachment(){if(!this.context.replaceWithAttachment)return;const e={filename:this.filename,size:this.file.file_size,transcript:this.attrs.transcript||null};this.context.replaceWithAttachment(this.getRange,e)},async $_download(){window.open(await this.context.getDownloadUrl(this.filename))},openModal(){this.showModal=!0},hideModal(){this.showModal=!1},cancel(){null===this.transcriptFilename?this.updateTranscript(""):this.hideModal()},onTranscriptChange(e){this.updateTranscript(e||"")},async updateTranscript(e){if(this.hideModal(),!this.context.updateAudioWithTranscript)return;const t=Object.assign({},this.attrs,{transcript:e});e&&(t.transcript={filename:e.filename,url:e.url}),this.context.updateAudioWithTranscript(this.getRange,t)}}},_=(n("S8i7"),n("KHd+")),g=function(e){e.options.__langStrings={core:["remove","download"],editor_weka:["audio_alt_help","display_as_attachment","actions_menu_for","upload_caption_transcript_button","upload_audio_transcript","upload_transcript","transcript_modal_title_help"]}},v=Object(_.a)(f,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaAudioBlock"},[e.$apollo.loading?e._e():[n("div",{staticClass:"tui-wekaAudioBlock__inner"},[n("ModalPresenter",{attrs:{open:e.showModal},on:{"request-close":e.cancel}},[n("ExtraFileUploadModal",{attrs:{"item-id":e.itemId,"context-id":e.contextId,"accepted-file-types":[".txt"],"modal-title":e.$str("upload_audio_transcript","editor_weka"),"modal-title-help-text":e.$str("transcript_modal_title_help","editor_weka"),"submit-button-text":e.$str("upload_caption_transcript_button","editor_weka",".txt"),"modal-help-text":e.$str("audio_alt_help","editor_weka"),filename:e.transcriptFilename},on:{change:e.onTranscriptChange}})],1),e._v(" "),e.transcriptButtonVisible?n("Button",{staticClass:"tui-wekaAudioBlock__inner-addtranscriptButton",attrs:{text:e.$str("upload_transcript","editor_weka")},on:{click:e.openModal}}):e._e(),e._v(" "),n("CoreAudioBlock",{attrs:{filename:e.filename,"item-id":e.itemId,url:e.file.url,"mime-type":e.file.mime_type,"transcript-url":e.transcriptUrl}},[n("template",{slot:"actions"},[n("NodeBar",{attrs:{actions:e.actions,"aria-label":e.$str("actions_menu_for","editor_weka",e.filename)}})],1)],2)],1)]],2)}),[],!1,null,null,null);"function"==typeof g&&g(v),v.options.__hasBlocks={script:!0,template:!0};t.default=v.exports},"b7+R":function(e,t,n){"use strict";function i(e){try{return JSON.parse(e.getAttribute("data-attrs"))}catch(e){return{}}}function o(e){return t=>{const n={};return e.forEach(e=>{const i=t.getAttribute(e);n[e]=null==i?void 0:i}),n}}n.r(t),n.d(t,"getJsonAttrs",(function(){return i})),n.d(t,"attrGetter",(function(){return o}))},bJQT:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/AttachmentNodeCollection")},bo3x:function(e,t,n){"use strict";n.r(t);var i=n("ce8f"),o=n.n(i),a=n("5h9J"),r=n.n(a),s=n("sxi1"),l=n.n(s),d={components:{ActionDropdown:o.a,ButtonIcon:r.a,More:l.a},props:{actions:{type:Array,required:!0},ariaLabel:String}},c=(n("X5W2"),n("KHd+")),u=function(e){e.options.__langStrings={editor_weka:["more_items"]}},p=Object(c.a)(d,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaNodeBar"},[n("ActionDropdown",{attrs:{position:"bottom-right",actions:e.actions},scopedSlots:e._u([{key:"trigger",fn:function(t){var i=t.toggle,o=t.isOpen;return[n("ButtonIcon",{attrs:{styleclass:{small:!0,transparent:!0},"aria-expanded":o?"true":"false","aria-label":e.ariaLabel?e.ariaLabel:e.$str("more_items","editor_weka"),"data-weka-more":!0},on:{click:i}},[n("More")],1)]}}])})],1)}),[],!1,null,null,null);"function"==typeof u&&u(p),p.options.__hasBlocks={script:!0,template:!0};t.default=p.exports},ce8f:function(e,t){e.exports=tui.require("editor_weka/components/editing/ActionDropdown")},cg4M:function(e,t,n){},"co/L":function(e,t,n){},cy56:function(e,t,n){"use strict";n.r(t),n.d(t,"ToolbarItem",(function(){return o})),n.d(t,"cmdItem",(function(){return a})),n.d(t,"markItem",(function(){return r})),n.d(t,"blockTypeItem",(function(){return s}));var i=n("zTcH");class o{constructor(e){this._opts=e,this._editor=null,this._def={group:e.group,label:e.label,iconComponent:e.iconComponent,enabled:!0,active:null,children:e.children&&e.children.map(e=>e.getDef()),popover:e.popover,execute:()=>e.execute(this._editor),reset:()=>e.reset(this._editor)}}update(e){const{_def:t,_opts:n}=this;return this._editor=e,t.enabled=void 0===n.enabled||n.enabled(e),t.active=null!=n.active?n.active(e):null,n.children&&n.children.forEach(t=>t.update(e)),Object.assign({},t)}getDef(){return this._def}}function a(e,t){return new o(Object.assign({enabled:t=>t.canExecute(e),execute:t=>{t.view.focus(),t.execute(e)}},t))}function r(e,t){t=Object.assign({active:t=>function(e,t){let{from:n,$from:i,to:o,empty:a}=e.selection;return a?!!t.isInSet(e.storedMarks||i.marks()):!!e.doc.rangeHasMark(n,o,t)}(t.state,e)},t);return a(Object(i.toggleMark)(e),t)}function s(e,t,n){n=Object.assign({active(n){let{$from:i,to:o,node:a}=n.state.selection;return a&&a.isTextblock?a.hasMarkup(e,t.attrs):o<=i.end()&&i.parent.hasMarkup(e,t.attrs)}},n);return a(Object(i.setBlockType)(e,t.attrs),n)}},"d+14":function(e,t,n){"use strict";n.r(t);var i=n("RNtj"),o=n.n(i),a=n("r4xq"),r=n.n(a),s=n("zK61"),l=n.n(s),d={components:{NodeBar:r.a,AttachmentNode:o.a},mixins:[l.a],props:{enableConvert:{type:Boolean,default:!0}},computed:{actions(){let e=[];return this.enableConvert&&e.push({label:this.$str("display_as_embedded_media","editor_weka"),action:()=>{this.$emit("convert-to-embedded-media")}}),e=e.concat([{label:this.$str("remove","core"),action:()=>{this.$emit("delete")}}]),this.hasDownloadUrl&&e.push({label:this.$str("download","core"),action:()=>{this.$emit("download")}}),e}}},c=n("KHd+"),u=function(e){e.options.__langStrings={editor_weka:["display_as_embedded_media","actions_menu_for"],core:["remove","download"]}},p=Object(c.a)(d,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("AttachmentNode",{attrs:{filename:this.filename,"file-size":this.fileSize,"item-id":this.draftId,component:"user",area:"draft"}}),this._v(" "),t("NodeBar",{attrs:{actions:this.actions,"aria-label":this.$str("actions_menu_for","editor_weka",this.filename)}})],1)}),[],!1,null,null,null);"function"==typeof u&&u(p),p.options.__hasBlocks={script:!0,template:!0};t.default=p.exports},dB5e:function(e,t){e.exports=tui.require("tui/editor")},dRRP:function(e,t,n){"use strict";n.r(t);var i=n("RNtj"),o=n.n(i),a=n("r4xq"),r=n.n(a),s=n("zK61"),l=n.n(s),d={components:{AttachmentNode:o.a,NodeBar:r.a},mixins:[l.a],props:{enableConvert:{type:Boolean,default:!0}},computed:{actions(){let e=[];return this.enableConvert&&e.push({label:this.$str("display_as_embedded_media","editor_weka"),action:()=>{this.$emit("convert-to-embedded-media")}}),e=e.concat([{label:this.$str("remove","core"),action:()=>{this.$emit("delete")}}]),this.hasDownloadUrl&&e.push({label:this.$str("download","core"),action:()=>{this.$emit("download")}}),e}}},c=n("KHd+"),u=function(e){e.options.__langStrings={core:["remove","download"],editor_weka:["display_as_embedded_media","actions_menu_for"]}},p=Object(c.a)(d,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("AttachmentNode",{attrs:{filename:this.filename,"file-size":this.fileSize,"item-id":this.draftId,component:"user",area:"draft"}}),this._v(" "),t("NodeBar",{attrs:{actions:this.actions,"aria-label":this.$str("actions_menu_for","editor_weka",this.filename)}})],1)}),[],!1,null,null,null);"function"==typeof u&&u(p),p.options.__hasBlocks={script:!0,template:!0};t.default=p.exports},daNz:function(e,t){e.exports=tui.require("ext_prosemirror/keymap")},dleW:function(e,t,n){"use strict";n.r(t);var i=n("TXEh"),o=n("GcJT"),a=n("TnOg"),r=n("+pLW"),s=n.n(r);t.default=function(e){const t=new o.PluginKey("mentions");let n=new a.default(e);const r=new RegExp("@[^@\\s]+$","g");return new o.Plugin({key:t,view(){return{update:Object(i.debounce)(e=>{const{text:t,active:i,range:o}=this.key.getState(e.state);n.destroyInstance(),t&&i&&n.showList({view:e,component:{name:"mention",component:s.a,attrs:(e,t)=>({id:e,display:t})},state:{text:t.slice(1),active:i,range:o}})},250)}},state:{init:()=>({active:!1,range:{},text:null}),apply:(e,t)=>(r.lastIndex=0,n.apply(e,t,r))},props:{handleKeyDown(e,t){if("Escape"===t.key){const{active:t}=this.getState(e.state);return!!t&&(n.destroyInstance(),e.focus(),!0)}}}})}},dxp4:function(e,t,n){var i={"./ComponentView":"vFxO","./ComponentView.js":"vFxO","./Editor":"5vO2","./Editor.js":"5vO2","./WekaValue":"w52A","./WekaValue.js":"w52A","./api":"G709","./api.js":"G709","./extensions/Base":"zJMb","./extensions/Base.js":"zJMb","./extensions/attachment":"w4Gt","./extensions/attachment.js":"w4Gt","./extensions/emoji":"aLSn","./extensions/emoji.js":"aLSn","./extensions/hashtag":"hRV1","./extensions/hashtag.js":"hRV1","./extensions/link":"gCcX","./extensions/link.js":"gCcX","./extensions/list":"UwCb","./extensions/list.js":"UwCb","./extensions/media":"LqeG","./extensions/media.js":"LqeG","./extensions/mention":"CvRQ","./extensions/mention.js":"CvRQ","./extensions/ruler":"zPke","./extensions/ruler.js":"zPke","./extensions/text":"B6jB","./extensions/text.js":"B6jB","./extensions/util":"b7+R","./extensions/util.js":"b7+R","./helpers/editor":"kS2v","./helpers/editor.js":"kS2v","./helpers/file":"7gPm","./helpers/file.js":"7gPm","./helpers/media":"P4HX","./helpers/media.js":"P4HX","./helpers/mention":"nyAV","./helpers/mention.js":"nyAV","./helpers/suggestion":"TnOg","./helpers/suggestion.js":"TnOg","./integration":"jknM","./integration.js":"jknM","./interface":"MVvr","./interface.js":"MVvr","./keymap":"SeWd","./keymap.js":"SeWd","./lib/prosemirror_schema_list/schema_list":"YVua","./lib/prosemirror_schema_list/schema_list.js":"YVua","./lib/prosemirror_utils/helpers":"Ko4C","./lib/prosemirror_utils/helpers.js":"Ko4C","./lib/prosemirror_utils/selection":"D7iR","./lib/prosemirror_utils/selection.js":"D7iR","./lib/prosemirror_utils/transforms":"VR8M","./lib/prosemirror_utils/transforms.js":"VR8M","./mixins/attachment_mixin":"aaOI","./mixins/attachment_mixin.js":"aaOI","./plugins/attachment":"LAEe","./plugins/attachment.js":"LAEe","./plugins/emoji":"7osU","./plugins/emoji.js":"7osU","./plugins/hashtag":"4uRO","./plugins/hashtag.js":"4uRO","./plugins/mention":"dleW","./plugins/mention.js":"dleW","./plugins/text_placeholder":"7F6Z","./plugins/text_placeholder.js":"7F6Z","./schema":"mi/L","./schema.js":"mi/L","./toolbar":"cy56","./toolbar.js":"cy56","./transaction":"U9km","./transaction.js":"U9km","./util":"1egj","./util.js":"1egj","./utils/list":"/uQ1","./utils/list.js":"/uQ1","./utils/upload":"KY8K","./utils/upload.js":"KY8K"};function o(e){var t=a(e);return n(t)}function a(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}o.keys=function(){return Object.keys(i)},o.resolve=a,e.exports=o,o.id="dxp4"},e3MU:function(e,t){e.exports=tui.require("tui/components/buttons/InfoIconButton")},eX2V:function(e,t,n){},"f/sT":function(e,t){e.exports=tui.require("tui/i18n_vue_plugin")},fNlv:function(e,t,n){"use strict";n.r(t);var i=n("tnXT"),o=n.n(i),a=n("mD75"),r=n.n(a),s=n("gLvT"),l=n.n(s),d=n("3sQR"),c=n.n(d),u={components:{Hashtag:r.a,Dropdown:l.a,DropdownButton:c.a},extends:o.a,computed:{text(){return this.attrs.text},url(){return this.$url("/totara/catalog/index.php",{catalog_fts:this.attrs.text})}},methods:{open(e){window.open(e)}}},p=(n("+lwy"),n("KHd+")),m=function(e){e.options.__langStrings={editor_weka:["actions_menu_for","view_search_results","hashtag"]}},h=Object(p.a)(u,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Dropdown",{staticClass:"tui-wekaHashtag",scopedSlots:e._u([{key:"trigger",fn:function(t){var i=t.toggle;t.isOpen;return[n("Hashtag",{attrs:{url:e.url,text:e.$str("hashtag","editor_weka",e.text)},nativeOn:{"!click":function(e){return e.preventDefault(),i(e)}}})]}}])},[e._v(" "),n("DropdownButton",{on:{click:function(t){return e.open(e.url)}}},[e._v("\n    "+e._s(e.$str("view_search_results","editor_weka"))+"\n  ")])],1)}),[],!1,null,null,null);"function"==typeof m&&m(h),h.options.__hasBlocks={script:!0,template:!0};t.default=h.exports},fPwS:function(e,t){e.exports=tui.require("tui/components/icons/Loading")},fRht:function(e,t){e.exports=tui.require("editor_weka/components/nodes/Emoji")},gCcX:function(e,t,n){"use strict";n.r(t);var i=n("zJMb"),o=n("b7+R"),a=n("Nfo2"),r=n.n(a),s=n("9cw/"),l=n.n(s),d=n("9Wm2"),c=n.n(d),u=n("OxlY"),p=n.n(u),m=n("k+sG"),h=n.n(m),f=n("GcJT"),_=n("/7YT"),g=n("V68o"),v=n("cy56"),k=n("G709"),b=n("U9km"),y=n("1egj"),w=n("TXEh"),x=n("vyVp");const N=/\bhttps?:\/\/[-a-zA-Z0-9@:%._+~#=]+\b(?:[-a-zA-Z0-9@:%_+.~#?&//=]*)/g,I=["link_block","link_media"];class S extends i.default{constructor(e){super(e),this.isMedia=this.isMedia.bind(this),this._convertPastedUrl=this._convertPastedUrl.bind(this),this._getSelectionRange=this._getSelectionRange.bind(this)}nodes(){return{link_media:{schema:{group:"block",atom:!0,attrs:{url:{},loading:{default:void 0},type:{default:void 0},image:{default:void 0},title:{default:void 0},description:{default:void 0},siteName:{default:void 0},resolution:{default:void 0}},parseDOM:[{tag:".tui-wekaNodeLinkMedia",getAttrs:o.getJsonAttrs}],toDOM:e=>["a",{class:"tui-wekaNodeLinkMedia","data-attrs":JSON.stringify(e.attrs),href:e.attrs.url},e.attrs.url]},component:l.a,componentContext:{urlPlugin:this.urlPlugin.bind(this),editCard:this.editCard.bind(this),replaceWithTextLink:this.replaceWithTextLink.bind(this)}},link_block:{schema:{group:"block",atom:!0,attrs:{url:{},type:{default:void 0},image:{default:void 0},title:{default:void 0},description:{default:void 0},siteName:{default:void 0}},parseDOM:[{tag:".tui-wekaNodeLinkBlock",getAttrs:o.getJsonAttrs}],toDOM:e=>["a",{class:"tui-wekaNodeLinkBlock","data-attrs":JSON.stringify(e.attrs),href:e.attrs.url},e.attrs.url]},component:r.a,componentContext:{editCard:this.editCard.bind(this),replaceWithTextLink:this.replaceWithTextLink.bind(this)}}}}marks(){return{link:{schema:{attrs:{href:{},title:{default:void 0}},inclusive:!1,parseDOM:[{tag:"a[href]:not([class*=tui-weka])",getAttrs:Object(o.attrGetter)(["href","title"])}],toDOM(e){let{href:t,title:n}=e.attrs;return["a",{href:t,title:n},0]}},component:c.a,componentContext:{showMarkDropdown:this.showMarkDropdown.bind(this)}}}}plugins(){return[new f.Plugin({props:{transformPasted:e=>new _.Slice(function e(t,n){const i=[];return t.forEach((function(t){if(t.isText){const e=t.text;let o,a=0;for(N.lastIndex=0;o=N.exec(e);){const r=o.index,s=r+o[0].length;r>0&&i.push(t.cut(a,r));const l=e.slice(r,s),d=n.convert(l);d instanceof _.Node?i.push(d):d instanceof _.Mark?i.push(t.cut(r,s).mark(d.addToSet(t.marks))):i.push(t.cut(r,s)),a=s}a<e.length&&i.push(t.cut(a))}else i.push(t.copy(e(t.content,n)))})),_.Fragment.fromArray(i)}(e.content,{convert:this._convertPastedUrl}),e.openStart,e.openEnd)}})]}toolbarItems(){return[new v.ToolbarItem({group:"embeds",label:Object(g.langString)("link","editor_weka"),iconComponent:h.a,execute:()=>{this.editLink()}})]}loadSerializedVisitor(){return{link_media:e=>{delete e.attrs.loading,Array.isArray(e.attrs.resolution)&&delete e.attrs.resolution}}}saveSerializedVisitor(){return{link_media:e=>{delete e.attrs.loading}}}editLink(){const e=this.getSchema().marks.link,t=this._getSelectionRange();if(t.from===t.to){const n=Object(y.getMarkRange)(this.doc.resolve(t.from),e);if(n)return void this._editMarkAt(()=>n)}const n=this.doc.textBetween(t.from,t.to);this.showModal(p.a,{isNew:!0,isMedia:this.isMedia,attrs:{url:"",text:n},save:async e=>{const t=await this._prepareLinkUpdate(e);this._updateLink({type:null,getRange:this._getSelectionRange},t),this.editor.view.focus()}})}replaceWithTextLink(e,{url:t}){this.editor.execute((n,i)=>{const o=n.schema.text(t,[n.schema.mark("link",{href:t})]),a=e();i(n.tr.replaceWith(a.from,a.to,o))})}urlPlugin(e){return this._findLinkPlugin(e)}isMedia(e){return!!this._findLinkPlugin({type:"media",url:e})}editCard(e){const t=this.doc.nodeAt(e().from),n=t.type.name;I.includes(n)&&this.showModal(p.a,{isMedia:this.isMedia,attrs:{type:n,url:t.attrs.url},save:async t=>{const i=await this._prepareLinkUpdate(t);this._updateLink({type:n,getRange:e},i),this.editor.view.focus()}})}showMarkDropdown(e){const t=this._getLinkMark(e);if(!t)return;const n=t&&this.isMedia(t.attrs.href);return this.showActionDropdown(e().from,{actions:[{label:Object(g.langString)("go_to_link_label","editor_weka"),action:()=>this._openLinkMarkAt(e)},{label:Object(g.langString)("edit","core"),action:()=>this._editMarkAt(e)},{label:n?Object(g.langString)("display_as_embedded_media","editor_weka"):Object(g.langString)("display_as_card","editor_weka"),action:()=>this._markToCardAt(n?"link_media":"link_block",e)},{label:Object(g.langString)("remove","core"),action:()=>this._removeMarkAt(e)}]})}_findLinkPlugin({type:e,url:t}){for(let n=0;n<T.length;n++){const i=T[n];if(!e||i.type===e)for(let e=0;e<i.matches.length;e++){const n=i.matches[e],o=n.match.exec(t);if(o)return{plugin:i,details:n.details?n.details(o):{}}}}return null}_updateLink(e,t){e||(e={type:null,getRange:this._getSelectionRange});let n=null;if("link"===e.type||null===e.type){const t=e.getRange();n=this.doc.textBetween(t.from,t.to)}this.editor.execute((i,o)=>{const a=Object(y.expandContentResolvedRange)(y.ResolvedRange.resolve(this.doc,e.getRange()));if("link"==t.type){const r=i.schema.marks.link,s=t.text||t.url,l=r.create({href:t.url});let d;d="link"==e.type&&n&&s===n?i.tr.removeMark(a.$from.pos,a.$to.pos,r).addMark(a.$from.pos,a.$to.pos,l):i.tr.replaceWith(a.$from.pos,a.$to.pos,s?i.schema.text(s,[l]):_.Fragment.empty),o(d)}else I.includes(t.type)&&o(i.tr.replaceWith(a.$from.pos,a.$to.pos,t.content))})}async _prepareLinkUpdate(e){const{type:t,url:n,text:i}=e;if(I.includes(t)){const e=this.editor.state.schema,i=(!t||"link_media"==t)&&this._findLinkPlugin({type:"media",url:n});if(i){let o;if(i.plugin.nodeAttrs)try{o=await i.plugin.nodeAttrs({url:n})}catch(e){o={},console.error(e)}return new O({type:t,url:n,content:e.node("link_media",Object.assign({url:n},o))})}{let i;try{i=function(e){if(null===e)return null;return j(Object(w.pick)(e,["url","image","title","description"]))}(await Object(k.getLinkMetadata)(n))}catch(e){console.error(e),i={}}return new O({type:t,url:n,content:e.node("link_block",Object.assign({url:n},i))})}}return new O({type:"link",url:n,text:i})}_convertPastedUrl(e){const t=this.getSchema().marks.link,n=this.getSchema().nodes.link_media,i=this._findLinkPlugin({type:"media",url:e});if(i){const t={url:e};i.plugin.nodeAttrs&&(t.loading=!0);const o=n.create(t);return t.loading&&i.plugin.nodeAttrs({url:e}).then(t=>{this._updatePastedMedia(e,t)}).catch(t=>{console.error(t),this._updatePastedMedia(e,{})}),o}return t.create({href:e})}_updatePastedMedia(e,t){const n=this.getSchema().nodes.link_media;let i=this.editor.state.tr;this.editor.state.doc.descendants((o,a)=>{if(o.type==n&&o.attrs.loading&&o.attrs.url===e){const e=Object.assign({},o.attrs,{loading:!1},t);i=Object(b.setAttrs)(a,e)(i)}}),i.setMeta("addToHistory",!1),this.editor.dispatch(i)}_getSelectionRange(){return Object(w.pick)(this.editor.state.selection,["from","to"])}_getLinkMark(e){return Object(y.getMark)(this.doc.resolve(e().from),this.getSchema().marks.link)}_openLinkMarkAt(e){const t=this._getLinkMark(e);t&&window.open(t.attrs.href)}_editMarkAt(e){const t=e(),n=this._getLinkMark(e);if(!n)return;const i=n.attrs.href;let o=this.doc.textBetween(t.from,t.to);i===o&&(o=null),this.showModal(p.a,{isMedia:this.isMedia,attrs:{url:i,text:o},save:async t=>{const n=await this._prepareLinkUpdate(t);this._updateLink({type:"link",getRange:e},n),this.editor.view.focus()}})}async _markToCardAt(e,t){const n=this._getLinkMark(t);if(!n)return;let i;try{i=await this._prepareLinkUpdate({type:e,url:n.attrs.href})}catch(e){return void async function(){const e=Object(g.langString)("error_no_url_info","editor_weka");await Object(g.loadLangStrings)([e]),Object(x.notify)({type:"error",message:e.toString()})}()}this._updateLink({type:"link",getRange:t},i),this.editor.view.focus()}_removeMarkAt(e){this.editor.execute((t,n)=>{const i=Object(y.expandContentResolvedRange)(y.ResolvedRange.resolve(this.doc,e()));n(t.tr.delete(i.$from.pos,i.$to.pos))}),this.editor.view.focus()}}class O{constructor(e){Object.assign(this,e)}}const T=[{key:"youtube",type:"media",name:"YouTube",matches:[{match:/^https?:\/\/(?:www\.)?youtube.com\/watch\?v=([a-zA-Z0-9_-]+)/,details:e=>({id:e[1]})},{match:/^https?:\/\/(?:www\.)?youtu.be\/([a-zA-Z0-9_-]+)/,details:e=>({id:e[1]})}],nodeAttrs:async({url:e})=>A(await Object(k.getLinkMetadata)(e))},{key:"vimeo",type:"media",name:"Vimeo",matches:[{match:/^https?:\/\/(?:www\.)?vimeo.com\/([0-9]+)/,details:e=>({id:e[1]})}],nodeAttrs:async({url:e})=>A(await Object(k.getLinkMetadata)(e))},{key:"image",type:"media",name:"Image",matches:[{match:/\.(png|jpe?g|gif|webp|avif)$/}]},{key:"audio",type:"media",name:"Audio",matches:[{match:/\.(aac|flac|m4a|mp3|ogg|opus|wav|wma)$/}]}];const j=e=>{const t={};for(const n in e)null!=e[n]&&(t[n]=e[n]);return t};function A(e){if(null===e)return null;const t=j(Object(w.pick)(e,["url","image","title","description"])),n=Number(e.videowidth),i=Number(e.videoheight);return t.resolution=isNaN(n)||isNaN(i)?void 0:{width:n,height:i},t}t.default=e=>new S(e)},gLvT:function(e,t){e.exports=tui.require("tui/components/dropdown/Dropdown")},gTrn:function(e,t,n){"use strict";var i=n("2R5z");n.n(i).a},gfQI:function(e,t,n){"use strict";n.r(t);var i=n("tnXT"),o=n.n(i),a=n("r4xq"),r=n.n(a),s=n("3bgQ"),l=n.n(s),d=n("IBd2"),c=n.n(d),u=n("fPwS"),p=n.n(u),m={components:{NodeBar:r.a,ResponsiveEmbedIframe:l.a,ResponsiveImage:c.a,Loading:p.a},extends:o.a,computed:{pluginMatch(){return this.context.urlPlugin({type:"media",url:this.attrs.url})||{}},pluginKey(){return this.pluginMatch.plugin&&this.pluginMatch.plugin.key},pluginName(){return this.pluginMatch.plugin&&this.pluginMatch.plugin.name},details(){return this.pluginMatch.details||{}},actions(){return[{label:this.$str("go_to_link_label","editor_weka"),action:()=>this.open()},{label:this.$str("edit","core"),action:()=>this.edit()},{label:this.$str("display_as_text","editor_weka"),action:()=>this.toLink()},{label:this.$str("remove","core"),action:()=>this.$emit("remove")}]},iframeUrl(){const{details:e}=this;switch(this.pluginKey){case"youtube":return"https://www.youtube.com/embed/"+e.id+"?rel=0";case"vimeo":return"https://player.vimeo.com/video/"+e.id+"?portrait=0"}return null},summaryText(){return this.pluginName+" - "+(this.attrs.title||this.attrs.url)}},methods:{open(){window.open(this.attrs.url)},edit(){this.context.editCard(this.getRange)},toLink(){const e=this.attrs.url;this.context.replaceWithTextLink(this.getRange,{url:e})}}},h=(n("4BOM"),n("KHd+")),f=function(e){e.options.__langStrings={core:["edit","remove","loading"],editor_weka:["actions_menu_for","display_as_text","go_to_link_label"]}},_=Object(h.a)(m,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaLinkMedia",class:{"tui-wekaLinkMedia--intrinsic-width":!e.attrs.loading&&!e.iframeUrl},attrs:{"data-url":e.attrs.url}},[n("div",{staticClass:"tui-wekaLinkMedia__inner"},[e.attrs.loading?n("div",{staticClass:"tui-wekaLinkMedia__loading"},[n("Loading",{attrs:{alt:e.$str("loading","core")}})],1):e.iframeUrl?n("div",{staticClass:"tui-wekaLinkMedia__embed"},[n("ResponsiveEmbedIframe",{attrs:{src:e.iframeUrl,resolution:e.attrs.resolution,title:e.attrs.title||e.attrs.url}})],1):"audio"==e.pluginKey?n("div",[n("audio",{attrs:{controls:"",src:e.attrs.url}})]):"image"==e.pluginKey?n("div",[n("ResponsiveImage",{attrs:{src:e.attrs.url}})],1):n("div",[n("a",{attrs:{href:e.attrs.url}},[e._v(e._s(e.attrs.url))])]),e._v(" "),n("NodeBar",{attrs:{actions:e.actions,"aria-label":e.$str("actions_menu_for","editor_weka",e.summaryText)}})],1)])}),[],!1,null,null,null);"function"==typeof f&&f(_),_.options.__hasBlocks={script:!0,template:!0};t.default=_.exports},hFhO:function(e,t,n){"use strict";n.r(t);var i=n("tnXT"),o=n.n(i),a=n("5h9J"),r=n.n(a),s=n("gLvT"),l=n.n(s),d=n("3sQR"),c=n.n(d),u=n("0QOp"),p=n.n(u),m=n("sxi1"),h=n.n(m),f={components:{ButtonIcon:r.a,Dropdown:l.a,DropdownButton:c.a,LinkBlockInner:p.a,More:h.a},extends:o.a,methods:{open(){window.open(this.attrs.url)},edit(){this.context.editCard(this.getRange)},toLink(){const e=this.attrs.url;this.context.replaceWithTextLink(this.getRange,{url:e})},remove(){this.$emit("remove")}}},_=(n("7O4h"),n("KHd+")),g=function(e){e.options.__langStrings={core:["edit","remove"],editor_weka:["actions_menu_for","display_as_text","go_to_link_label"]}},v=Object(_.a)(f,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaLinkBlock",attrs:{"data-url":e.attrs.url}},[n("Dropdown",{scopedSlots:e._u([{key:"trigger",fn:function(t){var i=t.toggle,o=t.isOpen;return[n("div",{on:{"!click":function(e){return e.preventDefault(),i(e)}}},[n("LinkBlockInner",{attrs:{attrs:e.attrs}})],1),e._v(" "),n("div",{staticClass:"tui-wekaLinkBlock__btn-wrapper"},[n("ButtonIcon",{staticClass:"tui-wekaLinkBlock__btn",attrs:{styleclass:{small:!0,transparent:!0},"aria-expanded":o.toString(),"aria-label":e.$str("actions_menu_for","editor_weka",e.attrs.title||e.attrs.url)},on:{click:i}},[n("More")],1)],1)]}}])},[e._v(" "),n("DropdownButton",{on:{click:e.open}},[e._v("\n      "+e._s(e.$str("go_to_link_label","editor_weka"))+"\n    ")]),e._v(" "),n("DropdownButton",{on:{click:e.edit}},[e._v("\n      "+e._s(e.$str("edit","core"))+"\n    ")]),e._v(" "),n("DropdownButton",{on:{click:e.toLink}},[e._v("\n      "+e._s(e.$str("display_as_text","editor_weka"))+"\n    ")]),e._v(" "),n("DropdownButton",{on:{click:e.remove}},[e._v("\n      "+e._s(e.$str("remove","core"))+"\n    ")])],1)],1)}),[],!1,null,null,null);"function"==typeof g&&g(v),v.options.__hasBlocks={script:!0,template:!0};t.default=v.exports},hRV1:function(e,t,n){"use strict";n.r(t);var i=n("zJMb"),o=n("4uRO"),a=n("nFyd"),r=n.n(a),s=n("UJXg"),l=n.n(s);n("GcJT");class d extends i.default{nodes(){return{hashtag:{schema:{group:"inline",inline:!0,atom:!0,attrs:{text:{default:""}},parseDOM:[{tag:"span.tui-wekaNodeHashtag",getAttrs(e){try{return{text:e.textContent.trim().slice(1)}}catch(e){return{}}}}],toDOM:e=>["span",{class:"tui-wekaNodeHashtag"},"#"+e.attrs.text]},component:r.a}}}plugins(){return[Object(o.default)(this.editor)]}applyFormatters(e){const t=new l.a(this.editor);let n=e.tr;return e.doc.nodesBetween(0,e.doc.nodeSize-2,(i,a)=>{if(i.isText){o.REGEX.lastIndex=0;let i=e.doc.resolve(a),r=t.matcher(o.REGEX,i);for(;r;)n=n.replaceWith(n.mapping.map(r.range.from),n.mapping.map(r.range.to),e.schema.node("hashtag",{text:r.text.slice(1)})),r=t.matcher(o.REGEX,i)}}),n.docChanged?(this.editor.dispatch(n),this.editor.state):e}}t.default=e=>new d(e)},hg2Q:function(e,t,n){"use strict";t.a={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"editor_weka_get_draft_file"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"item_id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filename"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_text"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"file"},name:{kind:"Name",value:"editor_weka_draft_file"},arguments:[{kind:"Argument",name:{kind:"Name",value:"item_id"},value:{kind:"Variable",name:{kind:"Name",value:"item_id"}}},{kind:"Argument",name:{kind:"Name",value:"filename"},value:{kind:"Variable",name:{kind:"Name",value:"filename"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"file_size"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"item_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mime_type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[{kind:"Argument",name:{kind:"Name",value:"force_download"},value:{kind:"BooleanValue",value:!1}}],directives:[]},{kind:"Field",alias:{kind:"Name",value:"download_url"},name:{kind:"Name",value:"url"},arguments:[{kind:"Argument",name:{kind:"Name",value:"force_download"},value:{kind:"BooleanValue",value:!0}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"media_type"},arguments:[],directives:[]}]}}]}}]}},"i/kK":function(e,t){e.exports=tui.require("tui/components/form/FormRow")},"i7/w":function(e,t){e.exports=tui.require("vue")},iFtU:function(e,t,n){"use strict";n.r(t);var i=n("RNtj"),o=n.n(i),a=n("r4xq"),r=n.n(a),s=n("zK61"),l=n.n(s),d={components:{AttachmentNode:o.a,NodeBar:r.a},mixins:[l.a],props:{enableConvert:{type:Boolean,default:!0}},data:()=>({showModal:!1}),computed:{actions(){let e=[];return this.enableConvert&&e.push({label:this.$str("display_as_embedded_media","editor_weka"),action:()=>{this.$emit("convert-to-embedded-media")}}),e=e.concat([{label:this.$str("remove","core"),action:()=>{this.$emit("delete")}}]),this.hasDownloadUrl&&e.push({label:this.$str("download","core"),action:()=>{this.$emit("download")}}),e}}},c=n("KHd+"),u=function(e){e.options.__langStrings={core:["download","remove"],editor_weka:["display_as_embedded_media","actions_menu_for"]}},p=Object(c.a)(d,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("AttachmentNode",{attrs:{filename:this.filename,"file-size":this.fileSize,component:"user",area:"draft","item-id":this.draftId}}),this._v(" "),t("NodeBar",{attrs:{actions:this.actions,"aria-label":this.$str("actions_menu_for","editor_weka",this.filename)}})],1)}),[],!1,null,null,null);"function"==typeof u&&u(p),p.options.__hasBlocks={script:!0,template:!0};t.default=p.exports},iPZg:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/ImageBlock")},ixxs:function(e,t){e.exports=tui.require("tui/components/icons/Show")},j1CR:function(e,t,n){var i={"./WekaIntegration":"oy78","./WekaIntegration.vue":"oy78","./fixtures/WekaBasic":"CLKc","./fixtures/WekaBasic.vue":"CLKc","./fixtures/WekaWithLearn":"7fvA","./fixtures/WekaWithLearn.vue":"7fvA"};function o(e){var t=a(e);return n(t)}function a(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}o.keys=function(){return Object.keys(i)},o.resolve=a,e.exports=o,o.id="j1CR"},j1Jf:function(e,t,n){"use strict";n.r(t);var i=n("i7/w"),o=n.n(i),a=n("nEm4"),r=n.n(a),s=n("i/kK"),l=n.n(s),d=n("oMuj"),c=n.n(d),u=n("tkAW"),p=n.n(u),m=n("u5iS"),h=n.n(m),f=n("vF5l"),_=n.n(f),g=n("nXMa"),v=n.n(g),k=n("BN8m"),b=n.n(k),y={components:{Form:r.a,FormRow:l.a,InputText:c.a,Modal:p.a,ModalContent:h.a,Button:_.a,ButtonCancel:v.a,ButtonGroup:b.a},props:{isNew:Boolean,attrs:Object,save:Function,isMedia:Function},data:function(){return{url:this.attrs.url,text:this.attrs.text,loading:!1,display:this.attrs.type||"link",wasText:!!this.attrs.text,error:null}},computed:{urlIsMedia(){return this.isMedia&&this.isMedia(this.url)},formValue(){return{type:this.display,url:this.url,text:this.text}},formValid(){return!!this.url}},watch:{urlIsMedia(e){this.wasText||(this.display=e?"link_media":"link")},formValue(){this.error=null}},mounted(){o.a.nextTick(()=>{this.$refs.url&&this.$refs.url.$el&&this.$refs.url.$el.focus()})},methods:{close(){this.$emit("request-close")},confirm(){if(this.loading)return;this.loading=!0;const e=this.formValue;e.url=this.fixUrl(e.url),Promise.resolve(this.save(e)).then(this.close).catch(e=>{console.error(e)}).then(()=>this.loading=!1)},updateText(e){this.text=e},fixUrl:e=>["/","#","http://","https://"].some(t=>e.startsWith(t))?e:"http://"+e}},w=n("KHd+"),x=function(e){e.options.__langStrings={core:["cancel","ok"],editor:["linkurl"],editor_weka:["done","displayas","display_text","edit_link_label","insert_link_label","error_no_url_info"]}},N=Object(w.a)(y,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Modal",{attrs:{size:"normal","aria-labelledby":e.$id("title")}},[n("ModalContent",{attrs:{title:e.isNew?e.$str("insert_link_label","editor_weka"):e.$str("edit_link_label","editor_weka"),"title-id":e.$id("title"),"close-button":!0},scopedSlots:e._u([{key:"buttons",fn:function(){return[n("ButtonGroup",[n("Button",{attrs:{styleclass:{primary:"true"},text:e.$str("done","editor_weka"),disabled:!e.formValid||e.loading},on:{click:e.confirm}}),e._v(" "),n("ButtonCancel",{on:{click:e.close}})],1)]},proxy:!0}])},[n("Form",{attrs:{"input-width":"full"},on:{submit:function(t){return t.preventDefault(),e.confirm(t)}}},[e.error?n("p",[e._v(e._s(e.error))]):e._e(),e._v(" "),n("FormRow",{attrs:{label:e.$str("linkurl","editor")},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.id;return[n("InputText",{ref:"url",attrs:{id:i,autofocus:!0},model:{value:e.url,callback:function(t){e.url=t},expression:"url"}})]}}])}),e._v(" "),n("FormRow",{attrs:{label:e.$str("display_text","editor_weka")},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.id;return[n("InputText",{attrs:{id:i,value:"link"==e.display?e.text:"",disabled:"link"!=e.display},on:{input:e.updateText}})]}}])}),e._v(" "),n("input",{style:{display:"none"},attrs:{type:"submit"}})],1)],1)],1)}),[],!1,null,null,null);"function"==typeof x&&x(N),N.options.__hasBlocks={script:!0,template:!0};t.default=N.exports},jHsM:function(e,t){e.exports=tui.require("editor_weka/components/attachments/AudioAttachment")},jknM:function(e,t,n){"use strict";n.r(t),n.d(t,"setupTextarea",(function(){return d}));var i=n("H/tB"),o=n.n(i),a=n("TXEh"),r=n("2wx7"),s=n.n(r),l=n("w52A");function d({id:e,extensions:t,showtoolbar:n,file_item_id:i,context_id:o,files:a}){const r=document.getElementById(e);if(!r){const e=new Error("Textarea not found");throw e.code="TEXTAREA_NOT_FOUND",e}new c(e,r,{extensions:t,showtoolbar:n,context_id:o,files:a,file_item_id:i})}class c{constructor(e,t,n){this.id=e,this.textareaEl=t,t.style.display="none",t.setAttribute("data-enhanced",!0),this.wrapper=document.createElement("div");const i=document.createElement("div");this.wrapper.appendChild(i),this.textareaEl.parentNode.insertBefore(this.wrapper,this.textareaEl.nextSibling);let r=this.getWekaValue();this.wekaValue=r;const l=()=>{if(this.wekaValue){let e=Object(a.createNewEvent)("change");this.textareaEl.value=JSON.stringify(this.wekaValue.getDoc()),this.textareaEl.dispatchEvent(e)}},d=Object(a.throttle)(l,250);o.a.mount(s.a,{props:{value:r,options:n,fileItemId:n.file_item_id?n.file_item_id:void 0},on:{input:e=>{this.wekaValue=e,d()},blur:l,ready:()=>{this.wekaValue.hasHtml()&&l()}}},i)}getWekaValue(){let e=this.textareaEl.value;if(e){if(!this.looksLikeJson(e))return l.default.fromHtml(e);try{const t=JSON.parse(e);return l.default.fromDoc(t)}catch(e){console.error("[editor_weka] Error parsing JSON"),console.error(e)}}return l.default.empty()}looksLikeJson(e){return"{"===e.slice(0,1)&&"}"===e.slice(e.length-1)}}},jqyG:function(e,t,n){"use strict";n.r(t);var i=n("nEm4"),o=n.n(i),a=n("tkAW"),r=n.n(a),s=n("u5iS"),l=n.n(s),d=n("BN8m"),c=n.n(d),u=n("vF5l"),p=n.n(u),m=n("nXMa"),h=n.n(m),f=n("nBTD"),_=n.n(f),g=n("NEm0"),v=n.n(g),k=n("rhow"),b=n.n(k),y=n("e3MU"),w=n.n(y),x=n("J1fj"),N=n.n(x),I=n("5h9J"),S=n.n(I),O=n("fPwS"),T=n.n(O),j=n("K5I0"),A=n("kfFO"),$=n("hg2Q"),M={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"totara_core_delete_draft_file"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"draftid"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filename"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_text"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"result"},name:{kind:"Name",value:"totara_core_delete_draft_file"},arguments:[{kind:"Argument",name:{kind:"Name",value:"draftid"},value:{kind:"Variable",name:{kind:"Name",value:"draftid"}}},{kind:"Argument",name:{kind:"Name",value:"filename"},value:{kind:"Variable",name:{kind:"Name",value:"filename"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"success"},arguments:[],directives:[]}]}}]}}]},D={components:{Modal:r.a,ModalContent:l.a,Form:o.a,ButtonGroup:c.a,Button:p.a,ButtonCancel:h.a,FieldError:_.a,Upload:v.a,FileIcon:b.a,InfoIconButton:w.a,DeleteIcon:N.a,ButtonIcon:S.a,Loading:T.a},props:{itemId:{type:Number,required:!0},contextId:{type:Number,required:!0},acceptedFileTypes:{type:Array,required:!0},filename:String,modalHelpText:{type:String,required:!0},modalTitle:{type:String,required:!0},modalTitleHelpText:String,submitButtonText:{type:String,required:!0}},data:()=>({repositoryData:null,uploadError:"",uploadedFile:null,uploading:!1}),apollo:{uploadedFile:{query:$.a,variables(){return{item_id:this.itemId,filename:this.filename}},skip(){return!this.filename},update:({file:e})=>e},repositoryData:{query:A.a,variables(){return{context_id:this.contextId}},update:({repository_data:e})=>({repositoryId:e.repository_id,url:e.url})}},methods:{confirm(){this.$emit("change",this.uploadedFile)},async deleteFile(){if(!this.uploadedFile)return;const{filename:e}=this.uploadedFile;let{data:{result:{success:t}}}=await this.$apollo.mutate({mutation:M,variables:{draftid:this.itemId,filename:e}});t&&(this.uploadedFile=null)},async handleFileLoaded({file:{name:e}}){this.uploadError="",this.uploadedFile=await Object(j.getDraftFile)({itemId:this.itemId,filename:e})},handleError(){this.uploadError=this.$str("meta_upload_generic_error","editor_weka"),this.uploading=!1}}},B=(n("zunS"),n("KHd+")),F=function(e){e.options.__langStrings={totara_core:["filewithname","delete"],editor:["transcript"],editor_weka:["done","meta_upload_generic_error"]}},C=Object(B.a)(D,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.repositoryData?n("Modal",{staticClass:"tui-captionUploadModal"},[n("ModalContent",{staticClass:"tui-captionUploadModal__content"},[n("template",{slot:"title"},[n("div",{staticClass:"tui-captionUploadModal__title"},[e._v("\n        "+e._s(e.modalTitle)+"\n        "),e.modalTitleHelpText?n("InfoIconButton",{attrs:{"is-help-for":e.$str("transcript","editor")}},[e._v("\n          "+e._s(e.modalTitleHelpText)+"\n        ")]):e._e()],1)]),e._v(" "),n("Form",{on:{submit:function(t){return t.preventDefault(),e.confirm(t)}}},[e.uploadedFile?n("div",{staticClass:"tui-captionUploadModal__file"},[n("div",{staticClass:"tui-captionUploadModal__fileContent"},[n("FileIcon",{attrs:{filename:e.uploadedFile.filename,title:e.$str("filewithname","totara_core",e.uploadedFile.filename)}}),e._v("\n          "+e._s(e.uploadedFile.filename)+"\n        ")],1),e._v(" "),n("ButtonIcon",{attrs:{"aria-label":e.$str("delete","totara_core"),styleclass:{transparentNoPadding:!0}},on:{click:e.deleteFile}},[n("DeleteIcon")],1)],1):[n("Upload",{staticClass:"tui-captionUploadModal__upload",attrs:{"repository-id":e.repositoryData.repositoryId,"item-id":e.itemId,href:e.repositoryData.url,"accepted-types":e.acceptedFileTypes,overwrite:!0,"one-file":!0,"context-id":e.contextId},on:{load:e.handleFileLoaded,"upload-finished":function(t){e.uploading=!1},progress:function(t){e.uploading=!0},error:e.handleError},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.selectEvents,o=t.inputEvents;return n("div",{},[n("input",e._g({directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"inputFile",attrs:{accept:e.acceptedFileTypes,type:"file"}},o)),e._v(" "),e.uploading?n("ButtonIcon",{attrs:{"aria-label":e.submitButtonText,text:e.submitButtonText,disabled:!0}},[n("Loading")],1):n("Button",e._g({attrs:{"aria-label":e.submitButtonText,text:e.submitButtonText}},i))],1)}}],null,!1,4060194065)}),e._v(" "),e.uploadError?n("FieldError",{staticClass:"tui-captionUploadModal__errorHandler",attrs:{error:e.uploadError}}):e._e()],e._v(" "),n("p",{staticClass:"tui-captionUploadModal__helpText"},[e._v("\n        "+e._s(e.modalHelpText)+"\n      ")]),e._v(" "),n("ButtonGroup",{staticClass:"tui-captionUploadModal__buttonGroup"},[n("Button",{attrs:{styleclass:{primary:"true"},text:e.$str("done","editor_weka")},on:{click:e.confirm}}),e._v(" "),n("ButtonCancel",{on:{click:function(t){return t.preventDefault(),e.$emit("request-close")}}})],1)],2)],2)],1):e._e()}),[],!1,null,null,null);"function"==typeof F&&F(C),C.options.__hasBlocks={script:!0,template:!0};t.default=C.exports},"k+sG":function(e,t){e.exports=tui.require("tui/components/icons/Link")},kS2v:function(e,t,n){"use strict";function i(){return{type:"doc",content:[{type:"paragraph"}]}}n.r(t),n.d(t,"getDefaultDocument",(function(){return i}))},kfFO:function(e,t,n){"use strict";t.a={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"editor_weka_get_repository_data"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"context_id"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"repository_data"},name:{kind:"Name",value:"editor_weka_repository_data"},arguments:[{kind:"Argument",name:{kind:"Name",value:"context_id"},value:{kind:"Variable",name:{kind:"Name",value:"context_id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"repository_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"max_bytes"},arguments:[],directives:[]}]}}]}}]}},kgTP:function(e,t){e.exports=tui.require("editor_weka/helpers/editor")},kkOl:function(e,t){e.exports=tui.require("editor_weka/WekaValue")},lH1I:function(e,t,n){"use strict";var i=n("syII");n.n(i).a},laAb:function(e,t,n){"use strict";var i=n("5+iW");n.n(i).a},lqaC:function(e,t,n){"use strict";var i=n("+oKZ");n.n(i).a},mB48:function(e,t){e.exports=tui.require("tui/dom/position")},mD75:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/Hashtag")},"mi/L":function(e,t,n){"use strict";n.r(t),n.d(t,"createSchema",(function(){return r}));var i=n("/7YT");const o=["p",0],a={doc:{content:"block+"},paragraph:{group:"block",content:"inline*",parseDOM:[{tag:"p"}],toDOM:()=>o},text:{group:"inline"}};function r({nodes:e,marks:t}){return new i.Schema({nodes:Object.assign({},a,e),marks:t||{}})}},nBTD:function(e,t){e.exports=tui.require("tui/components/form/FieldError")},nEm4:function(e,t){e.exports=tui.require("tui/components/form/Form")},nFyd:function(e,t){e.exports=tui.require("editor_weka/components/nodes/Hashtag")},nHdg:function(e,t,n){},nXMa:function(e,t){e.exports=tui.require("tui/components/buttons/Cancel")},nhhl:function(e,t,n){"use strict";n.r(t);var i=n("bJQT"),o={components:{AttachmentNodeCollection:n.n(i).a}},a=(n("xSMd"),n("KHd+")),r=Object(a.a)(o,(function(){var e=this.$createElement,t=this._self._c||e;return t("AttachmentNodeCollection",{staticClass:"tui-wekaAttachments"},[t("div",{ref:"content",staticClass:"tui-wekaAttachments__content"})])}),[],!1,null,null,null);r.options.__hasBlocks={script:!0,template:!0};t.default=r.exports},nyAV:function(e,t,n){"use strict";n.r(t),n.d(t,"createMentionContent",(function(){return o}));var i=n("kgTP");function o({fullname:e,userId:t}){let n=Object(i.getDefaultDocument)();return n.content[0]={type:"paragraph",content:[{type:"mention",attrs:{id:t,display:e}},{type:"text",text:" "}]},n}},oMuj:function(e,t){e.exports=tui.require("tui/components/form/InputText")},oWLq:function(e,t,n){"use strict";var i=n("nHdg");n.n(i).a},"og+O":function(e,t,n){},oy78:function(e,t,n){"use strict";n.r(t);var i=n("S8bZ"),o=n.n(i),a=n("jknM"),r=n("V68o"),s={components:{ErrorPageRender:o.a},props:{params:Object},data:()=>({errorMessage:null,error:null}),created(){try{Object(a.setupTextarea)(this.params)}catch(e){let t;t="TEXTAREA_NOT_FOUND"===e.code?Object(r.langString)("error_textarea_not_found","editor_weka"):Object(r.langString)("error_failed_to_initialise","editor_weka"),Object(r.loadLangStrings)([t]).then(()=>{this.errorMessage=t.toString(),this.error=e})}}},l=n("KHd+"),d=Object(l.a)(s,(function(){var e=this.$createElement,t=this._self._c||e;return this.errorMessage?t("ErrorPageRender",{attrs:{message:this.errorMessage,error:this.error}}):this._e()}),[],!1,null,null,null);d.options.__hasBlocks={script:!0,template:!0};t.default=d.exports},pynp:function(e,t){e.exports=tui.require("tui/polyfills/ResizeObserver")},r4xq:function(e,t){e.exports=tui.require("editor_weka/components/toolbar/NodeBar")},rhow:function(e,t){e.exports=tui.require("tui/components/icons/files/compute/FileIcon")},rqBY:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/Mention")},sxi1:function(e,t){e.exports=tui.require("tui/components/icons/More")},syII:function(e,t,n){},tIwH:function(e,t,n){},ta2K:function(e,t){e.exports=tui.require("editor_weka/components/nodes/VideoBlock")},tkAW:function(e,t){e.exports=tui.require("tui/components/modal/Modal")},tnXT:function(e,t){e.exports=tui.require("editor_weka/components/nodes/BaseNode")},u5iS:function(e,t){e.exports=tui.require("tui/components/modal/ModalContent")},ulH4:function(e,t){e.exports=tui.require("ext_prosemirror/dropcursor")},"v+xu":function(e,t){e.exports=tui.require("ext_prosemirror/inputrules")},vF5l:function(e,t){e.exports=tui.require("tui/components/buttons/Button")},vFxO:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return r}));var i=n("i7/w"),o=n.n(i),a=n("1egj");class r{constructor(e,{editor:t,node:n,view:i,getPos:o,parent:a,context:r}){this.component=e,this.editor=t,this.node=n,this.view=i,this.parent=a,this.context=r,this.isNode=!!this.node.marks,this.isMark=!this.isNode,this.getPos=this.isNode?o:null,this.createVue(),this.dom=this.vm.$el,this.contentDOM=this.vm.$refs.content}createVue(){const e=o.a.extend(this.component),t={nodeInfo:this.getNodeInfo(),contextInfo:this.getContextInfo(),updateAttrs:e=>this.updateAttrs(e),replaceWith:e=>this.replaceWith(e),getPos:this.getPos,getRange:this.getRange.bind(this)};this.vm=new e({parent:this.parent,propsData:t}).$mount(),this.vm.$on("remove",this.remove.bind(this))}getNodeInfo(){const e={node:this.node,editor:this.editor};return Object.preventExtensions(e),e}getContextInfo(){const e={context:this.context};return Object.preventExtensions(e),e}update(e,t){return e.type===this.node.type&&(e===this.node&&this.decorations===t||(this.node=e,this.updateComponentProps({nodeInfo:this.getNodeInfo()})),!0)}updateComponentProps(e){if(!this.vm._props)return;const t=o.a.config.silent;o.a.config.silent=!0,Object.entries(e).forEach(([e,t])=>{this.vm._props[e]=t}),o.a.config.silent=t}updateAttrs(e){if(!this.view.editable)return;const{state:t}=this.view,{type:n}=this.node,i=this.getPos(),o=Object.assign({},this.node.attrs,e),a=this.isMark?t.tr.removeMark(i.from,i.to,n).addMark(i.from,i.to,n.create(o)):t.tr.setNodeMarkup(i,null,o);this.view.dispatch(a)}replaceWith(e){const t=e(this.view.state.schema);if(void 0===t)return;const n=this.getRange(),i=this.view.state.tr.replaceWith(n.from,n.to,t);this.view.dispatch(i)}remove(){const e=this.view.state.tr,t=this.getRange(),n=e.delete(t.from,t.to);this.view.dispatch(n)}getSize(){return this.node.nodeSize}getRange(){if(this.isNode){const e=this.getPos();return{from:e,to:e+this.getSize()}}if(this.isMark){const e=this.view.posAtDOM(this.dom),t=this.view.state.doc.resolve(e);return Object(a.getMarkRange)(t,this.node.type)}}destroy(){this.vm.$destroy()}ignoreMutation(e){return!this.contentDOM&&"selection"!==e.type||!(!this.contentDOM||"selection"===e.type||this.contentDOM.contains(e.target))}}},vyVp:function(e,t){e.exports=tui.require("tui/notifications")},w4Gt:function(e,t,n){"use strict";n.r(t);var i=n("zJMb"),o=n("ziKp"),a=n.n(o),r=n("6RS6"),s=n.n(r),l=n("2RJX"),d=n.n(l),c=n("cy56"),u=n("V68o"),p=n("LAEe"),m=n("b7+R"),h=n("GcJT"),f=n("KY8K"),_=n("vyVp");class g extends i.default{constructor(e){void 0===e&&(e={}),super(e),this.acceptTypes=e.accepttypes||[]}nodes(){return{attachment:{schema:{inline:!0,atom:!0,attrs:{filename:{default:void 0},size:{default:void 0},option:{default:void 0},url:{default:void 0}},parseDOM:[{tag:"div.tui-wekaNodeAttachment",getAttrs:m.getJsonAttrs}],toDOM:e=>["div",{class:"tui-wekaNodeAttachment","data-attrs":JSON.stringify({filename:e.attrs.filename,option:e.attrs.option,url:e.attrs.url})}]},component:a.a,componentContext:{convertToImage:this._convertToImage.bind(this),convertToVideo:this._convertToVideo.bind(this),convertToAudio:this._convertToAudio.bind(this),updateNode:this._updateNode.bind(this),hasImageNode:this._hasImageNode.bind(this),hasVideoNode:this._hasVideoNode.bind(this),removeNode:this.removeNode.bind(this),hasAudioNode:this._hasAudioNode.bind(this),getItemId:this._getItemId.bind(this),getDownloadUrl:this._getDownloadUrl.bind(this)}},attachments:{schema:{group:"block",allowGapCursor:!0,content:"attachment*",parseDOM:[{tag:"div.tui-wekaNodeAttachments"}],toDOM:()=>["div",{class:"tui-wekaNodeAttachments"},0]},component:s.a}}}toolbarItems(){return this.editor.fileStorage.enabled?[new c.ToolbarItem({group:"embeds",label:Object(u.langString)("attachment","editor_weka"),iconComponent:d.a,execute:e=>{Object(f.pickFiles)(e).then(e=>{this.startUploadingFiles(e)})}})]:[]}plugins(){return this.editor.fileStorage.enabled?[Object(p.attachment)({onDrop:this._onDropEvent.bind(this),onKeyDown:this._onKeyDownEvent.bind(this)})]:[]}_findAttachmentCollectionBlock(e){const t=e.selection.$from,n=t.parent;if(!n||"attachments"!==n.type.name)return null;let i=t.pos;return e.selection.empty||(i+=1),{from:t.before(),to:t.after(),insertPoint:i,node:n}}async startUploadingFiles(e){try{const t=await this.editor.fileStorage.uploadFiles(e,this.acceptTypes);if(0===t.length)return;const n=this.editor.state.schema,i=this.editor.view;let o=i.state.tr,a=this._findAttachmentCollectionBlock(o);const r=t.map(({filename:e,url:t,file_size:i})=>n.node("attachment",{filename:e,url:t,size:i,option:{}}));if(a)o.insert(a.insertPoint,r),i.dispatch(o);else{const e=n.node("attachments",null,r),t=o.selection.$from.pos;i.dispatch(o.replaceWith(t,t,e))}}catch(e){console.error(e);const t=Object(u.langString)("error_upload_failed","editor_weka");Object(u.loadLangStrings)([t]).then(()=>Object(_.notify)({type:"error",message:t.toString()}))}}_onKeyDownEvent({view:e,event:t}){const{tr:n}=e.state,i=this._findAttachmentCollectionBlock(n);if(!i)return!1;if("Enter"===t.key){const t=e.state.schema.nodes.paragraph.createAndFill();return n.insert(i.to,t),n.setSelection(new h.TextSelection(n.doc.resolve(i.to+1))),e.dispatch(n),!0}if("Backspace"===t.key){if(!n.selection.$from.nodeBefore)return!1;if(1===i.node.content.size)return n.delete(i.from,i.to),e.dispatch(n),!0}return!1}_onDropEvent({event:e}){return!!(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length)&&(e.preventDefault(),this.startUploadingFiles(e.dataTransfer.files),!0)}async _convertToImage(e,{filename:t,alttext:n}){const i=await this._getFileInfo(t);this.editor.execute((o,a)=>{const r=o.schema.node("image",{filename:t,url:i.url,alttext:n});this._doConvertToMedia(r,o.tr,a,e)})}async _convertToVideo(e,{filename:t,mimeType:n,subtitle:i}){const o=await this._getFileInfo(t);this.editor.execute((a,r)=>{let s={filename:t,url:o.url,mime_type:n,subtitle:i};const l=a.schema.node("video",s);this._doConvertToMedia(l,a.tr,r,e)})}async _updateNode(e,{filename:t,option:n,size:i,transcript:o}){const a=await this._getFileInfo(t);this.editor.execute((r,s)=>{const l=r.tr,d=e();let c={filename:t,url:a.url,option:n,size:i};o&&(c.transcript={url:o.url,filename:o.filename}),s(l.replaceWith(d.from,d.to,r.schema.node("attachment",c))),this.editor.view.focus()})}_hasImageNode(){return this.editor.hasNode("image")}_hasVideoNode(){return this.editor.hasNode("video")}_hasAudioNode(){return this.editor.hasNode("audio")}removeNode(e){this.editor.execute((t,n)=>{const i=t.tr,o=this._findAttachmentCollectionBlock(i);if(1===o.node.content.size)i.delete(o.from,o.to);else{let t=e();i.delete(t.from,t.to)}n(i)})}async _convertToAudio(e,{filename:t,mimeType:n,transcript:i}){let o={filename:t,url:(await this._getFileInfo(t)).url,mime_type:n,transcript:i};this.editor.execute((t,n)=>{const i=t.schema.node("audio",o);this._doConvertToMedia(i,t.tr,n,e)})}_doConvertToMedia(e,t,n,i){const o=this._findAttachmentCollectionBlock(t);if(o){if(t.insert(o.to,e),1===o.node.content.size)t.delete(o.from,o.to);else{const e=i();t.delete(e.from,e.to)}n(t)}}async _getFileInfo(e){return this.editor.fileStorage.getFileInfo(e)}async _getDownloadUrl(e){return(await this._getFileInfo(e)).download_url}_getItemId(){return this.editor.fileStorage.getFileStorageItemId()}}t.default=e=>new g(e)},w52A:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));n("GcJT");var i=n("kS2v");class o{constructor(){this._editor=null,this._state=null,this._doc=null,this._html=null,this._map=null,Object.preventExtensions(this)}static fromState(e,t){const n=new o;return n._editor=t,n._state=e,n}static fromDoc(e){const t=new o;return t._doc=e,t}static fromHtml(e){const t=new o;return t._html=e,t}static empty(){return o.fromDoc(Object(i.getDefaultDocument)())}inflated(e){return this._editor==e||this._map&&!!this._map[e.uid]}inflate(e,t){this._editor?(this._map||(this._map={}),this._map[e.uid]=t):(this._editor=e,this._state=t)}getState(e=null){return e?this._editor===e?this._state:this._map&&this._map[e.uid]?this._map[e.uid]:null:this._state}getDoc(e=!0){return e&&(this.applyFormatters(),this._doc=null),this._doc||(this._doc=this._state.toJSON().doc,this._doc&&this._editor&&(this._doc=this._editor._execSerializedVisitors(this._doc,"save"))),this._doc}applyFormatters(){if(!this._editor||!this._state)return;this._editor.extensionFormatters.forEach(e=>{this._state=e(this._state)})}hasHtml(){return!!this._html}getHtml(){return this._html}get isEmpty(){if(this._state){const{doc:e}=this._state;return 0===e.childCount||1===e.childCount&&e.firstChild.isTextblock&&0===e.firstChild.content.size}if(this._doc){if(0===a(this._doc))return!0;if(1===a(this._doc)){const e=this._doc.content[0];return"paragraph"==e.type&&0===a(e)}return!1}return!0}get fileStorageItemId(){return this._editor?this._editor.getFileStorageItemId():null}}function a(e){return e&&e.content?e.content.length:0}},wC1v:function(e,t,n){"use strict";var i=n("TJfd");n.n(i).a},wq8e:function(e,t){e.exports=tui.require("tui/dom/scroll")},xSMd:function(e,t,n){"use strict";var i=n("D2k2");n.n(i).a},yHzl:function(e,t){e.exports=tui.require("editor_weka/components/editing/EditImageAltTextModal")},yrzs:function(e,t){e.exports=tui.require("tui/components/icons/TextBold")},ywTm:function(e,t,n){"use strict";n.r(t);var i=n("tnXT"),o=n.n(i),a=n("vF5l"),r=n.n(a),s=n("AL+t"),l=n.n(s),d=n("hg2Q"),c=n("r4xq"),u=n.n(c),p=n("Mnur"),m=n.n(p),h=n("9Mq8"),f=n.n(h),_=n("vyVp"),g={components:{Button:r.a,CoreVideoBlock:l.a,NodeBar:u.a,ModalPresenter:m.a,ExtraFileUploadModal:f.a},extends:o.a,apollo:{file:{query:d.a,variables(){return{item_id:this.itemId,filename:this.filename}}}},data:()=>({file:{},showModal:!1}),computed:{hasAttachmentNode(){return this.context.hasAttachmentNode()},coreVideoBlockKey(){if(!this.attrs.subtitle)return this.attrs.filename;const{filename:e,subtitle:{filename:t,url:n}}=this.attrs;return`${e}-${t}-${n}`},actions(){return[this.hasAttachmentNode&&{label:this.$str("display_as_attachment","editor_weka"),action:this.$_toAttachment},{label:this.$str("upload_captions","editor_weka"),action:this.openModal},{label:this.$str("remove","core"),action:this.$_removeNode},{label:this.$str("download","core"),action:this.$_download}].filter(Boolean)},itemId(){return this.context.getItemId()},contextId(){if(!this.context.getContextId)throw new Error("No function 'getContextId' was found from extension");return this.context.getContextId()},filename(){return this.attrs.filename?this.attrs.filename:null},subtitleFilename(){return this.attrs.subtitle?this.attrs.subtitle.filename:null},subtitleUrl(){return this.attrs.subtitle?this.attrs.subtitle.url:null},subtitleButtonVisible(){return null===this.attrs.subtitle}},methods:{$_toAttachment(){if(!this.context.replaceWithAttachment)return;const e={filename:this.filename,size:this.file.file_size,subtitle:this.attrs.subtitle||null};this.context.replaceWithAttachment(this.getRange,e)},$_removeNode(){this.context.removeNode&&this.context.removeNode(this.getRange)},async $_download(){window.open(await this.context.getDownloadUrl(this.filename))},openModal(){this.showModal=!0},hideModal(){this.showModal=!1},async cancel(){null===this.subtitleFilename?await this.updateSubtitle(""):this.hideModal()},async onSubtitleChange(e){this.updateSubtitle(e||"")},async updateSubtitle(e){if(this.hideModal(),!this.context.updateVideoWithSubtitle)return;let t=Object.assign({},this.attrs),n=null,i=!1;t.subtitle&&(n=t.subtitle.filename),e?(i=n!==e.filename,t.subtitle={filename:e.filename,url:e.url}):t.subtitle=e,this.context.updateVideoWithSubtitle(this.getRange,t),i&&await Object(_.notify)({message:this.$str("upload_caption_confirmation","editor_weka"),type:"success"})}}},v=(n("lqaC"),n("KHd+")),k=function(e){e.options.__langStrings={core:["loadinghelp","remove","download"],editor_weka:["display_as_attachment","actions_menu_for","upload_captions","video_alt_help","upload_caption_transcript_button","upload_video_caption","upload_caption_confirmation"]}},b=Object(v.a)(g,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaVideoBlock"},[e.$apollo.loading?[n("p",[e._v("\n      "+e._s(e.$str("loadinghelp","core"))+"\n    ")])]:[n("div",{staticClass:"tui-wekaVideoBlock__inner"},[n("ModalPresenter",{attrs:{open:e.showModal},on:{"request-close":e.cancel}},[n("ExtraFileUploadModal",{attrs:{"item-id":e.itemId,"context-id":e.contextId,"accepted-file-types":[".vtt"],"modal-title":e.$str("upload_video_caption","editor_weka"),"submit-button-text":e.$str("upload_caption_transcript_button","editor_weka",".vtt"),"modal-help-text":e.$str("video_alt_help","editor_weka"),filename:e.subtitleFilename},on:{change:e.onSubtitleChange}})],1),e._v(" "),e.subtitleButtonVisible?n("Button",{staticClass:"tui-wekaVideoBlock__inner-addCaptionButton",attrs:{text:e.$str("upload_captions","editor_weka")},on:{click:e.openModal}}):e._e(),e._v(" "),n("CoreVideoBlock",{key:e.coreVideoBlockKey,attrs:{"mime-type":e.file.mime_type,url:e.file.url,filename:e.filename,"subtitle-url":e.subtitleUrl}}),e._v(" "),n("NodeBar",{attrs:{actions:e.actions,"aria-label":e.$str("actions_menu_for","editor_weka",e.filename)}})],1)]],2)}),[],!1,null,null,null);"function"==typeof k&&k(b),b.options.__hasBlocks={script:!0,template:!0};t.default=b.exports},z2s3:function(e,t){e.exports=tui.require("editor_weka/components/toolbar/Toolbar")},zJMb:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return h}));var i=n("i7/w"),o=n.n(i),a=n("H/tB"),r=n.n(a),s=n("Mnur"),l=n.n(s),d=n("OWva"),c=n.n(d),u=(n("/7YT"),n("5vO2"),n("V68o")),p=n("TGM/"),m=n.n(p);class h{constructor(e){this.editor=null,this.options=Object.assign({},e)}setEditor(e){this.editor=e}nodes(){return{}}marks(){return{}}plugins(){return[]}toolbarItems(){return[]}keymap(e){}inputRules(){return[]}getSchema(){return this.editor.schema}applyFormatters(e){return e}get doc(){return this.editor.state.doc}async showModal(e,t){const n=document.createElement("span");this.editor.viewExtrasEl.appendChild(n);const i={component:e,props:t};Object.preventExtensions(i),await r.a.loadRequirements(e);const o=new f({parent:this.editor.getParent(),propsData:{container:i}});return o.$mount(n),new Promise(e=>{o.$on("close-complete",t=>{o.$destroy(),e(t)}),o.show()})}showComponent(e,t){const n=document.createElement("span"),i=o.a.extend(e);this.editor.viewExtrasEl.appendChild(n);const a=new i(Object.assign({parent:this.editor.getParent()},t));return a.$mount(n),a}async showActionDropdown(e,{actions:t}){const n=this.editor.view.coordsAtPos(e),i=this.editor.viewExtrasEl.offsetParent.getBoundingClientRect();await(e=>{const t=m()("sleep");return new Promise(n=>setTimeout(()=>{t(),n()},e))})(0),await Object(u.loadLangStrings)(t.map(e=>e.label));const o=this.showComponent(c.a,{propsData:{location:{x:n.left-i.left,y:n.bottom-i.top},actions:t}});return o.$on("dismiss",()=>{o.$destroy(),o.$el.remove()}),o}removeNode(e){this.editor.execute((t,n)=>{const i=t.tr,o=e();i.delete(o.from,o.to),n(i)})}}const f=o.a.extend({props:{container:{type:Object}},data:()=>({result:null,open:!1}),methods:{show(){this.open=!0},requestClose(e){this.result=e,this.open=!1},closeComplete(){this.$emit("close-complete",this.result)}},render(e){return e(l.a,{props:{open:this.open},on:{"request-close":this.requestClose,"close-complete":this.closeComplete}},[e(this.container.component,{props:this.container.props})])}})},zK61:function(e,t){e.exports=tui.require("editor_weka/mixins/attachment_mixin")},zPke:function(e,t,n){"use strict";n.r(t);var i=n("zJMb"),o=n("cy56"),a=n("V68o"),r=n("Z5hI"),s=n.n(r);class l extends i.default{nodes(){return{ruler:{schema:{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["hr"]}}}}toolbarItems(){return[new o.ToolbarItem({group:"embeds",label:Object(a.langString)("horizontalrule","editor"),iconComponent:s.a,execute:e=>{e.execute((t,n)=>{let i=t.schema.nodes.ruler;n(t.tr.replaceSelectionWith(i.create())),e.view.focus()})}})]}keymap(e){const{ruler:t}=this.getSchema().nodes;e("Mod-_",(e,n)=>(n(e.tr.replaceSelectionWith(t.create()).scrollIntoView()),!0))}}t.default=e=>new l(e)},zTcH:function(e,t){e.exports=tui.require("ext_prosemirror/commands")},ziKp:function(e,t){e.exports=tui.require("editor_weka/components/nodes/Attachment")},zunS:function(e,t,n){"use strict";var i=n("+sid");n.n(i).a},zyVY:function(e,t){e.exports=tui.require("tui/components/icons/Emoji")}});