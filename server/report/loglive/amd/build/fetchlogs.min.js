define(["core/config","core/str","core/notification"],function(a,b,c){function d(){o.style.display="none"}function e(){o.style.display=""}function f(){e();const b={logreader:p.logreader,since:p.since,page:p.page,id:p.courseid},c=Object.keys(b).map(function(a){return a+"="+b[a]}).join("&"),d=a.wwwroot+"/report/loglive/loglive_ajax.php?"+c,f="report_loglive_fetchlogs";M.util.js_pending(f),fetch(d,{credentials:"same-origin",method:"get"}).then(function(a){return a.json()}).then(function(a){g(a),M.util.js_complete(f)})}function g(a){setTimeout(d,600),a||c.exception(a),p.since=a.until;const b=a.logs,e=document.querySelector(l.TBODY);if(e&&b){e.insertAdjacentHTML("afterbegin",b);for(const f=p.perpage;e.childNodes.length>f;)e.removeChild(e.lastElementChild);setTimeout(h,5e3)}}function h(){for(var a=document.querySelectorAll(".time"+p.since),b=0;b<a.length;b++)a[b].classList.remove(k.NEWROW)}function i(a){b.get_string(a,"report_loglive").done(function(a){n.innerText=a})}function j(){m?(i("resume"),clearInterval(m),m=null):(i("pause"),f(),m=setInterval(f,1e3*p.interval))}const k={NEWROW:"newrow",SPINNER:"spinner"},l={NEWROW:"."+k.NEWROW,TBODY:".flexible tbody",PAUSEBUTTON:"#livelogs-pause-button",SPINNER:"."+k.SPINNER};var m,n,o,p={since:null};return{init:function(a,b,c,e,g,h){Object.assign(p,{since:a,courseid:b||0,page:c||0,logreader:e||"logstore_standard",interval:g||60,perpage:h||100}),n=document.querySelector(l.PAUSEBUTTON),o=document.querySelector(l.SPINNER),d(),n.addEventListener("click",j),0===p.page&&(f(),m=setInterval(f,1e3*p.interval))}}});