define(["core/str"],function(a){function b(b){i&&b.data.sender&&"auth_callback"===b.data.sender&&("success"===b.data.status?c(f.value):a.get_string("connectionfailed","mod_facetoface").then(function(a){document.querySelector(".mod_facetoface-connected").innerText=a}),i.close())}function c(b){M.util.js_pending("mod_facetoface-room_integration-oauth_confirmation"),h.value=0,new Promise(function(a){require(["core/ajax"],a)}).then(function(a){return a.call([{methodname:"mod_facetoface_user_profile",args:{plugin:b}}])[0]}).then(function(b){return"name"in b?("friendly_name"in b&&(b.name=b.friendly_name),"email"in b?a.get_string("connectedasx","mod_facetoface",b):a.get_string("connectedas","mod_facetoface",b.name)):Promise.resolve("")}).then(function(a){h.value=""!==a?1:0,document.querySelector(".mod_facetoface-connected").innerText=a,M.util.js_complete("mod_facetoface-room_integration-oauth_confirmation")})["catch"](function(){document.querySelector(".mod_facetoface-connected").innerText="",M.util.js_complete("mod_facetoface-room_integration-oauth_confirmation")})}function d(){var a=document.querySelector('[name="'+f.value+'_auth_endpoint"]');i&&i.close(),a?(g.disabled=!1,c(f.value)):(g.disabled=!0,h.value=1)}function e(a){if(!g.disabled){a.preventDefault();var b=document.querySelector('[name="'+f.value+'_auth_endpoint"]');b&&(!i||i.closed?i=window.open(b.value,"virtualmeeting_connect","width=400,height=500,opener"):i.focus())}}var f,g,h,i=null;return{init:function(){f=document.getElementById("id_plugin"),g=document.getElementById("show-authorise-dialog"),g.disabled=!0,h=document.getElementById("plugin-connection-state"),h.value=0,d(),f.removeEventListener("change",d),f.addEventListener("change",d),g.removeEventListener("click",e),g.addEventListener("click",e),window.removeEventListener("message",b),window.addEventListener("message",b)}}});