define(["core/log"],function(a){var b="data-core-autoinitialise",c="data-core-autoinitialise-amd",d="true",e="initialising",f="done",g="error",h=function(){var h=Array.prototype.slice.apply(document.querySelectorAll("["+b+"="+d+"]")),i=function(c,d){a.error(d),c.setAttribute(b,g)},j=function(a){var d=a.getAttribute(c);return null===d?(i(a,'AMD module cannot be autoinitialised because "'+c+'" attribute is missing'),null):d.match(/^[a-zA-Z0-9\/_-]+$/g)?(a.setAttribute(b,e),{amdModule:d,element:a}):(i(a,'AMD module cannot be autoinitialised because "'+c+'" attribute is invalid'),null)},k=function(a){return new Promise(function(b){return a?void require([a.amdModule],function(c){a.js=c,b(a)},function(){i(a.element,'Failed to load AMD module "'+a.amdModule+'"'),b()}):void b()})},l=function(a){return new Promise(function(c){if(!a)return void c();if("undefined"==typeof a.js.init)return i(a.element,'AMD module "'+a.amdModule+'" cannot be autoinitialised because init method is missing'),void c();try{var d=a.js.init(a.element);d&&"function"==typeof d.then?d.then(function(){a.element.setAttribute(b,f),c()})["catch"](function(b){i(a.element,b),c()}):(a.element.setAttribute(b,f),c())}catch(e){i(a.element,'AMD module "'+a.amdModule+'" failed to autoinitialise'),c()}})};return Promise.all(h.map(j).map(k)).then(function(a){return Promise.all(a.map(l))})};return{scan:h}});