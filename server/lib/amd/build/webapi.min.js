define(["core/config","core/log"],function(a,b){function c(a){if(Error.call(this,a.message),this.graphQLErrors=a.graphQLErrors||[],this.networkError=a.networkError||null,a.message)this.message=a.message;else{var b=[];Array.isArray(this.graphQLErrors)&&this.graphQLErrors.forEach(function(a){var c=a?a.message:"Error message not found.";b.push("GraphQL error: "+c)}),this.networkError&&b.push("Network error: "+this.networkError.message),this.message=b.join("\n")}}function d(a){return a instanceof c?a:new c(a instanceof Error?{networkError:a}:a&&a.errors?{graphQLErrors:a.errors}:{message:String(a)})}function e(a,b,c){var d=Array.isArray(c);for(var e in a){var f=d?c[e]:c;a[e][b](f)}}function f(a,b){function c(){var a=d;d=null;var c=a.map(function(a){return a.arg});b(c).then(function(b){e(a,"resolve",b)},function(b){e(a,"reject",b)}).then(function(){M.util.js_complete(o)})}var d=null,f=null;return function(b){return null===d&&(d=[],f=setTimeout(c,a.timeout),M.util.js_pending(o)),new Promise(function(e,g){d.push({arg:b,resolve:e,reject:g}),d.length>=a.maxSize&&(clearTimeout(f),c())})}}function g(c){M.util.js_pending(n);var d=a.wwwroot+"/totara/webapi/ajax.php"+(Array.isArray(c)?"?operationNames="+c.map(function(a){return a.operationName}).join(","):"?operationName="+c.operationName);return new Promise(function(e,f){fetch(d,{credentials:"same-origin",method:"post",body:JSON.stringify(c),headers:new Headers({"X-Totara-Sesskey":a.sesskey})}).then(function(a){return a.ok?a.json():a.json().then(function(a){return Promise.reject(a)},function(){throw new Error("Request failed with status code "+a.status)})}).then(function(a){M.util.js_complete(n),e(a)})["catch"](function(a){M.util.js_complete(n),m?(b.error("Page unloaded."),b.error(a)):(b.error(a),f(a))})})}function h(a){return{operationName:a.operationName,variables:a.variables||{},extensions:a.extensions}}function i(a){return a.then(function(a){return a.errors?Promise.reject(a):a.data})["catch"](function(a){return Promise.reject(d(a))})}const j=10,k=10;var l=!1,m=!1,n="core_webapi",o="core_webapi_timeout";c.prototype=Object.create(Error.prototype),c.prototype.constructor=c,c.prototype.name="";var p={timeout:j,maxSize:k},q=f(p,g),r=f(p,g);return{call:function(a){l||(window.addEventListener("beforeunload",function(){m=!0}),l=!0);var b,c=h(a);return b=a.batch?a.operationName.endsWith("_nosession")?r(c):q(c):g(c),a.rawResponse?b:i(b)}}});