define(["core/modal_factory","core/modal_events","core/ajax","core/str","core/notification","core/templates"],function(a,b,c,d,e,f){function g(f,g){k=!0;var i=f.getAttribute("data-evidence-"+g+"-actions");c.call([{methodname:"type"===g?"totara_evidence_type_data":"totara_evidence_item_info",args:{id:i}}])[0].then(function(c){var e="type"===g?c.fields.length:null;d.get_strings([{key:"confirm_delete_"+g,component:"totara_evidence",param:c.display_name},{key:"confirm_delete_"+g+"_body",component:"totara_evidence",param:e}]).then(function(d){return a.create({title:d[0],body:d[1],type:a.types.CONFIRM}).then(function(a){a.show(),k=!1,a.getRoot().on(b.yes,function(){h(c,g)})})})})["catch"](function(){d.get_string("error_notification_generic","totara_evidence").then(function(a){e.clearNotifications(),e.addNotification({message:a,type:"error"})})})}function h(a,b){M.util.js_pending("totara_evidence_delete_"+a.id),c.call([{methodname:"totara_evidence_"+b+"_delete",args:{id:a.id}}])[0].then(function(){M.util.js_complete("totara_evidence_delete_"+a.id),window.location.reload(!0)})["catch"](function(){d.get_string("error_notification_delete_"+b,"totara_evidence",a.display_name).then(function(c){e.addNotification({message:c,type:"error"}),M.util.js_complete("totara_evidence_"+b+"_delete_"+a.id)})})}function i(a,b){var g=a.getAttribute("data-evidence-type-actions");M.util.js_pending("totara_evidence_type_set_visibility_"+g),c.call([{methodname:"totara_evidence_type_set_visibility",args:{id:g,visible:b}}])[0].then(function(){c.call([{methodname:"totara_evidence_type_data",args:{id:g}}])[0].then(function(c){Promise.all([d.get_string("notification_type_"+(b?"visible":"hidden"),"totara_evidence",c.display_name),f.render("totara_evidence/type_list_actions",c)]).then(function(b){f.replaceNodeContents(a.parentElement,b[1]),e.clearNotifications(),e.addNotification({message:b[0],type:"success"}),M.util.js_complete("totara_evidence_type_set_visibility_"+g)})})})["catch"](function(){d.get_string("error_notification_generic","totara_evidence").then(function(a){e.clearNotifications(),e.addNotification({message:a,type:"error"})})})}function j(){document.querySelector("#region-main").addEventListener("click",function(a){k||(a.target.closest("[data-evidence-item-delete]")?(a.preventDefault(),g(a.target.closest("[data-evidence-item-actions]"),"item")):a.target.closest("[data-evidence-type-delete]")?(a.preventDefault(),g(a.target.closest("[data-evidence-type-actions]"),"type")):a.target.closest("[data-evidence-type-hide]")?(a.preventDefault(),i(a.target.closest("[data-evidence-type-actions]"),!1)):a.target.closest("[data-evidence-type-show]")&&(a.preventDefault(),i(a.target.closest("[data-evidence-type-actions]"),!0)))})}var k=!1;return{init:j}});