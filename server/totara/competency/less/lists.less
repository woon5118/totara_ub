//
// This file is part of Totara Learn
//
// Copyright (C) 2019 onwards Totara Learning Solutions LTD
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 3 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with this program.  If not, see <http://www.gnu.org/licenses/>.
//
// @copyright 2018 onwards Totara Learning Solutions LTD
// @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
// @author    Kevin Hottinger <kevin.hottinger@totaralearning.com>
// @package   theme_roots

// Variables
// Colours
@list-color_neutral_1: @totara_style-color_neutral_1;
@list-color_neutral_2: @totara_style-color_neutral_2;
@list-color_neutral_4: @totara_style-color_neutral_4;
@list-color_neutral_5: @totara_style-color_neutral_5;
@list-color_neutral_6: @totara_style-color_neutral_6;
@list-color_neutral_8: @totara_style-color_neutral_8;
@list-color_alert: @totara_style-color_alert;
@list-color_theme: @totara_style-color_theme_1;
@list-color_hover: lighten(@list-color_neutral_2, 2.5%);

// Shadows
@list-shadow_1: @totara_style-shadow_1;

// Spacing
@list-spacing_x_small: @totara_style-spacing_x_small;
@list-spacing_small: @totara_style-spacing_small;
@list-spacing_medium: @totara_style-spacing_medium;
@list-spacing_x_large: @totara_style-spacing_x_large;
@list-spacing_xx_large: @totara_style-spacing_xx_large;
@list-spacing_xxx_large: @totaranav-spacing_xxx_large;
// Break point
@list-screen_xsm_min: 550px;
@list-screen_sm_min: @totara_style-screen_sm_min;
//transition
@list-icon-hover_movement: -1px;

.tw-list {
    &__bar {
        align-items: center;
        display: flex;
        flex-wrap: wrap;
        margin-bottom: @list-spacing_small;

        > * {
            padding-top: @list-spacing_medium;
        }
    }

    &__btn {
        .totara_style-btn;
    }

    &__btnGroup {
        .totara_style-btnGroup;
        margin-right: @list-spacing_small;

        .tw-list__btn {
            .totara_style-btn;
        }
    }

    &__count {
        align-items: center;
        display: flex;
        font-size: @totara_style-size_15;
        font-weight: bold;
        margin-left: auto;
        order: 1;

        &_num {
            padding: 0 @list-spacing_x_small;
        }

        &_text {
            margin-right: @list-spacing_small;
        }
    }

    &__empty {
        border-bottom: 1px solid @list-color_neutral_5;
        border-top: 1px solid @list-color_neutral_5;
        font-style: italic;
        margin: @list-spacing_small 0;
        padding: @list-spacing_medium @list-spacing_small;
    }

    &__cell {
        height: 100%;
        margin: auto @list-spacing_small;
        padding: 0 @list-spacing_xxx_large 0 @list-spacing_x_large;

        &_hierarchy {
            margin: auto 0;
            padding: 0;
            position: absolute;
            right: 0;
            top: @list-spacing_x_small;
            text-align: right;

            &_btn {
                display: inline-block;
                font-size: @totara_style-size_16;
                margin-top: @list-spacing_small;
                padding: 0 @list-spacing_small;
            }
        }

        &_action {
            &_btn {
                display: inline-block;
                line-height: 2;
                margin-right: @list-spacing_medium;
                margin-top: @list-spacing_small;

                &_disabled {
                    color: @list-color_neutral_4;
                    cursor: default;

                    .flex-icon {
                        color: @list-color_neutral_4;
                    }
                }

                &_hidden {
                    visibility: hidden;
                }
            }
        }

        &_label {
            color: @list-color_neutral_6;
            display: inline-block;
            font-size: @totara_style-size_11;
            font-weight: bold;
            margin-right: @list-spacing_small;
            padding-top: @list-spacing_small;
        }

        &_primary {
            font-weight: bold;
            padding-top: @list-spacing_small;
        }

        &_select {
            margin: auto 0;
            padding: 0;
            position: absolute;

            &_label {
                margin-bottom: 0;
                padding: 0.1rem @list-spacing_medium @list-spacing_x_small 0;
            }

            &_checkbox {
                cursor: pointer;
            }

        }
    }

    &__expanded {
        display: none;

        &_close {
            font-size: 2rem;
            position: absolute;
            right: @list-spacing_small;
            top: .4rem;
            z-index: 2;

            .flex_icon {
                vertical-align: text-top;
            }
        }

        &_content {
           background: @list-color_neutral_1;
           border: 1px solid @list-color_neutral_5;
           box-shadow: @list-shadow_1;
           height: 100vh;
           overflow-x: hidden;
           overflow-y: scroll;
           padding: @list-spacing_medium;
           position: relative;
        }

        &_loading {
            text-align: center;
        }

        &_placement {
           height: 0;
           left: 0;
           padding: 0;
           position: fixed;
           top: 0;
           width: 100vw;
           z-index: 4;
        }

        &_show {
            display: block;
        }
    }

    &__footer {
        .clearfix;
    }

    &__orderBy {
        display: flex;
        margin-left: auto;
        order: 0;
        width: 100%;

        .tw-selectTree {
            padding-right: 0;
        }
    }

    &__row {
        display: flex;
        flex-direction: column;
        padding: @list-spacing_medium 0 @list-spacing_small;
        position: relative;

        &:not(:first-child) {
            border-top: 1px solid @list-color_neutral_5;
        }

        &:hover:not(:first-child) {
            background: @list-color_hover;
        }

        &:last-child {
            border-bottom: 1px solid @list-color_neutral_5;
        }

        &_active {
            background:  @list-color_neutral_2;

            &:hover {
                background:  @list-color_neutral_2;
            }
        }

        &_hover {
            background: @list-color_hover;
        }

        &_disabled {
            color: @list-color_neutral_5;

            .tw-list__row_trigger {
                color: @list-color_neutral_5;
            }
        }

        &_expanded {
            .tw-list__row_trigger {
                font-weight: bold;
            }
        }

        &_header {
            font-weight: bold;
            padding: @list-spacing_x_small 0;

            .tw-list__cell {
                display: none;

                &_label {
                    color: @list-color_neutral_8;
                    display: inline-block;
                    padding-left: @list-spacing_x_small;
                }

                &_select {
                    display: block;
                    position: relative;
                }
            }
        }

        .tw-list__hover_warning {
            color: @list-color_alert;
        }
    }

    &__toggleView {
        order: 1;
        position: relative;
    }
}

.modal-body {
    .tw-list {
        &__output {
            max-height: 350px;
            overflow-y: auto;
            padding-right: 2rem;
        }
    }
}

@media (min-width: @list-screen_xsm_min) {
    .tw-list {
        &__empty {
            border-color: @list-color_neutral_4;
        }

        &__cell {
            flex-basis: 40%;
            flex-grow: 1;
            margin: auto 0;
            overflow: hidden;
            overflow-wrap: break-word;
            padding: 0 @list-spacing_medium 0 0;

            &_hierarchy {
                width: 3rem;
                flex-shrink: 0;
            }

            &_action,
            &_hierarchy {
                flex-basis: auto;
                margin-left: auto;
                padding-right: @list-spacing_x_small;
                position: relative;
                right: 0;
                text-align: right;
                top: 0;

                &_btn {
                    margin: 0 @list-spacing_small;
                    padding: 0;

                    .flex-icon {
                        vertical-align: baseline;
                    }
                }
            }

            &_label {
                display: none;
            }

            &_select {
                flex-basis: auto;
                flex-grow: 0;
                flex-shrink: 0;
                margin-right: @list-spacing_small;
                padding: 0;
                position: relative;
                width: 3rem;

                &_label {
                    cursor: pointer;
                    padding: @list-spacing_x_small @list-spacing_small @list-spacing_x_small @list-spacing_x_small;

                    &_disabled {
                        cursor: default;
                    }
                }

            }

            &--sm {
                flex-basis: 25%;
                flex-grow: 0;
            }
        }

        &__expanded {
            margin: @list-spacing_medium 0;


            &_arrow {
                bottom: -1.5px;
                margin: @list-spacing_medium auto 0;
                position: relative;
                z-index: 4;

                &::before,
                &::after {
                   border: solid transparent;
                   bottom: .5px;
                   content: "";
                   height: 0;
                   left: @list-spacing_xx_large;
                   position: absolute;
                   width: 0;
                }

                &::before {
                   border-bottom-color: @list-color_neutral_5;
                   border-width: @totara_style-size_16;
                   margin-left: -@totara_style-size_16;
                }

                &::after {
                   border-bottom-color: @list-color_neutral_1;
                   border-width: @totara_style-size_15;
                   margin-left: -@totara_style-size_15;
                }
            }

            &_content {
                height: inherit;
                overflow-y: hidden;
            }

            &_placement {
                height: inherit;
                left: 0;
                position: relative;
                top: inherit;
                width: 100%;
                z-index: initial;
            }
        }

        &__row {
            flex-direction: row;
            padding: @list-spacing_small 0;

            &_header {
                .tw-list__cell {
                    display: block;

                    &_label {
                        display: none;
                    }
                }
            }

            .tw-list__hover_warning {
                color: @list-color_neutral_5;
            }

            .tw-list__cell_hierarchy_btn,
            .tw-list__cell_action_btn {
                color: @list-color_neutral_5;
                display: inline-block;
                position: relative;
                top: 0;
                transition: all .06s ease;
                transition-property: top, color;
            }

            &_active,
            &:hover {
                .tw-list__cell_hierarchy_btn,
                .tw-list__cell_action_btn {
                    color: @list-color_theme;

                    &:focus,
                    &:hover {
                        top: @list-icon-hover_movement;
                    }
                }

                .tw-list__hover_warning {
                    color: @list-color_alert;
                }
            }
        }
    }
    .tw-list--viewer {
        .tw-list {
            &__row {
                padding-left: @list-spacing_x_small;
            }
        }
    }
}

@media (min-width: @list-screen_sm_min) {
    .tw-list {
        &__bar {
            > * {
                padding-top: @list-spacing_small;
            }
        }

        &__count {
            margin-left: @list-spacing_x_small;
        }

        &__orderBy {
            order: 1;
            width: auto;
        }
    }

    .tw-list--viewer {
        .tw-list__count_num {
            padding-left: 0;
        }
    }
}
