define(["core/str","core/templates"],function(a,b){function c(){return this instanceof c?(this.args={id:null,include:{crumbs:1}},this.eventListener="totara_core/crumbtrail",this.eventNode="",this.heading="",this.strings={levelTop:"",top:""},this.template="totara_competency/crumb_with_title_body",this.webservice=null,this.widget=null,void(this.stringList=[])):new c}c.prototype.bubbledEventsListener=function(){var a=this;this.eventNode.addEventListener(this.eventListener+":click",function(b){a.onCrumbtrailChange(b.detail)})},c.prototype.clearCrumbtrail=function(){this.widget&&(this.widget.innerHTML="")},c.prototype.formatCrumbData=function(a){return new Promise(function(b){b(a)})},c.prototype.getWebservice=function(){return this.webservice},c.prototype.onCrumbtrailChange=function(a){a.isTopLevel?this.onCrumbtrailChangeToTopLevel(a):this.onCrumbtrailChangeLevel(a)},c.prototype.onCrumbtrailChanged=function(){},c.prototype.onCrumbtrailChangeLevel=function(){},c.prototype.onCrumbtrailChangeToTopLevel=function(){},c.prototype.loadCrumbStrings=function(){var b=this;return new Promise(function(c){a.get_strings(b.stringList).then(function(a){b.strings.top=a[0],b.strings.levelTop=a[1],b.setHeadingToTop(),c()})})},c.prototype.renderCrumbtrail=function(a){var c=this;return new Promise(function(d){return c.widget&&a.crumbtrail?void c.formatCrumbData(a).then(function(a){b.renderReplace(c.template,a,c.widget).then(function(){d()})}):(c.clearCrumbtrail(),void d())})},c.prototype.renderLevelHeader=function(a){var b=a.fullname,c=this;return new Promise(function(a){b&&c.setHeading(b),a()})},c.prototype.setHeading=function(a){this.heading&&(this.heading.innerHTML=a)},c.prototype.setHeadingToTop=function(){this.heading&&(this.heading.innerHTML=this.strings.top)},c.prototype.setHeadingToLevelTop=function(){this.heading&&(this.heading.innerHTML=this.strings.levelTop)},c.prototype.setParentId=function(a){this.args.id=a},c.prototype.setParent=function(a){this.widget=a},c.prototype.setParentEventNode=function(a){this.eventNode=a},c.prototype.setHeadingNode=function(a){this.heading=a},c.prototype.setWebservice=function(a){this.webservice=a},c.prototype.toggleClass=function(a){this.widget.classList.toggle(a)},c.prototype.removeClass=function(a){this.widget.classList.remove(a)},c.prototype.headingToggleClass=function(a){this.heading&&this.heading.classList.toggle(a)},c.prototype.headingRemoveClass=function(a){this.heading&&this.heading.classList.remove(a)},c.prototype.updateCrumbAndHeader=function(){var a=this;return{args:a.args,callback:[a.renderCrumbtrail.bind(a),a.renderLevelHeader.bind(a),a.onCrumbtrailChanged],methodname:a.getWebservice()}};var d=function(a,b){var d=new c,e=a.querySelector("[data-tw-crumbtrailWithTitle]"),f=a.querySelector("[data-tw-crumbtrailWithTitle-heading]");return d.setParent(e),d.setParentEventNode(a),d.setHeadingNode(f),d.setWebservice(b.service),d.stringList=b.stringList,d.bubbledEventsListener(),d};return{init:d}});