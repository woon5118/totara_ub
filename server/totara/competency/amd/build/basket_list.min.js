define(["core/ajax","totara_competency/filters","totara_competency/basket_manager","totara_competency/crumb_manager","totara_competency/action_list_manager","totara_competency/filter_manager","totara_competency/loader_manager","totara_competency/simple_basket","totara_competency/session_basket"],function(a,b,c,d,e,f,g,h,i){function j(){return this instanceof j?(this.basketManager=null,this.hideClass="tw-basketlist__hide",this.crumb=null,this.filters=null,this.loader=null,this.listParent=null,this.list=null,void(this.selectors=null)):new j}return j.prototype.setListParent=function(a){this.listParent=a.querySelector("[data-tw-basket-list]")},j.prototype.reset=function(){this.filters.clearFilters(),this.crumb&&(this.crumb.clearCrumbtrail(),this.crumb.setHeadingToTop()),this.selectors.clearFiltersRegionPanel(),this.selectors.clearPrimarySearch(),this.selectors.clearPrimaryTree(),this.list.disableToggleLevel()},j.prototype.updatePage=function(b){var c=this;return new Promise(function(d,e){a.getDataUpdate(b).then(function(){c.loader.hide(),d()})["catch"](function(){c.loader.hide(),e()})})},j.prototype.basketEvents=function(a){var b=this;a.onBasketClear=function(){b.loader.show(),b.basketManager.deleteAndRender().then(function(){a.onBasketHide(),b.loader.hide()})},a.onBasketHidden=function(){b.crumb&&(b.crumb.removeClass(b.hideClass),b.crumb.headingRemoveClass(b.hideClass)),a.load().then(function(){b.filters.removeFilter("ids"),b.filters.removeFilter("basket"),b.list.update()}),b.selectors.primarySearchRemoveClass(b.hideClass),b.selectors.primaryTreeRemoveClass(b.hideClass)},a.onBasketHide=function(){a.toggleExpandedView(),a.toggleShowBasketBtn(),b.reset(),b.list.enabledActions=!0,b.list.enabledHierarchy=!0,b.list.paging.resetPageNumber(),b.list.update()},a.onBasketShow=function(){a.toggleExpandedView(),a.toggleShowBasketBtn(),b.selectors.primarySearchToggleClass(b.hideClass),b.selectors.primaryTreeToggleClass(b.hideClass),b.crumb&&(b.crumb.toggleClass(b.hideClass),b.crumb.headingToggleClass(b.hideClass)),b.list.disableToggleLevel(),b.loader.show(),b.filters.clearFilters(),b.selectors.clearFiltersRegionPanel(),b.list.enabledActions=!1,b.list.enabledHierarchy=!1,b.list.paging.setPageNumber(0),a.getBasket()instanceof i?(b.filters.setFilter("basket",a.getBasketKey()),b.list.update()):a.load().then(function(a){b.filters.setFilter("ids",a),b.list.update()})},a.onBasketUpdate=function(a){b.list.selectedItems=a}},j.prototype.filterEvents=function(a){var b=this;a.onFiltersUpdate=function(){b.list.setRequestArg("filters",a.getFilters())}},j.prototype.listEvents=function(a){var b=this;a.onListHierarchyLevelChange=function(c){b.filters.clearFilters(),b.selectors.clearFiltersRegionPanel(),b.selectors.clearPrimarySearch(),b.filters.setFilter(c.detail.key,c.detail.val,c.detail.groupValues),b.crumb.setParentId(c.detail.val),a.resetToggleLevel(),b.loader.show(),b.updatePage([b.list.getUpdateRequestArgs(),b.crumb.updateCrumbAndHeader()])},a.onItemSelected=function(c){a.toggleSelectDisable(!0),b.basketManager.queueAdd(c)},a.onItemUnselected=function(c){a.toggleSelectDisable(!0),b.basketManager.queueRemove(c)},a.onItemUpdate=function(){b.basketManager.updateAndRender().then(function(){a.toggleSelectDisable(!1)})},a.onPreRequest=function(){b.loader.show()},a.onPostRequest=function(){b.loader.hide()}},j.prototype.selectorEvents=function(a){var b=this;a.onFilterRegionPanelAdd=function(a){b.filters.setFilter(a.detail.key,a.detail.val,a.detail.groupValues)},a.onFilterRegionPanelUpdate=function(){b.list.update()},a.onFilterRegionPanelReset=function(a){var c=a.detail.groupValues?a.detail.groupValues:"";b.filters.removeFilter(a.detail.key,c)},a.onPrimaryFilterSearchAdd=function(a){b.filters.setFilter(a.detail.key,a.detail.val,a.detail.groupValues)},a.onPrimaryFilterSearchUpdate=function(){b.list.update()},a.onPrimaryFilterSearchReset=function(a){var c=a.detail.groupValues?a.detail.groupValues:"";b.filters.removeFilter(a.detail.key,c)},a.onPrimaryFilterTreeAdd=function(a){b.filters.setFilter(a.detail.key,a.detail.val,a.detail.groupValues)},a.onPrimaryFilterTreeUpdate=function(){b.list.update()},a.onPrimaryFilterTreeReset=function(a){var c=a.detail.groupValues?a.detail.groupValues:"";b.filters.removeFilter(a.detail.key,c)}},j.prototype.initExtend=function(){},j.prototype.generateBasketKey=function(){return"simplebasket."+Math.floor(Math.random()*Math.floor(Number.MAX_SAFE_INTEGER)).toString(36)},j.prototype.init=function(a){var j=a.parent,k=a.basketKey+"Pause",l=this;return new Promise(function(m){M.util.js_pending(k),l.setListParent(j),l.loader=g.init(j),l.loader.show(),l.filters=new b,l.filterEvents(l.filters),a.list.defaultFilters&&(l.filters.setDefaults(a.list.defaultFilters),a.list.serviceArgs&&a.list.serviceArgs.filters?a.list.serviceArgs.filters=Object.assign(a.list.serviceArgs.filters,a.list.defaultFilters):(a.list.serviceArgs||(a.list.serviceArgs={}),a.list.serviceArgs.filters=a.list.defaultFilters));var n=null;a.basket?n=a.basket:(a.basketKey||(a.basketKey=l.generateBasketKey()),n="session"===a.basketType?new i(a.basketKey):new h(a.basketKey)),l.basketManager=c.init(j,n),l.basketEvents(l.basketManager),a.crumbtrail&&(l.crumb=d.init(j,a.crumbtrail)),a.list.map.hasCheckboxes=!0,l.list=e.init(j,a.list),l.listEvents(l.list),l.selectors=f.init(j),l.selectorEvents(l.selectors),l.initExtend(),m();var o=[l.list.prepare()];a.crumbtrail&&o.push(l.crumb.loadCrumbStrings()),Promise.all(o).then(function(){l.basketManager.loadAndRender().then(function(){l.updatePage([l.list.getUpdateRequestArgs()]),M.util.js_complete(k)})})})},j});