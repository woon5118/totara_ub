define(["core/notification","core/str","core/webapi"],function(a,b,c){function d(b,c){var d=this;this.userid=b,this.container=c,this.container.setAttribute("data-enhanced","true"),this.container.addEventListener("click",function(b){if(b.target){var c,e,f,h=b.target.closest("a[data-action]");if(h){if(b.preventDefault(),b.stopPropagation(),e=h.closest("li"),!e)return void a.alert("Could not find clicked job list item");if(f=e.querySelector("a.editjoblink"),!f)return void a.alert("Could not find clicked job list item link");if(c=f.dataset.id,!c)return void a.alert("Could not find clicked job assignment id");switch(h.dataset.action){case g.up:d.moveAssignmentUp(c);break;case g.down:d.moveAssignmentDown(c);break;case g.deleteItem:d.confirmDelete(c);break;default:a.alert("No valid action found")}}}})}const e="totara_job",f={getAssignment:"totara_job_assignment",deleteAssignment:"totara_job_delete_assignment",sortAssignments:"totara_job_sort_assignments"},g={up:"up",down:"down",deleteItem:"delete"},h={containers:function(a){return document.querySelectorAll('[data-enhance="job-management-listing"][data-enhanced="false"][data-userid="'+a+'"]')},jobListItem:function(b,c){var d,e=b.querySelector('ul a.editjoblink[data-id="'+c+'"]');return e?(d=e.closest("li"),d?d:(a.alert("Could not find job list item"),!1)):(a.alert("Could not find job list item link"),!1)},moveJobItemUp:function(a,b,c){var d=h.jobListItem(a,b),e=d.closest("ul"),f=d.previousElementSibling;null!==e&&null!==f&&(e.insertBefore(d,f),c=c===!0||"current"===c?d:f,c.classList.add("highlight"),setTimeout(function(){c.classList.remove("highlight")},500))},itemIds:function(a){var b=[],c=a.querySelectorAll("ul.joblist > li > a"),d=0;for(d=0;d<c.length;d++)b.push(c[d].dataset.id);return b},itemIndex:function(a,b){return b.findIndex(function(b){return b.toString()===a.toString()})}};return d.prototype.userid=null,d.prototype.container=null,d.prototype.confirmDelete=function(d){var g=this;M.util.js_pending(f.getAssignment),c.call({operationName:f.getAssignment,variables:{assignmentid:d}}).then(function(c){var h=c[f.getAssignment],i=[{key:"deletejobassignment",component:e,param:null,lang:null},{key:"confirmdeletejobassignment",component:e,param:h.fullname,lang:null},{key:"yesdelete",component:"totara_core",param:null,lang:null},{key:"cancel",component:"core",param:null,lang:null}];h.staffcount&&h.tempstaffcount?(i.push({key:"warningstaffaffectednote",component:e,param:null,lang:null}),i.push({key:"warningallstafftypeassigned",component:e,param:{countstaffassigned:h.staffcount,counttempstaffassigned:h.tempstaffcount},lang:null})):h.staffcount?i.push({key:"warningstaffassigned",component:e,param:h.staffcount,lang:null}):h.tempstaffcount&&i.push({key:"warningtempstaffassigned",component:e,param:h.tempstaffcount,lang:null}),b.get_strings(i).done(function(b){var c=b[1];b[4]&&(c+="\n"+b[4]),b[5]&&(c+="\n"+b[5]),a.confirm(b[0],c,b[2],b[3],function(){g.deleteAssignment(d)}),setTimeout(function(){M.util.js_complete(f.getAssignment)},100)})})},d.prototype.deleteAssignment=function(a){var b=this;M.util.js_pending(f.deleteAssignment),c.call({operationName:f.deleteAssignment,variables:{userid:this.userid,assignmentid:a}}).then(function(){var c=h.jobListItem(b.container,a);c.parentElement.removeChild(c),b.container.setAttribute("data-jobcount",h.itemIds(b.container).length),M.util.js_complete(f.deleteAssignment)},function(){M.util.js_complete(f.deleteAssignment)})},d.prototype.moveAssignmentUp=function(a){var b=this,c=h.itemIds(this.container),d=h.itemIndex(a,c)-1;d<0||(c.splice(d,2,a.toString(),c[d]),this.sortAssignments(c,function(){h.moveJobItemUp(b.container,a,!0)}))},d.prototype.moveAssignmentDown=function(a){var b,c=this,d=h.itemIds(this.container),e=h.itemIndex(a,d);e>=d.length||(b=d[e+1],d.splice(e,2,b,a.toString()),this.sortAssignments(d,function(){h.moveJobItemUp(c.container,b,!1)}))},d.prototype.sortAssignments=function(a,b){M.util.js_pending(f.sortAssignments),c.call({operationName:f.sortAssignments,variables:{userid:this.userid,assignmentids:a}}).then(function(){b(),M.util.js_complete(f.sortAssignments)},function(){M.util.js_complete(f.sortAssignments)})},{init:function(a){var b=h.containers(a),c=0;for(c=0;c<b.length;c++)new d(a,b[c])}}});