define(["core/str"],function(a){function b(b){var c=this;this.element=b,this.allowEmpty="true"===this.element.getAttribute("data-inline-edit-allow-empty"),this.maxLength=this.element.getAttribute("data-inline-edit-max-length")||0,this.controller=this.element.querySelector("[data-inline-edit-control]"),this.target=this.element.querySelector("[data-inline-edit]");var d=this.element.querySelector("[data-inline-edit-input]");if(!d){var e=this.target.getAttribute("class")||"";this.target.insertAdjacentHTML("afterend",'<input class="'+e+'" data-inline-edit-input type="text">'),d=this.element.querySelector("[data-inline-edit-input]")}this.input=d,this.input.style.display="none";var f=this.element.querySelector("[data-inline-edit-tooltip]");f?d.setAttribute("aria-label",f.textContent):(this.target.insertAdjacentHTML("afterend",'<span data-inline-edit-tooltip class="totara_core__InlineEdit--tooltip"></span>'),f=this.element.querySelector("[data-inline-edit-tooltip]"),a.get_string("inlineedit:instructions","totara_core").done(function(a){f.textContent=a,c.tooltipText=a,d.setAttribute("aria-label",a)})),this.tooltip=f,this.tooltipText=f.textContent,this.tooltip.style.display="none",this.editing=!1}return b.prototype.events=function(){function a(a){a.preventDefault(),a.stopPropagation(),b.edit(),b.hideError()}var b=this;this.controller.addEventListener("mouseup",function(b){return a(b),!1}),this.controller.addEventListener("keyup",function(b){return"Enter"===b.key&&a(b),!1}),this.input.addEventListener("keyup",function(a){switch(a.key){case"Enter":b.save();break;case"Esc":case"Escape":b.cancel();break;case"Space":a.stopPropagation()}if(b.editing){var c=b.input.value.trim().length;b.allowEmpty||0!==c?b.maxLength>0&&c>=b.maxLength?b.showError("maxlength"):b.hideError():b.showError("noempty")}}),this.input.addEventListener("focusout",function(a){b.cancel()}),this.input.addEventListener("click",function(a){a.stopPropagation()})},b.prototype.edit=function(){this.editing||(this.input.value||(this.input.value=this.target.textContent.trim()),this.target.style.display="none",this.input.style.display="",this.tooltip.style.display="",this.input.focus(),this.controller.style.display="none",this.editing=!0,this.element.dispatchEvent(new CustomEvent("totara_core/inline-edit:edit",{bubbles:!0,detail:{controller:this,elem:this.element,input:this.input,target:this.target}})))},b.prototype.save=function(){if(this.editing){var a=this.input.value.trim();if(""===a&&!this.allowEmpty)return void this.cancel();if(a.length>this.maxLength&&this.maxLength>0)return void this.cancel();var b=!0;this.element.dispatchEvent(new CustomEvent("totara_core/inline-edit:save",{bubbles:!0,detail:{text:a,controller:this,elem:this.element,input:this.input,target:this.target,preventUpdate:function(){b=!1}}})),b&&(this.target.textContent=a),this.target.style.display="",this.input.style.display="none",this.tooltip.style.display="none",this.controller.style.display="",this.controller.focus(),this.editing=!1}},b.prototype.cancel=function(){this.editing&&(this.element.dispatchEvent(new CustomEvent("totara_core/inline-edit:cancel",{bubbles:!0,detail:{elem:this.element,controller:this}})),this.target.style.display="",this.input.style.display="none",this.tooltip.style.display="none",this.controller.style.display="",this.controller.focus(),this.editing=!1)},b.prototype.showError=function(a){this.showCustomError("inlineedit:"+a,"totara_core")},b.prototype.showCustomError=function(b,c){var d=this;this.error=b,a.get_string(b,c).done(function(a){d.error===b&&(d.tooltip.textContent=a,d.tooltip.classList.add("totara_core__InlineEdit--tooltip--error"),d.input.setAttribute("aria-label",a))})},b.prototype.hideError=function(){this.error="",this.tooltip.textContent=this.tooltipText,this.tooltip.classList.remove("totara_core__InlineEdit--tooltip--error")},{init:function(a){return new Promise(function(c){var d=new b(a);d.events(),c(d)})}}});