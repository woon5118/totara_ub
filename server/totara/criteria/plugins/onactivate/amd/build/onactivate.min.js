define(["totara_competency/loader_manager"],function(a){function b(){return this instanceof b?(this.widget="",this.competencyKey="competency_id",this.criterionKey="",this.loader=null,void(this.criterion={type:"onactivate",metadata:[],id:0,singleuse:!0,expandable:!1})):new b}b.prototype={setParent:function(a){this.widget=a},getDetail:function(){var a=this,b=this.widget.closest("[data-tw-editScaleValuePaths-criterion-key]"),c=document.querySelector("[data-tw-editAchievementPaths-competency]");return new Promise(function(d){if(b&&(a.criterionKey=b.hasAttribute("data-tw-editScaleValuePaths-criterion-key")?b.getAttribute("data-tw-editScaleValuePaths-criterion-key"):0,a.criterion.id=b.hasAttribute("data-tw-editScaleValuePaths-criterion-id")?b.getAttribute("data-tw-editScaleValuePaths-criterion-id"):0),c){var e=c.getAttribute("data-tw-editAchievementPaths-competency")?c.getAttribute("data-tw-editAchievementPaths-competency"):1;a.criterion.metadata=[{metakey:a.competencyKey,metavalue:e}]}a.triggerEvent("update",{criterion:a.criterion}),d()})},triggerEvent:function(a,b){b.key=this.criterionKey;var c=new CustomEvent("totara_criteria/criterion:"+a,{bubbles:!0,detail:b});this.widget.dispatchEvent(c)}};var c=function(c){return new Promise(function(d){var e=new b;e.setParent(c),e.loader=a.init(c),e.loader.show(),d(e),M.util.js_pending("criterionCourseCompletion"),e.getDetail().then(function(){e.loader.hide(),M.util.js_complete("criterionCourseCompletion")})["catch"](function(){})})};return{init:c}});