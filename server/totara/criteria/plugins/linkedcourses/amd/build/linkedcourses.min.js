define(["core/ajax","core/notification","totara_competency/loader_manager"],function(a,b,c){function d(){return this instanceof d?(this.widget="",this.competencyKey="competency_id",this.criterionKey="",this.loader=null,this.criterion={type:"linkedcourses",metadata:[],aggregation:{method:1,reqitems:1},singleuse:!1,expandable:!0},void(this.domClasses={hidden:"tw-editAchievementPaths--hidden"})):new d}d.prototype={events:function(){var a=this;this.widget.addEventListener("change",function(b){if(b.target)if(b.target.closest("[data-tw-criterionLinkedCourses-aggregationMethod-changed]")){b.preventDefault();var c=b.target.closest("[data-tw-criterionLinkedCourses-aggregationMethod-changed]").value;a.criterion.aggregation.method!==c&&(a.setAggregationMethod(c),a.triggerEvent("update",{criterion:a.criterion}),a.triggerEvent("dirty",{}))}else if(b.target.closest("[data-tw-criterionLinkedCourses-aggregationCount-changed]")){b.preventDefault();var d=b.target.closest("[data-tw-criterionLinkedCourses-aggregationCount-changed]").value;a.criterion.aggregation.reqitems!=d&&(a.setAggregationCount(d),a.triggerEvent("update",{criterion:a.criterion}),a.triggerEvent("dirty",{}))}})},setParent:function(a){this.widget=a},getDetail:function(){var a=this,b=this.widget.closest("[data-tw-editScaleValuePaths-criterion-key]"),c=b.querySelector("[data-tw-criterionLinkedCourses-aggregation]"),d=document.querySelector("[data-tw-editAchievementPaths-competency]");return new Promise(function(e){if(b&&(a.criterionKey=b.hasAttribute("data-tw-editScaleValuePaths-criterion-key")?b.getAttribute("data-tw-editScaleValuePaths-criterion-key"):0,a.criterion.id=b.hasAttribute("data-tw-editScaleValuePaths-criterion-id")?b.getAttribute("data-tw-editScaleValuePaths-criterion-id"):0),d){var f=d.getAttribute("data-tw-editAchievementPaths-competency")?d.getAttribute("data-tw-editAchievementPaths-competency"):1;a.criterion.metadata=[{metakey:a.competencyKey,metavalue:f}]}c&&(a.criterion.aggregation.method=c.getAttribute("data-tw-criterionLinkedCourses-aggregation"),a.criterion.aggregation.reqitems=c.hasAttribute("data-tw-criterionLinkedCourses-aggregation-reqitems")?c.getAttribute("data-tw-criterionLinkedCourses-aggregation-reqitems"):1),a.setAggregationMethod(a.criterion.aggregation.method),a.setAggregationCount(a.criterion.aggregation.reqitems),a.triggerEvent("update",{criterion:a.criterion}),e()})},setAggregationMethod:function(a){var b=this.widget.querySelector('[data-tw-criterionLinkedCourses-aggregationMethod="'+a+'"]'),c=b.querySelector("[data-tw-criterionLinkedCourses-aggregationMethod-changed]"),d=this.widget.querySelector("[data-tw-criterionLinkedCourses-aggregationCount-changed]"),e=b.querySelector("[data-tw-criterionLinkedCourses-aggregationCount-changed]");this.criterion.aggregation.method=a,c&&(c.checked=!0),d&&(d.disabled=!e),this.hideAggregationCountInfo()},setAggregationCount:function(a){var b=this.widget.querySelector("[data-tw-criterionLinkedCourses-aggregationCount-changed]"),c=parseInt(a)||0;this.criterion.aggregation.reqitems=c<1?1:c,b&&(b.value=this.criterion.aggregation.reqitems),c<1?this.showAggregationCountInfo():this.hideAggregationCountInfo()},showAggregationCountInfo:function(){var a=this.widget.querySelector('[data-tw-criterionLinkedCourses-info="aggregation-count"]');a&&a.classList.remove(this.domClasses.hidden)},hideAggregationCountInfo:function(){var a=this.widget.querySelector('[data-tw-criterionLinkedCourses-info="aggregation-count"]');a&&a.classList.add(this.domClasses.hidden)},triggerEvent:function(a,b){b.key=this.criterionKey;var c=new CustomEvent("totara_criteria/criterion:"+a,{bubbles:!0,detail:b});this.widget.dispatchEvent(c)}};var e=function(a){return new Promise(function(b){var e=new d;e.setParent(a),e.events(),e.loader=c.init(a),e.loader.show(),b(e),M.util.js_pending("criterionLinkedCourses"),e.getDetail().then(function(){e.loader.hide(),M.util.js_complete("criterionLinkedCourses")})["catch"](function(){})})};return{init:e}});